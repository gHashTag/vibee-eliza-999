/Users/playra/vibee-agent/plugin-vibe-face-avatar

# üé® –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –õ–∏—Ü–æ –∞–≤–∞—Ç–∞—Ä–∞ (Avatar Face) - –î–µ—Ç–∞–ª—å–Ω—ã–π –≥–∞–π–¥ –¥–ª—è –∞–≥–µ–Ω—Ç–∞

> **üéØ –¶–µ–ª—å**: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –µ–¥–∏–Ω—ã–π –ø–ª–∞–≥–∏–Ω "–õ–∏—Ü–æ –∞–≤–∞—Ç–∞—Ä–∞" (–æ–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π + –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ñ–æ—Ç–æ)  
> **üìã –°—Ç–∞—Ç—É—Å**: –ì–æ—Ç–æ–≤ –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏  
> **‚è±Ô∏è –í—Ä–µ–º—è**: 5-6 —á–∞—Å–æ–≤  
> **üêù –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: –í—ã—Å–æ–∫–∏–π (–ø–µ—Ä–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–∞–π–ø–ª–∞–π–Ω–∞)  
> **üîó –°–≤—è–∑—å**: Digital Avatar Body (–æ–±—É—á–µ–Ω–∏–µ) + NeuroPhoto (–≥–µ–Ω–µ—Ä–∞—Ü–∏—è) = –æ–¥–∏–Ω –ø–ª–∞–≥–∏–Ω

---

## üìã –û–±–∑–æ—Ä –º–æ–¥—É–ª—è

**–õ–∏—Ü–æ –∞–≤–∞—Ç–∞—Ä–∞ (Avatar Face)** - –µ–¥–∏–Ω—ã–π –º–æ–¥—É–ª—å, —Å–æ—Å—Ç–æ—è—â–∏–π –∏–∑ –¥–≤—É—Ö –≤–∑–∞–∏–º–æ—Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π:

1. **ü§ñ Digital Avatar Body** - –æ–±—É—á–µ–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö LoRA –º–æ–¥–µ–ª–µ–π (—Å–æ–∑–¥–∞–Ω–∏–µ –±–∞–Ω–∫–∞ –º–æ–¥–µ–ª–µ–π)
2. **üì∏ NeuroPhoto** - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ñ–æ—Ç–æ –∏–∑ –±–∞–Ω–∫–∞ –æ–±—É—á–µ–Ω–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π

### üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:

- ‚úÖ **–ï–¥–∏–Ω—ã–π –ø–ª–∞–≥–∏–Ω**: –û–±–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ –æ–¥–Ω–æ–º ElizaOS –ø–ª–∞–≥–∏–Ω–µ `vibe-avatar-face`
- ‚úÖ **–ë–∞–Ω–∫ –º–æ–¥–µ–ª–µ–π**: Digital Avatar Body —Å–æ–∑–¥–∞–µ—Ç –º–æ–¥–µ–ª–∏ ‚Üí NeuroPhoto –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∏—Ö
- ‚úÖ **–¢–û–õ–¨–ö–û –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –º–æ–¥–µ–ª–∏**: NeuroPhoto –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **–ò–°–ö–õ–Æ–ß–ò–¢–ï–õ–¨–ù–û** –º–æ–¥–µ–ª–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–±—É—á–∏–ª —á–µ—Ä–µ–∑ Digital Avatar Body
- ‚úÖ **–ù–ï–¢ –æ–±—â–∏—Ö –º–æ–¥–µ–ª–µ–π**: –ù–∏–∫–∞–∫–∏—Ö Flux Schnell, SDXL –∏ –¥—Ä—É–≥–∏—Ö –æ–±—â–∏—Ö –º–æ–¥–µ–ª–µ–π - —Ç–æ–ª—å–∫–æ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ LoRA –º–æ–¥–µ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ **–°–≤—è–∑—å**: –ö–∞–∫–∏–µ LoRA –º–æ–¥–µ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–±—É—á–∏–ª, —Ç–∞–∫–∏–µ –∏ –¥–æ—Å—Ç—É–ø–Ω—ã –≤ NeuroPhoto
- ‚úÖ –¢—Ä–µ–±—É–µ—Ç –∞–∫—Ç–∏–≤–Ω—É—é –ø–æ–¥–ø–∏—Å–∫—É
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞ —á–µ—Ä–µ–∑ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é `calculateServiceCost()`
- ‚úÖ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Å—Ç–∏–ª—å: –≤—Å–µ —á–µ—Ä–µ–∑ `TaskEither` –∏ `pipe`
- ‚úÖ –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ: –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ —á–µ—Ä–µ–∑ –æ–±—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –º–æ–¥—É–ª—è

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ           –õ–∏—Ü–æ –∞–≤–∞—Ç–∞—Ä–∞ (Avatar Face) Plugin                ‚îÇ
‚îÇ  (vibe-avatar-face)                                         ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                             ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ  Digital Avatar Body      ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ  User Models Bank     ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  (–û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π)       ‚îÇ    ‚îÇ  (–¢–∞–±–ª–∏—Ü–∞ user_models)‚îÇ ‚îÇ
‚îÇ  ‚îÇ                           ‚îÇ    ‚îÇ                      ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ –í—ã–±–æ—Ä –º–æ–¥–µ–ª–∏ –æ–±—É—á–µ–Ω–∏—è  ‚îÇ    ‚îÇ  ‚Ä¢ model_url         ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ (10-50)  ‚îÇ    ‚îÇ  ‚Ä¢ trigger_word      ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ –û–±—É—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Fal.ai  ‚îÇ    ‚îÇ  ‚Ä¢ status            ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î        ‚îÇ    ‚îÇ  ‚Ä¢ gender            ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ           ‚îÇ                                    ‚ñ≤            ‚îÇ
‚îÇ           ‚îÇ                                    ‚îÇ            ‚îÇ
‚îÇ           ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò            ‚îÇ
‚îÇ                             ‚îÇ                               ‚îÇ
‚îÇ                             ‚ñº                               ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ  NeuroPhoto                                          ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  (–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ñ–æ—Ç–æ –∏–∑ –±–∞–Ω–∫–∞ –º–æ–¥–µ–ª–µ–π)                   ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ                                                       ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ –ü–æ–ª—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π –∏–∑ –±–∞–Ω–∫–∞                        ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ –í—ã–±–æ—Ä –º–æ–¥–µ–ª–∏ (–µ—Å–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ)                     ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å trigger_word –∏ model_url              ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤                            ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                                             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üìã –ß–∞—Å—Ç—å 1: Digital Avatar Body (–û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π)

### üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:

- ‚úÖ **–¢–û–õ–¨–ö–û –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –º–æ–¥–µ–ª–∏**: NeuroPhoto –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **–ò–°–ö–õ–Æ–ß–ò–¢–ï–õ–¨–ù–û** –º–æ–¥–µ–ª–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–±—É—á–∏–ª —á–µ—Ä–µ–∑ "ü§ñ –¶–∏—Ñ—Ä–æ–≤–æ–µ —Ç–µ–ª–æ –∞–≤–∞—Ç–∞—Ä–∞"
- ‚úÖ **–ù–ï–¢ –æ–±—â–∏—Ö –º–æ–¥–µ–ª–µ–π**: –ù–∏–∫–∞–∫–∏—Ö Flux Schnell, SDXL –∏ –¥—Ä—É–≥–∏—Ö –æ–±—â–∏—Ö –º–æ–¥–µ–ª–µ–π - —Ç–æ–ª—å–∫–æ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ LoRA –º–æ–¥–µ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ **–°–≤—è–∑—å —Å Digital Avatar Body**: –ö–∞–∫–∏–µ LoRA –º–æ–¥–µ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–±—É—á–∏–ª, —Ç–∞–∫–∏–µ –∏ –¥–æ—Å—Ç—É–ø–Ω—ã –≤ NeuroPhoto
- ‚úÖ –¢—Ä–µ–±—É–µ—Ç –∞–∫—Ç–∏–≤–Ω—É—é –ø–æ–¥–ø–∏—Å–∫—É
- ‚úÖ –ù–∞–ª–∏—á–∏–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ–π –æ–±—É—á–µ–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞ —á–µ—Ä–µ–∑ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é `calculateServiceCost('neuro_photo', { num_images })`
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `trigger_word` –∏–∑ –º–æ–¥–µ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, "NEURO_SAGE")
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `model_url` –∏–∑ –º–æ–¥–µ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (URL –æ–±—É—á–µ–Ω–Ω–æ–π LoRA –º–æ–¥–µ–ª–∏)
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ –ë–î
- ‚úÖ –û—Ç–ø—Ä–∞–≤–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤ Telegram

### –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å Digital Avatar Body (Wizard Flow):

```
Step 1: –í—ã–±–æ—Ä –º–æ–¥–µ–ª–∏ –æ–±—É—á–µ–Ω–∏—è
  ‚îî‚îÄ Inline –∫–Ω–æ–ø–∫–∏:
     ‚Ä¢ üé® Portrait Trainer (550‚≠ê, 15-30 –º–∏–Ω, 2500 —à–∞–≥–æ–≤)
     ‚Ä¢ ‚ö° Fast Training (220‚≠ê, 10-15 –º–∏–Ω, 1000 —à–∞–≥–æ–≤)

Step 2: –í—ã–±–æ—Ä –ø–æ–ª–∞ –∞–≤–∞—Ç–∞—Ä–∞
  ‚îî‚îÄ Inline –∫–Ω–æ–ø–∫–∏:
     ‚Ä¢ –ú—É–∂—Å–∫–æ–π ‚ôÇÔ∏è
     ‚Ä¢ –ñ–µ–Ω—Å–∫–∏–π ‚ôÄÔ∏è

Step 3: –í–≤–æ–¥ –Ω–∞–∑–≤–∞–Ω–∏—è –º–æ–¥–µ–ª–∏
  ‚îî‚îÄ –¢–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ (–º–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞, –º–∞–∫—Å–∏–º—É–º 50)
     ‚Ä¢ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∞–Ω–∏—Ç–∏–∑–∏—Ä—É–µ—Ç—Å—è –¥–ª—è Replicate API
     ‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ trigger_word (–≤ –≤–µ—Ä—Ö–Ω–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–µ)

Step 4: –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
  ‚îî‚îÄ –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ (–º–∏–Ω–∏–º—É–º 10, –º–∞–∫—Å–∏–º—É–º 25)
     ‚Ä¢ –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ (JPG, PNG, WEBP)
     ‚Ä¢ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ (–º–∞–∫—Å–∏–º—É–º 10MB)
     ‚Ä¢ –ö–æ–º–∞–Ω–¥–∞ /done –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

Step 5: –ó–∞–ø—É—Å–∫ –æ–±—É—á–µ–Ω–∏—è
  ‚îî‚îÄ –°–æ–∑–¥–∞–Ω–∏–µ ZIP –∞—Ä—Ö–∏–≤–∞
     ‚Ä¢ –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Fal.ai –¥–ª—è –æ–±—É—á–µ–Ω–∏—è
     ‚Ä¢ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤ –ë–î (—Ç–∞–±–ª–∏—Ü–∞ model_trainings)
     ‚Ä¢ –°—Ç–∞—Ç—É—Å: 'training' ‚Üí 'completed' / 'failed'
     ‚Ä¢ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏
```

### –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å NeuroPhoto (Wizard Flow):

```
Step 1: –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –º–æ–¥–µ–ª–µ–π
  ‚îî‚îÄ –ó–∞–ø—Ä–æ—Å —á–µ—Ä–µ–∑ getActiveUserModelsByType(telegramId, 'replicate')
     ‚Ä¢ –ï—Å–ª–∏ –º–æ–¥–µ–ª–µ–π –Ω–µ—Ç ‚Üí —Å–æ–æ–±—â–µ–Ω–∏–µ: "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ 'ü§ñ –¶–∏—Ñ—Ä–æ–≤–æ–µ —Ç–µ–ª–æ –∞–≤–∞—Ç–∞—Ä–∞' –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –º–æ–¥–µ–ª–∏"
     ‚Ä¢ –ï—Å–ª–∏ –º–æ–¥–µ–ª—å –æ–¥–Ω–∞ ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è
     ‚Ä¢ –ï—Å–ª–∏ –º–æ–¥–µ–ª–µ–π –Ω–µ—Å–∫–æ–ª—å–∫–æ ‚Üí Inline –∫–Ω–æ–ø–∫–∏ —Å–æ —Å–ø–∏—Å–∫–æ–º –º–æ–¥–µ–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

Step 2: –í–≤–æ–¥ –ø—Ä–æ–º–ø—Ç–∞
  ‚îî‚îÄ –¢–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ (–º–∏–Ω–∏–º—É–º 3 —Å–∏–º–≤–æ–ª–∞)
     ‚Ä¢ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è trigger_word –∏–∑ –º–æ–¥–µ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
     ‚Ä¢ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è gender –∏–∑ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

Step 3: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
  ‚îî‚îÄ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è model_url –∏–∑ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
     ‚Ä¢ –ß–µ—Ä–µ–∑ Fal.ai (–µ—Å–ª–∏ –º–æ–¥–µ–ª—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç LoRA)
     ‚Ä¢ –ò–ª–∏ —á–µ—Ä–µ–∑ Replicate (–µ—Å–ª–∏ model_url —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ Replicate)
     ‚Ä¢ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è 1 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ

Step 4: –û—Ç–ø—Ä–∞–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
  ‚îî‚îÄ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ + –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (–º–æ–¥–µ–ª—å, trigger_word, –ø—Ä–æ–º–ø—Ç)
```

---

## üöÄ –ü–æ—à–∞–≥–æ–≤—ã–π –ø–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –§–∞–∑–∞ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã (15 –º–∏–Ω—É—Ç)

#### –®–∞–≥ 1.1: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–ª–∞–≥–∏–Ω–∞ —á–µ—Ä–µ–∑ CLI

```bash
# –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—É –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏!
cd /Users/playra/999-multibots-telegraf
elizaos plugins create vibe-avatar-face

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–∑–¥–∞–Ω–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
cd packages/plugin-vibe-avatar-face
ls -la
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**

```
packages/plugin-vibe-avatar-face/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ index.ts
‚îÇ   ‚îú‚îÄ‚îÄ actions/
‚îÇ   ‚îú‚îÄ‚îÄ providers/
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îî‚îÄ‚îÄ types/
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ tsconfig.json
‚îî‚îÄ‚îÄ README.md
```

#### –®–∞–≥ 1.2: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
cd packages/plugin-vibe-avatar-face
npm install

# –ò–ª–∏ –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è bun
bun install
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:**

- `@elizaos/core` - –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ package.json
- `zod` - –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- `drizzle-orm` - –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î
- `@/core/functional/utils/result` - –¥–ª—è TaskEither
- `@/core/functional/utils/composition` - –¥–ª—è pipe

#### –®–∞–≥ 1.3: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–æ–µ–∫—Ç–∞

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –ø–ª–∞–≥–∏–Ω —Å–æ–∑–¥–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ
cat src/index.ts
# –î–æ–ª–∂–µ–Ω —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–±—ä–µ–∫—Ç Plugin

cat package.json
# –î–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç @elizaos/core
```

---

### –§–∞–∑–∞ 2: –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∏–ø–æ–≤ –∏ —Å—Ö–µ–º (30 –º–∏–Ω—É—Ç)

#### –®–∞–≥ 2.1: –°–æ–∑–¥–∞–Ω–∏–µ Zod —Å—Ö–µ–º

**–§–∞–π–ª**: `src/types/schemas.ts`

```typescript
import { z } from "zod";

/**
 * –°—Ö–µ–º–∞ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
 */
export const GenerateImageInputSchema = z.object({
  prompt: z.string().min(3, "–ü—Ä–æ–º–ø—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–∏–Ω–∏–º—É–º 3 —Å–∏–º–≤–æ–ª–∞"),
  modelId: z.string().uuid().optional(), // ID –º–æ–¥–µ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–µ—Å–ª–∏ –µ—Å—Ç—å)
  modelUrl: z.string().url().optional(), // URL –º–æ–¥–µ–ª–∏ Replicate (–µ—Å–ª–∏ –æ–±—â–∞—è)
  aspectRatio: z.enum(["1:1", "9:16", "16:9", "4:3"]).default("9:16"),
  numImages: z.number().int().min(1).max(4).default(1),
  negativePrompt: z.string().optional(),
  steps: z.number().int().min(1).max(50).optional(),
  guidanceScale: z.number().min(1).max(20).optional(),
  seed: z.number().int().optional(),
});

export type GenerateImageInput = z.infer<typeof GenerateImageInputSchema>;

/**
 * –°—Ö–µ–º–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
 */
export const GenerateImageOutputSchema = z.object({
  success: z.boolean(),
  imageUrls: z.array(z.string().url()),
  metadata: z.object({
    prompt: z.string(),
    model: z.string(),
    generationTime: z.number(),
    loraUsed: z.boolean().optional(),
    triggerWord: z.string().optional(),
  }),
  error: z.string().optional(),
});

export type GenerateImageOutput = z.infer<typeof GenerateImageOutputSchema>;

/**
 * –°—Ö–µ–º–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–µ–π—Å—Ç–≤–∏—è
 */
export const NeuroPhotoActionContextSchema = z.object({
  telegramId: z.number().int().positive(),
  botName: z.string(),
  prompt: z.string().min(3),
  modelId: z.string().uuid().optional(),
  modelUrl: z.string().url().optional(),
  userId: z.string().uuid(),
});

export type NeuroPhotoActionContext = z.infer<
  typeof NeuroPhotoActionContextSchema
>;
```

#### –®–∞–≥ 2.2: –°–æ–∑–¥–∞–Ω–∏–µ TypeScript —Ç–∏–ø–æ–≤

**–§–∞–π–ª**: `src/types/index.ts`

```typescript
export * from "./schemas";

/**
 * –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
 */
export interface ImageGenerationServiceConfig {
  apiKey: string;
  defaultModel: string;
  timeout: number;
  maxRetries: number;
  provider: "replicate" | "fal";
}

/**
 * –û–ø—Ü–∏–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
 */
export interface GenerateImageOptions {
  prompt: string;
  modelId?: string;
  modelUrl?: string;
  aspectRatio?: "1:1" | "9:16" | "16:9" | "4:3";
  numImages?: number;
  negativePrompt?: string;
  steps?: number;
  guidanceScale?: number;
  seed?: number;
}

/**
 * –†–µ–∑—É–ª—å—Ç–∞—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
 */
export interface ImageGenerationResult {
  success: boolean;
  imageUrls: string[];
  metadata: {
    prompt: string;
    model: string;
    generationTime: number;
    loraUsed?: boolean;
    triggerWord?: string;
  };
  error?: string;
}
```

---

### –§–∞–∑–∞ 3: –°–æ–∑–¥–∞–Ω–∏–µ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ (60 –º–∏–Ω—É—Ç)

> **üéØ –¶–ï–õ–¨**: –°–æ–∑–¥–∞—Ç—å —Ä–∞—Å—à–∏—Ä—è–µ–º—É—é —Å–∏—Å—Ç–µ–º—É –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤, –∫–æ—Ç–æ—Ä–∞—è –ª–µ–≥–∫–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã –∏ –º–æ–¥–µ–ª–∏ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫–æ–¥–∞.

#### –®–∞–≥ 3.1: –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

**–§–∞–π–ª**: `src/types/provider.interface.ts`

```typescript
import { TaskEither } from "@/core/functional/utils/result";
import { GenerateImageOptions, ImageGenerationResult } from "./index";

/**
 * –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –≤—Å–µ—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
 */
export interface ImageGenerationProvider {
  /** –£–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ */
  name: string;

  /** –û–ø–∏—Å–∞–Ω–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ */
  description: string;

  /** –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –º–æ–¥–µ–ª–∏ */
  supportedModels: string[];

  /** –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ */
  healthCheck(): TaskEither<Error, { status: "healthy" | "unhealthy" }>;

  /** –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è */
  generateImage(
    options: GenerateImageOptions
  ): TaskEither<Error, ImageGenerationResult>;

  /** –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –º–æ–¥–µ–ª–∏ */
  getModelInfo(modelId: string): TaskEither<Error, ModelInfo>;

  /** –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π */
  listModels(): TaskEither<Error, ModelInfo[]>;
}

/**
 * –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–æ–¥–µ–ª–∏
 */
export interface ModelInfo {
  id: string;
  name: string;
  provider: string;
  description: string;
  pricePerImage: number;
  estimatedTime: number;
  supportedFeatures: string[];
  aspectRatios: string[];
  maxImages: number;
}
```

#### –®–∞–≥ 3.2: –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–µ—Å—Ç—Ä–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤

**–§–∞–π–ª**: `src/services/provider-registry.ts`

```typescript
import { ImageGenerationProvider } from "../types/provider.interface";
import { TaskEither, right, left } from "@/core/functional/utils/result";
import { pipe, chain } from "@/core/functional/utils/composition";

/**
 * –†–µ–µ—Å—Ç—Ä –≤—Å–µ—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
 * –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Å—Ç–∏–ª—å, –ª–µ–≥–∫–æ —Ä–∞—Å—à–∏—Ä—è–µ–º—ã–π
 */
export class ImageProviderRegistry {
  private providers = new Map<string, ImageGenerationProvider>();

  /**
   * –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
   */
  register(provider: ImageGenerationProvider): void {
    this.providers.set(provider.name, provider);
    console.log(`‚úÖ –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –ø—Ä–æ–≤–∞–π–¥–µ—Ä: ${provider.name}`);
  }

  /**
   * –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –ø–æ –∏–º–µ–Ω–∏
   */
  get(name: string): ImageGenerationProvider | undefined {
    return this.providers.get(name);
  }

  /**
   * –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
   */
  getAll(): ImageGenerationProvider[] {
    return Array.from(this.providers.values());
  }

  /**
   * –ü–æ–ª—É—á–µ–Ω–∏–µ –∑–¥–æ—Ä–æ–≤—ã—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
   */
  async getHealthyProviders(): Promise<ImageGenerationProvider[]> {
    const healthy: ImageGenerationProvider[] = [];

    for (const provider of this.providers.values()) {
      const health = await provider.healthCheck()();
      if (health.isRight() && health.value.status === "healthy") {
        healthy.push(provider);
      }
    }

    return healthy;
  }

  /**
   * –ü–æ–ª—É—á–µ–Ω–∏–µ –ª—É—á—à–µ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø–µ—Ä–≤—ã–π –∑–¥–æ—Ä–æ–≤—ã–π)
   */
  async getBestProvider(): Promise<ImageGenerationProvider | undefined> {
    const healthy = await this.getHealthyProviders();
    return healthy[0];
  }
}

// –ì–ª–æ–±–∞–ª—å–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä —Ä–µ–µ—Å—Ç—Ä–∞
export const imageProviderRegistry = new ImageProviderRegistry();
```

#### –®–∞–≥ 3.3: –†–∞–±–æ—Ç–∞ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º–∏ –º–æ–¥–µ–ª—è–º–∏ (–ù–ï –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ–±—â–∏—Ö –º–æ–¥–µ–ª–µ–π!)

**üö® –í–ê–ñ–ù–û**: NeuroPhoto –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –æ–±—â–∏–µ –º–æ–¥–µ–ª–∏! –¢–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ LoRA –º–æ–¥–µ–ª–∏ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `user_models`.

**–§–∞–π–ª**: `src/types/user-model.interface.ts`

```typescript
/**
 * –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –º–æ–¥–µ–ª—å (–æ–±—É—á–µ–Ω–Ω–∞—è —á–µ—Ä–µ–∑ Digital Avatar Body)
 * –≠—Ç–æ –ï–î–ò–ù–°–¢–í–ï–ù–ù–´–ô —Ç–∏–ø –º–æ–¥–µ–ª–∏ –¥–ª—è NeuroPhoto
 */
export interface UserModel {
  id: string; // UUID
  telegram_id: number;
  bot_name: string;
  model_name: string;
  model_url: string; // URL –æ–±—É—á–µ–Ω–Ω–æ–π LoRA –º–æ–¥–µ–ª–∏ (Replicate –∏–ª–∏ Fal.ai)
  model_key?: string; // –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –∫–ª—é—á
  trigger_word: string; // –ù–∞–ø—Ä–∏–º–µ—Ä, "NEURO_SAGE" - –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ –ø—Ä–æ–º–ø—Ç
  gender?: "male" | "female" | "person"; // –ò–∑ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

  // –û–±—É—á–µ–Ω–∏–µ
  status: "training" | "completed" | "failed";
  training_steps?: number;
  training_model?: "flux-lora-portrait-trainer" | "flux-lora-fast-training";

  // –ö–æ–º–∞–Ω–¥–∞ (–æ–±—â–∏–µ –º–æ–¥–µ–ª–∏)
  is_team_model?: boolean;
  team_id?: string;

  // –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
  is_active: boolean;
  created_at: Date;
  updated_at: Date;
  completed_at?: Date;
}

/**
 * –ü–æ–ª—É—á–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
 * –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Å—Ç–∏–ª—å —Å TaskEither
 */
export function getUserModelsTask(
  telegramId: number,
  botName: string
): TaskEither<Error, UserModel[]> {
  return tryCatchAsync(
    async () => {
      const { getActiveUserModelsByType } = await import(
        "@/core/supabase/getActiveUserModelsByType"
      );
      const models = await getActiveUserModelsByType(telegramId, "replicate");
      return models.filter(
        (m) => m.status === "completed" && m.is_active
      ) as UserModel[];
    },
    (error) => (error instanceof Error ? error : new Error(String(error)))
  );
}
```

**–£–î–ê–õ–ï–ù–û**: –í–µ—Å—å —Ä–∞–∑–¥–µ–ª —Å `IMAGE_MODELS` - –æ–Ω –Ω–µ –Ω—É–∂–µ–Ω! NeuroPhoto —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º–∏ –º–æ–¥–µ–ª—è–º–∏.

#### –®–∞–≥ 3.4: –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ –¥–ª—è –æ–±—â–∏—Ö –º–æ–¥–µ–ª–µ–π

**üö® –í–ê–ñ–ù–û**: –ü—Ä–æ–≤–∞–π–¥–µ—Ä—ã –¥–ª—è –æ–±—â–∏—Ö –º–æ–¥–µ–ª–µ–π (ReplicateProvider, FalProvider) –ù–ï –Ω—É–∂–Ω—ã –¥–ª—è NeuroPhoto!

NeuroPhoto —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞–ø—Ä—è–º—É—é —Å:

1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º–∏ –º–æ–¥–µ–ª—è–º–∏** –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `user_models`
2. **model_url** –∏–∑ –º–æ–¥–µ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—É–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç URL –æ–±—É—á–µ–Ω–Ω–æ–π LoRA)
3. **trigger_word** –∏–∑ –º–æ–¥–µ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ –ø—Ä–æ–º–ø—Ç)

**–í–º–µ—Å—Ç–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ–º**:

- `getActiveUserModelsByType(telegramId, 'replicate')` - –ø–æ–ª—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `generateNeuroPhotoHybrid()` –∏–ª–∏ `generateNeuroPhotoDirect()` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `model_url` –∏ `trigger_word` –∏–∑ –º–æ–¥–µ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–£–î–ê–õ–ï–ù–û**: –í—Å–µ —Ä–∞–∑–¥–µ–ª—ã —Å –æ–±—â–∏–º–∏ –º–æ–¥–µ–ª—è–º–∏ (IMAGE_MODELS, ReplicateProvider, FalProvider, provider-registry) - –æ–Ω–∏ –Ω–µ –Ω—É–∂–Ω—ã –¥–ª—è NeuroPhoto!
description: 'Fast, high-quality image generation',
provider: 'replicate',
apiModel: 'black-forest-labs/flux-schnell',
pricing: {
type: 'fixed',
baseCostUSD: 0.003, // –°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å –≤ USD (–±—É–¥–µ—Ç —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–æ —á–µ—Ä–µ–∑ usdToStars)
},
apiSettings: {
aspectRatios: ['1:1', '16:9', '9:16', '4:3'],
maxImages: 4,
supportsNegativePrompt: true,
supportsSeed: true,
supportsSteps: true,
supportsGuidanceScale: true,
},
status: 'active',
},

flux_pro: {
id: 'flux_pro',
name: 'Flux Pro',
nameRu: 'Flux Pro',
description: 'Premium quality image generation',
provider: 'replicate',
apiModel: 'black-forest-labs/flux-pro',
pricing: {
type: 'fixed',
baseCostUSD: 0.055, // –°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å –≤ USD
},
apiSettings: {
aspectRatios: ['1:1', '16:9', '9:16', '4:3'],
maxImages: 4,
supportsNegativePrompt: true,
supportsSeed: true,
supportsSteps: true,
supportsGuidanceScale: true,
},
status: 'active',
},

flux_ultra: {
id: 'flux_ultra',
name: 'Flux 1.1 Pro Ultra',
nameRu: 'Flux 1.1 Pro Ultra',
description: 'Ultra-realistic photorealistic images',
provider: 'replicate',
apiModel: 'black-forest-labs/flux-1.1-pro-ultra',
pricing: {
type: 'fixed',
baseCostUSD: 0.06, // –°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å –≤ USD
},
apiSettings: {
aspectRatios: ['1:1', '16:9', '9:16', '4:3'],
maxImages: 4,
supportsNegativePrompt: true,
supportsSeed: true,
supportsSteps: true,
supportsGuidanceScale: true,
},
status: 'active',
},

sdxl: {
id: 'sdxl',
name: 'SDXL',
nameRu: 'SDXL',
description: 'Stable Diffusion XL - reliable and consistent',
provider: 'replicate',
apiModel: 'stability-ai/sdxl:7762fd07cf82c948538e41f63f77d685e02b063e37e496e96eefd46c929f9bdc',
pricing: {
type: 'fixed',
baseCostUSD: 0.04, // –°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å –≤ USD
},
apiSettings: {
aspectRatios: ['1:1', '16:9', '9:16', '4:3'],
maxImages: 4,
supportsNegativePrompt: true,
supportsSeed: true,
supportsSteps: true,
supportsGuidanceScale: true,
},
status: 'active',
},

sd3: {
id: 'sd3',
name: 'Stable Diffusion 3.5 Large Turbo',
nameRu: 'Stable Diffusion 3.5 Large Turbo',
description: 'Latest SD3.5 with turbo speed',
provider: 'replicate',
apiModel: 'stability-ai/stable-diffusion-3.5-large-turbo',
pricing: {
type: 'fixed',
baseCostUSD: 0.04, // –°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å –≤ USD
},
apiSettings: {
aspectRatios: ['1:1', '16:9', '9:16', '4:3'],
maxImages: 4,
supportsNegativePrompt: true,
supportsSeed: true,
supportsSteps: true,
supportsGuidanceScale: true,
},
status: 'active',
},

recraft_v3: {
id: 'recraft_v3',
name: 'Recraft V3',
nameRu: 'Recraft V3',
description: 'High-quality image generation with SVG support',
provider: 'replicate',
apiModel: 'recraft-ai/recraft-v3',
pricing: {
type: 'fixed',
baseCostUSD: 0.022, // –°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å –≤ USD
},
apiSettings: {
aspectRatios: ['1:1', '16:9', '9:16', '4:3'],
maxImages: 4,
supportsNegativePrompt: true,
supportsSeed: true,
},
status: 'active',
},

photon: {
id: 'photon',
name: 'Luma Photon',
nameRu: 'Luma Photon',
description: 'Photorealistic image generation',
provider: 'replicate',
apiModel: 'luma/photon',
pricing: {
type: 'fixed',
baseCostUSD: 0.03, // –°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å –≤ USD
},
apiSettings: {
aspectRatios: ['1:1', '16:9', '9:16', '4:3'],
maxImages: 4,
supportsNegativePrompt: true,
supportsSeed: true,
},
status: 'active',
},

// ==================== FAL.AI MODELS ====================

fal_flux_lora: {
id: 'fal_flux_lora',
name: 'Fal.ai Flux LoRA',
nameRu: 'Fal.ai Flux LoRA',
description: 'Flux with LoRA support for personalized images',
provider: 'fal',
apiModel: 'fal-ai/flux-lora',
pricing: {
type: 'fixed',
baseCostUSD: 0.003, // –°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å –≤ USD (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ Flux Schnell)
},
apiSettings: {
aspectRatios: ['9:16'], // Vertical for social media
maxImages: 4,
supportsNegativePrompt: true,
supportsSeed: true,
supportsSteps: true,
supportsGuidanceScale: true,
supportsLoRA: true, // ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ LoRA
},
status: 'active',
notes: 'Supports LoRA for personalized character generation',
},

// ==================== KIE.AI MODELS ====================

kie_gpt4o_image: {
id: 'kie_gpt4o_image',
name: 'GPT-4o Image',
nameRu: 'GPT-4o Image',
description: 'Accurate text rendering in images',
provider: 'kie',
apiModel: 'gpt-4o-image',
pricing: {
type: 'fixed',
baseCostUSD: 0.1, // –°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å –≤ USD
},
apiSettings: {
aspectRatios: ['1:1', '16:9', '9:16'],
maxImages: 1,
supportsNegativePrompt: false,
},
status: 'active',
notes: 'Best for text rendering in images',
},

kie_flux_kontext: {
id: 'kie_flux_kontext',
name: 'FLUX.1 Kontext',
nameRu: 'FLUX.1 Kontext',
description: 'Consistent character generation',
provider: 'kie',
apiModel: 'flux-1-kontext',
pricing: {
type: 'fixed',
baseCostUSD: 0.08, // –°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å –≤ USD
},
apiSettings: {
aspectRatios: ['1:1', '16:9', '9:16'],
maxImages: 4,
supportsNegativePrompt: true,
},
status: 'active',
notes: 'Best for character consistency',
},
}

/\*\*

- –ü–æ–ª—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ –ø–æ ID
  \*/
  export function getImageModel(id: string): ImageModelConfig | undefined {
  return IMAGE_MODELS[id]
  }

/\*\*

- –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π
  \*/
  export function getActiveImageModels(): ImageModelConfig[] {
  return Object.values(IMAGE_MODELS).filter(model => model.status === 'active')
  }

/\*\*

- –ü–æ–ª—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π –ø–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—É
  \*/
  export function getImageModelsByProvider(provider: string): ImageModelConfig[] {
  return Object.values(IMAGE_MODELS).filter(
  model => model.provider === provider && model.status === 'active'
  )
  }

/\*\*

- –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ NeuroPhoto
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è
- –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Å—Ç–∏–ª—å —Å TaskEither
  \*/
  export function calculateNeuroPhotoCostTask(
  numImages: number = 1
  ): TaskEither<Error, number> {
  return tryCatchAsync(
  async () => {
  const { calculateServiceCost } = await import('@/price/helpers/calculateServiceCost')
  // –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Ä–∞—Å—á–µ—Ç–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏
  // –õ–æ–≥–∏–∫–∞: 4‚≠ê –∑–∞ 1 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ, —É–º–Ω–æ–∂–∞–µ—Ç—Å—è –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
  return calculateServiceCost('neuro_photo', { num_images: numImages })
  },
  (error) => error instanceof Error ? error : new Error(String(error))
  )
  }

````

#### –®–∞–≥ 3.4: –°–æ–∑–¥–∞–Ω–∏–µ ReplicateProvider (—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞)

**–§–∞–π–ª**: `src/providers/replicateProvider.ts`

```typescript
import { ImageGenerationProvider, ModelInfo } from '../types/provider.interface'
import { TaskEither, tryCatchAsync, right, left } from '@/core/functional/utils/result'
import { pipe, chain } from '@/core/functional/utils/composition'
import { GenerateImageOptions, ImageGenerationResult } from '../types'
import { getImageModelsByProvider, getImageModel } from '../config/image-models.config'
import Replicate from 'replicate'

/**
 * Replicate Provider - —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ ImageGenerationProvider
 * –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤—Å–µ –º–æ–¥–µ–ª–∏ Replicate (Flux, SDXL, SD3, Recraft, Photon –∏ –¥—Ä.)
 */
export class ReplicateProvider implements ImageGenerationProvider {
  name = 'replicate'
  description = 'AI image generation using Replicate API with Flux, SDXL, SD3, Recraft, Photon and other models'

  private client: Replicate | null = null
  private apiKey: string | null = null

  constructor(apiKey: string) {
    this.apiKey = apiKey
    this.client = new Replicate({ auth: apiKey })
  }

  get supportedModels(): string[] {
    return getImageModelsByProvider('replicate').map(model => model.id)
  }

  healthCheck(): TaskEither<Error, { status: 'healthy' | 'unhealthy' }> {
    return tryCatchAsync(
      async () => {
        // –ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ - –ø—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –º–æ–¥–µ–ª–µ–π
        if (!this.client) {
          throw new Error('Replicate client –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω')
        }
        return { status: 'healthy' as const }
      },
      (error) => error instanceof Error ? error : new Error(String(error))
    )
  }

  generateImage(options: GenerateImageOptions): TaskEither<Error, ImageGenerationResult> {
    if (!this.client) {
      return left(new Error('Replicate Provider –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω'))
    }

    return tryCatchAsync(
      async () => {
        const startTime = Date.now()

        // –ü–æ–ª—É—á–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –º–æ–¥–µ–ª–∏
        const modelConfig = options.modelId
          ? getImageModel(options.modelId)
          : getImageModel('flux_schnell') // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é

        if (!modelConfig) {
          throw new Error(`–ú–æ–¥–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞: ${options.modelId || 'flux_schnell'}`)
        }

        const modelUrl = modelConfig.apiModel
        const numImages = Math.min(options.numImages || 1, modelConfig.apiSettings.maxImages)

        // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ input –¥–ª—è Replicate
        const input: any = {
          prompt: options.prompt,
          num_outputs: numImages,
        }

        // –î–æ–±–∞–≤–ª—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –º–æ–¥–µ–ª–∏
        if (options.aspectRatio && modelConfig.apiSettings.aspectRatios.includes(options.aspectRatio)) {
          input.aspect_ratio = options.aspectRatio
        }

        if (options.negativePrompt && modelConfig.apiSettings.supportsNegativePrompt) {
          input.negative_prompt = options.negativePrompt
        }

        if (options.steps && modelConfig.apiSettings.supportsSteps) {
          input.num_inference_steps = options.steps
        }

        if (options.guidanceScale && modelConfig.apiSettings.supportsGuidanceScale) {
          input.guidance_scale = options.guidanceScale
        }

        if (options.seed && modelConfig.apiSettings.supportsSeed) {
          input.seed = options.seed
        }

        // –î–æ–±–∞–≤–ª—è–µ–º –±–∞–∑–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
        if (modelConfig.apiSettings.baseInput) {
          Object.assign(input, modelConfig.apiSettings.baseInput)
        }

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ Replicate
        const output = await this.client!.run(modelUrl as any, { input })
        const generationTime = Date.now() - startTime

        // –ü–∞—Ä—Å–∏–Ω–≥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
        let imageUrls: string[]
        if (Array.isArray(output)) {
          imageUrls = output.filter((url) => typeof url === 'string')
        } else if (typeof output === 'string') {
          imageUrls = [output]
        } else if (output && typeof output === 'object' && 'output' in output) {
          const outputData = (output as any).output
          imageUrls = Array.isArray(outputData) ? outputData : [outputData]
        } else {
          throw new Error('–ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ –æ—Ç Replicate')
        }

        return {
          success: true,
          imageUrls,
          metadata: {
            prompt: options.prompt,
            model: modelUrl,
            generationTime,
          },
        } as ImageGenerationResult
      },
      (error) => error instanceof Error ? error : new Error(String(error))
    )
  }

  getModelInfo(modelId: string): TaskEither<Error, ModelInfo> {
    return tryCatchAsync(
      async () => {
        const modelConfig = getImageModel(modelId)
        if (!modelConfig) {
          throw new Error(`–ú–æ–¥–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞: ${modelId}`)
        }

        return {
          id: modelConfig.id,
          name: modelConfig.name,
          provider: modelConfig.provider,
          description: modelConfig.description,
          pricePerImage: modelConfig.pricing.fixedPriceStars || 0,
          estimatedTime: 10, // –ü—Ä–∏–º–µ—Ä–Ω–æ–µ –≤—Ä–µ–º—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
          supportedFeatures: [
            ...(modelConfig.apiSettings.supportsNegativePrompt ? ['negative-prompt'] : []),
            ...(modelConfig.apiSettings.supportsSeed ? ['seed'] : []),
            ...(modelConfig.apiSettings.supportsSteps ? ['steps'] : []),
            ...(modelConfig.apiSettings.supportsGuidanceScale ? ['guidance-scale'] : []),
            ...(modelConfig.apiSettings.supportsLoRA ? ['lora'] : []),
          ],
          aspectRatios: modelConfig.apiSettings.aspectRatios,
          maxImages: modelConfig.apiSettings.maxImages,
        }
      },
      (error) => error instanceof Error ? error : new Error(String(error))
    )
  }

  listModels(): TaskEither<Error, ModelInfo[]> {
    return tryCatchAsync(
      async () => {
        const models = getImageModelsByProvider('replicate')
        return Promise.all(
          models.map(model => this.getModelInfo(model.id)())
        ).then(results =>
          results
            .filter(result => result.isRight())
            .map(result => (result as any).value)
        )
      },
      (error) => error instanceof Error ? error : new Error(String(error))
    )
  }
}
````

#### –®–∞–≥ 3.5: –°–æ–∑–¥–∞–Ω–∏–µ FalProvider (–¥–ª—è LoRA –∏ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏)

**–§–∞–π–ª**: `src/providers/falProvider.ts`

```typescript
import {
  ImageGenerationProvider,
  ModelInfo,
} from "../types/provider.interface";
import {
  TaskEither,
  tryCatchAsync,
  left,
} from "@/core/functional/utils/result";
import { GenerateImageOptions, ImageGenerationResult } from "../types";
import {
  getImageModelsByProvider,
  getImageModel,
} from "../config/image-models.config";
import { fal } from "@fal-ai/client";

/**
 * Fal.ai Provider - —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ ImageGenerationProvider
 * –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç LoRA –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
 */
export class FalProvider implements ImageGenerationProvider {
  name = "fal";
  description =
    "AI image generation using Fal.ai API with LoRA support for personalized images";

  private apiKey: string | null = null;
  private defaultLoRA?: { path: string; scale: number; triggerWord: string };

  constructor(
    apiKey: string,
    defaultLoRA?: { path: string; scale: number; triggerWord: string }
  ) {
    this.apiKey = apiKey;
    this.defaultLoRA = defaultLoRA;

    // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Fal.ai –∫–ª–∏–µ–Ω—Ç–∞
    fal.config({
      credentials: apiKey,
    });
  }

  get supportedModels(): string[] {
    return getImageModelsByProvider("fal").map((model) => model.id);
  }

  healthCheck(): TaskEither<Error, { status: "healthy" | "unhealthy" }> {
    return tryCatchAsync(
      async () => {
        if (!this.apiKey) {
          throw new Error("Fal.ai API key –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω");
        }
        return { status: "healthy" as const };
      },
      (error) => (error instanceof Error ? error : new Error(String(error)))
    );
  }

  generateImage(
    options: GenerateImageOptions
  ): TaskEither<Error, ImageGenerationResult> {
    if (!this.apiKey) {
      return left(new Error("Fal Provider –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω"));
    }

    return tryCatchAsync(
      async () => {
        const startTime = Date.now();

        // –ü–æ–ª—É—á–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –º–æ–¥–µ–ª–∏
        const modelConfig = options.modelId
          ? getImageModel(options.modelId)
          : getImageModel("fal_flux_lora"); // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é

        if (!modelConfig) {
          throw new Error(
            `–ú–æ–¥–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞: ${options.modelId || "fal_flux_lora"}`
          );
        }

        const modelUrl = modelConfig.apiModel;

        // –£–ª—É—á—à–∞–µ–º –ø—Ä–æ–º–ø—Ç —Å trigger word –¥–ª—è LoRA
        let enhancedPrompt = options.prompt;
        if (this.defaultLoRA && modelConfig.apiSettings.supportsLoRA) {
          enhancedPrompt = `${this.defaultLoRA.triggerWord} ${options.prompt}`;
        }

        // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ input –¥–ª—è Fal.ai
        const input: any = {
          prompt: enhancedPrompt,
          image_size: {
            width: 768,
            height: 1365, // 9:16 –¥–ª—è —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–µ—Ç–µ–π
          },
          num_images: Math.min(
            options.numImages || 1,
            modelConfig.apiSettings.maxImages
          ),
        };

        // –î–æ–±–∞–≤–ª—è–µ–º LoRA –µ—Å–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è
        if (modelConfig.apiSettings.supportsLoRA && this.defaultLoRA) {
          input.loras = [
            {
              path: this.defaultLoRA.path,
              scale: this.defaultLoRA.scale,
            },
          ];
        }

        // –î–æ–±–∞–≤–ª—è–µ–º –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
        if (
          options.negativePrompt &&
          modelConfig.apiSettings.supportsNegativePrompt
        ) {
          input.negative_prompt = options.negativePrompt;
        }

        if (options.steps && modelConfig.apiSettings.supportsSteps) {
          input.num_inference_steps = options.steps;
        }

        if (
          options.guidanceScale &&
          modelConfig.apiSettings.supportsGuidanceScale
        ) {
          input.guidance_scale = options.guidanceScale;
        }

        if (options.seed && modelConfig.apiSettings.supportsSeed) {
          input.seed = options.seed;
        }

        // –í—ã–∑–æ–≤ Fal.ai API
        const result = await fal.subscribe(modelUrl, {
          input,
          logs: false,
        });

        const generationTime = Date.now() - startTime;

        // –ü–∞—Ä—Å–∏–Ω–≥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
        const output = result as any;
        let imageUrls: string[] = [];

        if (output.images && Array.isArray(output.images)) {
          imageUrls = output.images.map((img: any) => img.url);
        } else if (output.image_url) {
          imageUrls = [output.image_url];
        } else if (output.url) {
          imageUrls = [output.url];
        } else {
          throw new Error("–ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ –æ—Ç Fal.ai");
        }

        return {
          success: true,
          imageUrls,
          metadata: {
            prompt: enhancedPrompt,
            model: modelUrl,
            generationTime,
            loraUsed: this.defaultLoRA?.path,
            triggerWord: this.defaultLoRA?.triggerWord,
          },
        } as ImageGenerationResult;
      },
      (error) => (error instanceof Error ? error : new Error(String(error)))
    );
  }

  getModelInfo(modelId: string): TaskEither<Error, ModelInfo> {
    return tryCatchAsync(
      async () => {
        const modelConfig = getImageModel(modelId);
        if (!modelConfig) {
          throw new Error(`–ú–æ–¥–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞: ${modelId}`);
        }

        return {
          id: modelConfig.id,
          name: modelConfig.name,
          provider: modelConfig.provider,
          description: modelConfig.description,
          pricePerImage: modelConfig.pricing.fixedPriceStars || 0,
          estimatedTime: 15, // –ü—Ä–∏–º–µ—Ä–Ω–æ–µ –≤—Ä–µ–º—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å LoRA
          supportedFeatures: [
            ...(modelConfig.apiSettings.supportsNegativePrompt
              ? ["negative-prompt"]
              : []),
            ...(modelConfig.apiSettings.supportsSeed ? ["seed"] : []),
            ...(modelConfig.apiSettings.supportsSteps ? ["steps"] : []),
            ...(modelConfig.apiSettings.supportsGuidanceScale
              ? ["guidance-scale"]
              : []),
            ...(modelConfig.apiSettings.supportsLoRA ? ["lora"] : []),
          ],
          aspectRatios: modelConfig.apiSettings.aspectRatios,
          maxImages: modelConfig.apiSettings.maxImages,
        };
      },
      (error) => (error instanceof Error ? error : new Error(String(error)))
    );
  }

  listModels(): TaskEither<Error, ModelInfo[]> {
    return tryCatchAsync(
      async () => {
        const models = getImageModelsByProvider("fal");
        return Promise.all(
          models.map((model) => this.getModelInfo(model.id)())
        ).then((results) =>
          results
            .filter((result) => result.isRight())
            .map((result) => (result as any).value)
        );
      },
      (error) => (error instanceof Error ? error : new Error(String(error)))
    );
  }
}
```

#### –®–∞–≥ 3.6: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ –≤ —Ä–µ–µ—Å—Ç—Ä–µ

**–§–∞–π–ª**: `src/services/providers.ts`

```typescript
import { imageProviderRegistry } from "./provider-registry";
import { ReplicateProvider } from "../providers/replicateProvider";
import { FalProvider } from "../providers/falProvider";

/**
 * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤—Å–µ—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
 */
export function initializeProviders(runtime: IAgentRuntime): void {
  // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è Replicate Provider
  const replicateApiKey = runtime.getSetting("REPLICATE_API_KEY");
  if (replicateApiKey) {
    const replicateProvider = new ReplicateProvider(replicateApiKey);
    imageProviderRegistry.register(replicateProvider);
  }

  // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è Fal.ai Provider
  const falApiKey = runtime.getSetting("FAL_KEY");
  if (falApiKey) {
    const defaultLoRA = {
      path: runtime.getSetting("FAL_DEFAULT_LORA_PATH") || "",
      scale: Number(runtime.getSetting("FAL_DEFAULT_LORA_SCALE")) || 1.0,
      triggerWord: runtime.getSetting("FAL_LORA_TRIGGER") || "NEURO_SAGE",
    };

    const falProvider = new FalProvider(falApiKey, defaultLoRA);
    imageProviderRegistry.register(falProvider);
  }

  console.log(
    `‚úÖ –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤: ${imageProviderRegistry.getAll().length}`
  );
}
```

#### –®–∞–≥ 3.7: –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—é –Ω–æ–≤–æ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞

**–ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä (–Ω–∞–ø—Ä–∏–º–µ—Ä, Kie.ai –∏–ª–∏ OpenRouter):**

1. **–î–æ–±–∞–≤–∏—Ç—å –º–æ–¥–µ–ª—å –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é** (`src/config/image-models.config.ts`):

```typescript
kie_new_model: {
  id: 'kie_new_model',
  name: 'New Kie Model',
  nameRu: '–ù–æ–≤–∞—è –º–æ–¥–µ–ª—å Kie',
  description: 'Description',
  provider: 'kie',
  apiModel: 'kie-api-model-id',
  pricing: {
    type: 'fixed',
    fixedPriceStars: 100,
  },
  apiSettings: {
    aspectRatios: ['1:1', '16:9'],
    maxImages: 4,
    supportsNegativePrompt: true,
  },
  status: 'active',
},
```

2. **–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–≤–∞–π–¥–µ—Ä** (`src/providers/kieProvider.ts`):

```typescript
import { ImageGenerationProvider } from "../types/provider.interface";
import {
  getImageModelsByProvider,
  getImageModel,
} from "../config/image-models.config";

export class KieProvider implements ImageGenerationProvider {
  name = "kie";
  description = "Kie.ai image generation";

  // –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤—Å–µ –º–µ—Ç–æ–¥—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
  // ...
}
```

3. **–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–≤–∞–π–¥–µ—Ä** (`src/services/providers.ts`):

```typescript
const kieProvider = new KieProvider(kieApiKey);
imageProviderRegistry.register(kieProvider);
```

**–ì–æ—Ç–æ–≤–æ!** –ù–æ–≤—ã–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ—Å—Ç—É–ø–µ–Ω —á–µ—Ä–µ–∑ —Ä–µ–µ—Å—Ç—Ä.

**–§–∞–π–ª**: `src/services/falService.ts`

```typescript
import { Service, IAgentRuntime } from "@elizaos/core";
import {
  TaskEither,
  tryCatchAsync,
  left,
} from "@/core/functional/utils/result";
import { pipe, chain } from "@/core/functional/utils/composition";
import { validate } from "@/core/validation/validate";
import { GenerateImageOptions, ImageGenerationResult } from "../types";
import { GenerateImageInputSchema } from "../types/schemas";

export class FalService extends Service {
  static serviceType = "fal";

  private apiKey: string | null = null;

  capabilityDescription =
    "AI image generation using Fal.ai API with LoRA support";

  async initialize(runtime: IAgentRuntime): Promise<void> {
    const apiKey = runtime.getSetting("FAL_KEY");

    if (!apiKey) {
      throw new Error("FAL_KEY –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö");
    }

    this.apiKey = apiKey;
  }

  async start(): Promise<void> {
    console.log("üöÄ Fal Service started");
  }

  async stop(): Promise<void> {
    this.apiKey = null;
    console.log("üõë Fal Service stopped");
  }

  /**
   * –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ Fal.ai (—Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π LoRA)
   */
  generateImage(
    options: GenerateImageOptions
  ): TaskEither<Error, ImageGenerationResult> {
    if (!this.apiKey) {
      return left(new Error("Fal Service –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω"));
    }

    // –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Fal.ai API
    // (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ ReplicateService, –Ω–æ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π LoRA)
    // ...
  }
}
```

---

### –§–∞–∑–∞ 4: –°–æ–∑–¥–∞–Ω–∏–µ Provider (20 –º–∏–Ω—É—Ç)

#### –®–∞–≥ 4.1: –°–æ–∑–¥–∞–Ω–∏–µ NeuroPhotoProvider

**–§–∞–π–ª**: `src/providers/neuroPhotoProvider.ts`

```typescript
import {
  Provider,
  IAgentRuntime,
  Memory,
  State,
  ProviderResult,
} from "@elizaos/core";

export const neuroPhotoProvider: Provider = {
  name: "neuroPhotoProvider",

  get: async (
    runtime: IAgentRuntime,
    message: Memory,
    state?: State
  ): Promise<ProviderResult> => {
    const defaultModel =
      runtime.getSetting("DEFAULT_MODEL") || "black-forest-labs/flux-schnell";

    return {
      text: `
# üé® NeuroPhoto - AI Image Generation

## Available Commands
- \`/neurophoto <–æ–ø–∏—Å–∞–Ω–∏–µ>\` - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è AI-–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
- \`–Ω–∞—Ä–∏—Å—É–π <–æ–ø–∏—Å–∞–Ω–∏–µ>\` - –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ (—Ä—É—Å—Å–∫–∏–π)
- \`create image <–æ–ø–∏—Å–∞–Ω–∏–µ>\` - –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ (–∞–Ω–≥–ª–∏–π—Å–∫–∏–π)

## Current Configuration
- **Default Model**: ${defaultModel}
- **Generation Time**: 10-30 seconds
- **Image Format**: 9:16 (vertical, –¥–ª—è Instagram Stories)
- **Cost**: 7.5‚≠ê per image

## Examples
‚úÖ **Good prompts**:
- "/neurophoto beautiful sunset over the ocean"
- "–Ω–∞—Ä–∏—Å—É–π —Ñ—É—Ç—É—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∏–π –≥–æ—Ä–æ–¥ —Å –ª–µ—Ç–∞—é—â–∏–º–∏ –º–∞—à–∏–Ω–∞–º–∏"
- "create image of a cat in a spacesuit"

‚ùå **Bad prompts**:
- "/neurophoto cat" (too short, not descriptive)
- "–Ω–∞—Ä–∏—Å—É–π" (no description)

## Tips for Better Results
1. Be specific and descriptive
2. Include details about style, colors, mood
3. Mention lighting and composition
4. Use English for best results with most models

## Available Models
- **Flux Schnell**: Fast, high-quality images (default)
- **Flux Pro**: Premium quality, slower
- **SDXL**: General-purpose, reliable
      `.trim(),
      values: {
        defaultModel,
        supportedCommands: [
          "/neurophoto",
          "–Ω–∞—Ä–∏—Å—É–π",
          "—Å–æ–∑–¥–∞–π –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ",
          "create image",
        ],
        cost: 7.5,
        currency: "stars",
      },
    };
  },
};
```

---

### –§–∞–∑–∞ 5: –°–æ–∑–¥–∞–Ω–∏–µ Action (60 –º–∏–Ω—É—Ç)

#### –®–∞–≥ 5.1: –°–æ–∑–¥–∞–Ω–∏–µ generateImageAction

**–§–∞–π–ª**: `src/actions/generateImage.ts`

```typescript
import {
  Action,
  IAgentRuntime,
  Memory,
  State,
  HandlerCallback,
  ActionExample,
} from "@elizaos/core";
import {
  TaskEither,
  tryCatchAsync,
  right,
  left,
} from "@/core/functional/utils/result";
import { pipe, chain, map, tapTask } from "@/core/functional/utils/composition";
import { validate } from "@/core/validation/validate";
import {
  GenerateImageInputSchema,
  NeuroPhotoActionContextSchema,
} from "../types/schemas";
import { ReplicateService } from "../services/replicateService";
import { FalService } from "../services/falService";
import { db } from "@/core/drizzle/client";
import { operations, assets, users, balances } from "@/core/drizzle/schema";
import { eq, and } from "drizzle-orm";
import { sql } from "drizzle-orm";

const COST_STARS = 7.5;

export const generateImageAction: Action = {
  name: "GENERATE_NEUROPHOTO",
  similes: [
    "MAKE_IMAGE",
    "CREATE_PHOTO",
    "NEUROPHOTO",
    "GENERATE_IMAGE",
    "AI_IMAGE",
    "DRAW_IMAGE",
  ],
  description: `–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç AI-–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å –ø–æ–º–æ—â—å—é Flux/SDXL –º–æ–¥–µ–ª–µ–π.
–ò—Å–ø–æ–ª—å–∑—É–π –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:
- –ü—Ä–æ—Å–∏—Ç –Ω–∞—Ä–∏—Å–æ–≤–∞—Ç—å/—Å–æ–∑–¥–∞—Ç—å/—Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
- –•–æ—á–µ—Ç —É–≤–∏–¥–µ—Ç—å –∫–∞–∫ —á—Ç–æ-—Ç–æ –≤—ã–≥–ª—è–¥–∏—Ç
- –°–ø—Ä–∞—à–∏–≤–∞–µ—Ç "–ø–æ–∫–∞–∂–∏...", "—Å–¥–µ–ª–∞–π —Ñ–æ—Ç–æ...", "–Ω–∞—Ä–∏—Å—É–π..."
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–æ–º–∞–Ω–¥—É /neurophoto
–ù–µ —Ç—Ä–µ–±—É–µ—Ç —Å—Ç—Ä–æ–≥–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞ –∫–æ–º–∞–Ω–¥—ã - –ø–æ–Ω–∏–º–∞–µ—Ç –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —è–∑—ã–∫.`,

  /**
   * –í–∞–ª–∏–¥–∞—Ü–∏—è - –¥–æ–ª–∂–Ω–∞ –ª–∏ –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è —ç—Ç–∞ action?
   */
  validate: async (
    runtime: IAgentRuntime,
    message: Memory
  ): Promise<boolean> => {
    const text = message.content?.text?.toLowerCase();

    if (!text) return false;

    // –ü—Ä—è–º—ã–µ –∫–æ–º–∞–Ω–¥—ã (–≤—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
    const commands = ["/neurophoto", "–Ω–µ–π—Ä–æ—Ñ–æ—Ç–æ", "neurophoto"];
    if (commands.some((cmd) => text.includes(cmd))) {
      return true;
    }

    // –ò–Ω—Ç–µ–Ω—Ç—ã (–µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —è–∑—ã–∫)
    const intents = [
      // –†—É—Å—Å–∫–∏–π
      "–Ω–∞—Ä–∏—Å—É–π",
      "—Å–æ–∑–¥–∞–π –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ",
      "—Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π",
      "—Å–¥–µ–ª–∞–π –∫–∞—Ä—Ç–∏–Ω–∫",
      "—Ö–æ—á—É —Ñ–æ—Ç–æ",
      "–ø–æ–∫–∞–∂–∏ –∫–∞–∫ –≤—ã–≥–ª—è–¥–∏—Ç",
      "—Å–¥–µ–ª–∞–π —Ñ–æ—Ç–æ",

      // English
      "generate image",
      "create image",
      "draw",
      "make a picture",
      "show me how",
      "can you draw",
      "make an image",
    ];

    return intents.some((intent) => text.includes(intent));
  },

  /**
   * –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–µ–π—Å—Ç–≤–∏—è
   * –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Å—Ç–∏–ª—å —Å TaskEither
   */
  handler: async (
    runtime: IAgentRuntime,
    message: Memory,
    state: State | undefined,
    options,
    callback?: HandlerCallback
  ) => {
    try {
      // –ò–∑–≤–ª–µ–∫–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ —Å–æ–æ–±—â–µ–Ω–∏—è
      const text = message.content?.text || "";
      const telegramId = message.userId;

      if (!telegramId) {
        await callback?.({
          text: "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.",
        });
        return {
          success: false,
          error: new Error("User ID not found"),
        };
      }

      // –ò–∑–≤–ª–µ–∫–∞–µ–º –ø—Ä–æ–º–ø—Ç –∏–∑ —Ç–µ–∫—Å—Ç–∞
      const prompt = extractPrompt(text);

      if (!prompt || prompt.length < 3) {
        await callback?.({
          text: `‚ùå –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–ø–∏—à–∏—Ç–µ –∫–∞–∫–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—ã —Ö–æ—Ç–∏—Ç–µ —Å–æ–∑–¥–∞—Ç—å.

**–ü—Ä–∏–º–µ—Ä—ã**:
‚Ä¢ /neurophoto –∫—Ä–∞—Å–∏–≤—ã–π –∑–∞–∫–∞—Ç –Ω–∞–¥ –æ–∫–µ–∞–Ω–æ–º
‚Ä¢ /neurophoto —Ñ—É—Ç—É—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∏–π –≥–æ—Ä–æ–¥ —Å –ª–µ—Ç–∞—é—â–∏–º–∏ –º–∞—à–∏–Ω–∞–º–∏
‚Ä¢ /neurophoto –ø–æ—Ä—Ç—Ä–µ—Ç –∫–æ—Ç–∞ –≤ –∫–æ—Å–º–∏—á–µ—Å–∫–æ–º —à–ª–µ–º–µ

–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –æ–ø–∏—Å–∞–Ω–∏—è: 3 —Å–∏–º–≤–æ–ª–∞.`,
        });
        return {
          success: false,
          error: new Error("–ü—Ä–æ–º–ø—Ç —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π"),
        };
      }

      // –£–≤–µ–¥–æ–º–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ –Ω–∞—á–∞–ª–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
      await callback?.({
        text: "üé® –ì–µ–Ω–µ—Ä–∏—Ä—É—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ, —ç—Ç–æ –∑–∞–π–º—ë—Ç 10-30 —Å–µ–∫—É–Ω–¥...",
      });

      // –ü–æ–ª—É—á–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –ë–î
      const [user] = await db
        .select()
        .from(users)
        .where(eq(users.telegram_id, Number(telegramId)))
        .limit(1);

      if (!user) {
        await callback?.({
          text: "‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.",
        });
        return {
          success: false,
          error: new Error("User not found"),
        };
      }

      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–∞–ª–∞–Ω—Å
      const [balance] = await db
        .select()
        .from(balances)
        .where(eq(balances.user_id, user.id))
        .limit(1);

      if (!balance) {
        await callback?.({
          text: "‚ùå –ë–∞–ª–∞–Ω—Å –Ω–µ –Ω–∞–π–¥–µ–Ω.",
        });
        return {
          success: false,
          error: new Error("Balance not found"),
        };
      }

      const currentStars = (balance.currencies as any)?.stars || 0;

      if (currentStars < COST_STARS) {
        await callback?.({
          text: `‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–∞–ª–∞–Ω—Å–∞. –¢—Ä–µ–±—É–µ—Ç—Å—è: ${COST_STARS}‚≠ê, –£ –≤–∞—Å: ${currentStars}‚≠ê`,
        });
        return {
          success: false,
          error: new Error("Insufficient balance"),
        };
      }

      // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ (Replicate –∏–ª–∏ Fal)
      const provider = runtime.getSetting("IMAGE_PROVIDER") || "replicate";

      let service: ReplicateService | FalService;

      if (provider === "fal") {
        const falService = runtime.getService<FalService>("fal");
        if (!falService) {
          await callback?.({
            text: "‚ùå –°–µ—Ä–≤–∏—Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π Fal.ai –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω.",
          });
          return {
            success: false,
            error: new Error("Fal.ai service not available"),
          };
        }
        service = falService;
      } else {
        const replicateService =
          runtime.getService<ReplicateService>("replicate");
        if (!replicateService) {
          await callback?.({
            text: "‚ùå –°–µ—Ä–≤–∏—Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π Replicate –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω.",
          });
          return {
            success: false,
            error: new Error("Replicate service not available"),
          };
        }
        service = replicateService;
      }

      // –§–æ—Ä–º–∏—Ä—É–µ–º –ø–æ–ª–Ω—ã–π –ø—Ä–æ–º–ø—Ç —Å trigger_word –∏ gender
      const userData = await getUserData(telegramId.toString());
      let genderPromptPart = "person";
      if (userData?.gender === "female") {
        genderPromptPart = "female";
      } else if (userData?.gender === "male") {
        genderPromptPart = "male";
      }

      const detailPrompt = `Cinematic Lighting, ethereal light, intricate details, extremely detailed, incredible details, full colored, complex details, insanely detailed and intricate, hypermaximalist, extremely detailed with rich colors. masterpiece, best quality, aerial view, HDR, UHD, unreal engine, Representative, fair skin, beautiful face, Rich in details High quality, gorgeous, glamorous, 8k, super detail, gorgeous light and shadow, detailed decoration, detailed lines`;

      const fullPrompt = `Fashionable ${userModel.trigger_word} ${genderPromptPart}, ${prompt}, ${detailPrompt}`;

      // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º —á–µ—Ä–µ–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ñ—É–Ω–∫—Ü–∏—é
      const result = await pipe(
        // 1. –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        validate(GenerateImageInputSchema, {
          prompt: fullPrompt,
          aspectRatio: "9:16",
          numImages: 1,
        }),
        chain(async (validated) => {
          // 2. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ generateNeuroPhotoHybrid —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π –º–æ–¥–µ–ª—å—é
          const { generateNeuroPhotoHybrid } = await import(
            "@/services/generateNeuroPhotoHybrid"
          );

          const generationResult = await generateNeuroPhotoHybrid(
            validated.prompt,
            userModel.model_url,
            validated.numImages || 1,
            telegramId.toString(),
            ctx,
            bot_name
          );

          if (!generationResult || !generationResult.success) {
            throw new Error(generationResult?.error || "Generation failed");
          }

          return {
            success: true,
            imageUrls: generationResult.urls || [],
            metadata: {
              prompt: validated.prompt,
              model: userModel.model_url,
              triggerWord: userModel.trigger_word,
              generationTime: 0, // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∏–∑–º–µ—Ä–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏
            },
          };
        }),
        chain(async (generationResult) => {
          // 3. –†–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é
          const costResult = await calculateNeuroPhotoCostTask(
            generationResult.imageUrls.length
          )();

          if (costResult.isLeft()) {
            throw new Error("Failed to calculate cost");
          }

          const costStars = costResult.value;

          // 4. –ê—Ç–æ–º–∞—Ä–Ω–æ–µ —Å–ø–∏—Å–∞–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
          await db.transaction(async (tx) => {
            // –ë–ª–æ–∫–∏—Ä—É–µ–º —Å—Ç—Ä–æ–∫—É –±–∞–ª–∞–Ω—Å–∞
            const [lockedBalance] = await tx
              .select()
              .from(balances)
              .where(eq(balances.user_id, user.id))
              .for("update")
              .limit(1);

            if (!lockedBalance) {
              throw new Error("Balance not found");
            }

            const currentStars = (lockedBalance.currencies as any)?.stars || 0;
            if (currentStars < costStars) {
              throw new Error("Insufficient balance");
            }

            // –°–ø–∏—Å–∞–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
            await tx.execute(sql`
              UPDATE balances
              SET currencies = jsonb_set(
                currencies,
                '{stars}',
                ((currencies->>'stars')::numeric - ${costStars})::text::jsonb
              ),
              updated_at = NOW()
              WHERE user_id = ${user.id}
            `);

            // –°–æ–∑–¥–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
            const [operation] = await tx
              .insert(operations)
              .values({
                user_id: user.id,
                type: "NEUROPHOTO",
                service_type: "neuro_photo",
                status: "completed",
                cost: {
                  stars: costStars,
                },
                result: generationResult as any,
                metadata: {
                  prompt: fullPrompt,
                  model: userModel.model_url,
                  model_name: userModel.model_name,
                  trigger_word: userModel.trigger_word,
                  num_images: generationResult.imageUrls.length,
                  generationTime: generationResult.metadata.generationTime,
                },
              })
              .returning();

            // –°–æ–∑–¥–∞–Ω–∏–µ asset –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
            for (const imageUrl of generationResult.imageUrls) {
              await tx.insert(assets).values({
                user_id: user.id,
                type: "image",
                url: imageUrl,
                metadata: {
                  operation_id: operation.id,
                  prompt,
                  model: generationResult.metadata.model,
                },
              });
            }
          });

          return generationResult;
        })
      )();

      if (result.isLeft()) {
        await callback?.({
          text: `‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏: ${result.value.message}`,
        });
        return {
          success: false,
          error: result.value,
        };
      }

      const generationResult = result.value;

      // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      const modelDisplay = userModel.model_name || "–í–∞—à–∞ –º–æ–¥–µ–ª—å";

      const resultText = `‚ú® **–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–æ!**

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üìù **–ü—Ä–æ–º–ø—Ç**
${prompt}

üé® **–î–µ—Ç–∞–ª–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏**
‚îú ü§ñ –ú–æ–¥–µ–ª—å: **${modelDisplay}**
‚îú üîë Trigger: **${userModel.trigger_word}**
‚îú üìê –†–∞–∑–º–µ—Ä: **768√ó1365** (9:16)
‚îú ‚è± –í—Ä–µ–º—è: **${Math.round(generationResult.metadata.generationTime / 1000)}—Å**
‚îî üí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å: **${costStars}‚≠ê**

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üîç **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è**
Model URL: \`${userModel.model_url}\`
Trigger Word: \`${userModel.trigger_word}\`
Generated: ${new Date().toLocaleString("ru-RU")}

_–°–æ–∑–¥–∞–Ω–æ —Å –ø–æ–º–æ—â—å—é –≤–∞—à–µ–π –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–π –º–æ–¥–µ–ª–∏ ‚Ä¢ @999-agents_`;

      // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
      await callback?.({
        text: resultText,
        attachments: generationResult.imageUrls.map((url, index) => ({
          id: `neurophoto-${Date.now()}-${index}`,
          url,
          type: "image",
          title: prompt,
          description: `Generated by ${modelDisplay}`,
        })),
      });

      return {
        success: true,
        text: "–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ",
        data: {
          imageUrls: generationResult.imageUrls,
          prompt,
          model: generationResult.metadata.model,
          generationTime: generationResult.metadata.generationTime,
        },
      };
    } catch (error) {
      await callback?.({
        text: "‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –Ω–µ–ø—Ä–µ–¥–≤–∏–¥–µ–Ω–Ω–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.",
      });
      return {
        success: false,
        error: error instanceof Error ? error : new Error(String(error)),
      };
    }
  },

  /**
   * –ü—Ä–∏–º–µ—Ä—ã –¥–ª—è –æ–±—É—á–µ–Ω–∏—è LLM
   */
  examples: [
    [
      {
        name: "user",
        content: { text: "/neurophoto –∫—Ä–∞—Å–∏–≤—ã–π –∑–∞–∫–∞—Ç –Ω–∞–¥ –æ–∫–µ–∞–Ω–æ–º" },
      },
      {
        name: "assistant",
        content: {
          text: "‚úÖ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ!",
          action: "GENERATE_NEUROPHOTO",
        },
      },
    ],
    [
      {
        name: "user",
        content: { text: "–Ω–∞—Ä–∏—Å—É–π —Ñ—É—Ç—É—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∏–π –≥–æ—Ä–æ–¥" },
      },
      {
        name: "assistant",
        content: {
          text: "üé® –ì–µ–Ω–µ—Ä–∏—Ä—É—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ...",
          action: "GENERATE_NEUROPHOTO",
        },
      },
    ],
  ] as ActionExample[][],
};

/**
 * –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞ –∏–∑ —Ç–µ–∫—Å—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
 */
function extractPrompt(text: string): string {
  return text
    .replace(/\/neurophoto/gi, "")
    .replace(/\/generate/gi, "")
    .replace(/–Ω–µ–π—Ä–æ—Ñ–æ—Ç–æ/gi, "")
    .replace(/—Å–æ–∑–¥–∞–π –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ/gi, "")
    .replace(/—Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π –∫–∞—Ä—Ç–∏–Ω–∫—É/gi, "")
    .replace(/–Ω–∞—Ä–∏—Å—É–π/gi, "")
    .replace(/generate image/gi, "")
    .replace(/create image/gi, "")
    .replace(/draw/gi, "")
    .trim();
}
```

---

### –§–∞–∑–∞ 6: –°–æ–∑–¥–∞–Ω–∏–µ –≥–ª–∞–≤–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ –ø–ª–∞–≥–∏–Ω–∞ (15 –º–∏–Ω—É—Ç)

#### –®–∞–≥ 6.1: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ index.ts

**–§–∞–π–ª**: `src/index.ts`

```typescript
/**
 * @999-agents/plugin-vibe-avatar-face
 * ElizaOS plugin for AI image generation
 *
 * @author 999-agents
 * @license MIT
 * @version 1.0.0
 */

import { Plugin } from "@elizaos/core";
import { generateImageAction } from "./actions/generateImage";
import { neuroPhotoProvider } from "./providers/neuroPhotoProvider";
import { ReplicateService } from "./services/replicateService";
import { FalService } from "./services/falService";

/**
 * NeuroPhoto Plugin for ElizaOS
 *
 * Provides AI image generation capabilities using Replicate/Fal.ai APIs
 */
export const neuroPhotoPlugin: Plugin = {
  name: "neurophoto",
  description: "AI image generation with Replicate/Fal.ai models",

  /**
   * Actions that the agent can perform
   */
  actions: [generateImageAction],

  /**
   * Providers that give context to the LLM
   */
  providers: [neuroPhotoProvider],

  /**
   * Services that handle external integrations
   */
  services: [new ReplicateService(), new FalService()],

  /**
   * Evaluators (none for MVP)
   */
  evaluators: [],

  /**
   * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–ª–∞–≥–∏–Ω–∞
   */
  init: async (config, runtime) => {
    console.log("‚úÖ NeuroPhoto plugin initialized");
  },
};

/**
 * Export everything for external use
 */
export * from "./types";
export * from "./actions/generateImage";
export * from "./providers/neuroPhotoProvider";
export * from "./services/replicateService";
export * from "./services/falService";

/**
 * Default export
 */
export default neuroPhotoPlugin;
```

---

### –§–∞–∑–∞ 7: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (60 –º–∏–Ω—É—Ç)

#### –®–∞–≥ 7.1: –°–æ–∑–¥–∞–Ω–∏–µ unit —Ç–µ—Å—Ç–æ–≤

**–§–∞–π–ª**: `src/__tests__/actions/generateImage.test.ts`

```typescript
import { describe, it, expect, beforeEach, vi } from "vitest";
import { generateImageAction } from "../../actions/generateImage";
import { IAgentRuntime, Memory } from "@elizaos/core";

describe("generateImageAction", () => {
  let mockRuntime: IAgentRuntime;

  beforeEach(() => {
    mockRuntime = {
      getSetting: vi.fn(),
      getService: vi.fn(),
    } as any;
  });

  describe("validate", () => {
    it("should return true for /neurophoto command", async () => {
      const message: Memory = {
        content: { text: "/neurophoto beautiful sunset" },
      } as Memory;

      const result = await generateImageAction.validate(mockRuntime, message);
      expect(result).toBe(true);
    });

    it('should return true for "–Ω–∞—Ä–∏—Å—É–π" intent', async () => {
      const message: Memory = {
        content: { text: "–Ω–∞—Ä–∏—Å—É–π –∫–æ—Ç–∞" },
      } as Memory;

      const result = await generateImageAction.validate(mockRuntime, message);
      expect(result).toBe(true);
    });

    it("should return false for unrelated message", async () => {
      const message: Memory = {
        content: { text: "–ø—Ä–∏–≤–µ—Ç –∫–∞–∫ –¥–µ–ª–∞" },
      } as Memory;

      const result = await generateImageAction.validate(mockRuntime, message);
      expect(result).toBe(false);
    });
  });

  // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã...
});
```

#### –®–∞–≥ 7.2: –°–æ–∑–¥–∞–Ω–∏–µ integration —Ç–µ—Å—Ç–æ–≤

**–§–∞–π–ª**: `src/__tests__/integration/neuroPhoto.test.ts`

```typescript
import { describe, it, expect } from "vitest";
import { neuroPhotoPlugin } from "../../index";

describe("NeuroPhoto Plugin Integration", () => {
  it("should have all required components", () => {
    expect(neuroPhotoPlugin.actions).toBeDefined();
    expect(neuroPhotoPlugin.actions?.length).toBeGreaterThan(0);
    expect(neuroPhotoPlugin.providers).toBeDefined();
    expect(neuroPhotoPlugin.services).toBeDefined();
  });

  // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã...
});
```

---

### –§–∞–∑–∞ 8: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –±–æ—Ç–∞ (30 –º–∏–Ω—É—Ç)

#### –®–∞–≥ 8.1: –ò–º–ø–æ—Ä—Ç –ø–ª–∞–≥–∏–Ω–∞ –≤ –≥–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª

**–§–∞–π–ª**: `src/character.ts` –∏–ª–∏ `src/bot.ts`

```typescript
import { Character } from "@elizaos/core";
import { neuroPhotoPlugin } from "@999-agents/plugin-vibe-avatar-face";

export const character: Character = {
  name: "NeuroBlogger",

  plugins: [
    "@elizaos/plugin-bootstrap",
    "@elizaos/plugin-telegram",
    neuroPhotoPlugin, // üëà –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞—à –ø–ª–∞–≥–∏–Ω
  ],

  settings: {
    REPLICATE_API_KEY: process.env.REPLICATE_API_KEY,
    FAL_KEY: process.env.FAL_KEY,
    DEFAULT_MODEL: "black-forest-labs/flux-schnell",
    IMAGE_PROVIDER: "replicate", // –∏–ª–∏ 'fal'
  },
};
```

#### –®–∞–≥ 8.2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

**–§–∞–π–ª**: `.env`

```bash
REPLICATE_API_KEY=r8_your_replicate_api_key_here
FAL_KEY=your_fal_key_here
DEFAULT_MODEL=black-forest-labs/flux-schnell
IMAGE_PROVIDER=replicate
```

---

### –§–∞–∑–∞ 9: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è (30 –º–∏–Ω—É—Ç)

#### –®–∞–≥ 9.1: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤

```bash
cd packages/plugin-vibe-avatar-face
npm run typecheck
# –∏–ª–∏
tsc --noEmit
```

#### –®–∞–≥ 9.2: –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```bash
npm test
# –∏–ª–∏
npm run test:coverage
```

#### –®–∞–≥ 9.3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–Ω—Ç–µ—Ä–∞

```bash
npm run lint
# –∏–ª–∏
npm run lint:fix
```

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞

- [ ] –í—ã–ø–æ–ª–Ω–µ–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ `elizaos plugins create vibe-avatar-face`
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
- [ ] –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (`npm install`)

### –¢–∏–ø—ã –∏ —Å—Ö–µ–º—ã

- [ ] –°–æ–∑–¥–∞–Ω—ã Zod —Å—Ö–µ–º—ã (`GenerateImageInputSchema`, `GenerateImageOutputSchema`)
- [ ] –°–æ–∑–¥–∞–Ω—ã TypeScript —Ç–∏–ø—ã (`GenerateImageInput`, `GenerateImageOutput`)
- [ ] –°–æ–∑–¥–∞–Ω —Ç–∏–ø –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (`NeuroPhotoActionContext`)

### Services –∏ Providers

- [ ] –°–æ–∑–¥–∞–Ω –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `ImageGenerationProvider`
- [ ] –°–æ–∑–¥–∞–Ω —Ä–µ–µ—Å—Ç—Ä –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ `ImageProviderRegistry`
- [ ] –°–æ–∑–¥–∞–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–æ–¥–µ–ª–µ–π `IMAGE_MODELS` —Å 10+ –º–æ–¥–µ–ª—è–º–∏
- [ ] –°–æ–∑–¥–∞–Ω `ReplicateProvider` (—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞)
- [ ] –°–æ–∑–¥–∞–Ω `FalProvider` (–¥–ª—è LoRA –∏ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏)
- [ ] –ü—Ä–æ–≤–∞–π–¥–µ—Ä—ã –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ —Ä–µ–µ—Å—Ç—Ä–µ
- [ ] –í—Å–µ –º–µ—Ç–æ–¥—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç `TaskEither`
- [ ] –î–æ–±–∞–≤–ª–µ–Ω–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—é –Ω–æ–≤—ã—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤

### Providers

- [ ] –°–æ–∑–¥–∞–Ω `neuroPhotoProvider`
- [ ] Provider –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `ProviderResult` –æ–±—ä–µ–∫—Ç (–Ω–µ —Å—Ç—Ä–æ–∫—É)
- [ ] –î–æ–±–∞–≤–ª–µ–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–º–∞–Ω–¥–∞—Ö –∏ –ø—Ä–∏–º–µ—Ä–∞—Ö

### Actions

- [ ] –°–æ–∑–¥–∞–Ω `generateImageAction`
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –º–µ—Ç–æ–¥ `validate`
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –º–µ—Ç–æ–¥ `handler` –≤ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–º —Å—Ç–∏–ª–µ
- [ ] –î–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–∏–º–µ—Ä—ã –¥–ª—è –æ–±—É—á–µ–Ω–∏—è LLM
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —á–µ—Ä–µ–∑ `TaskEither`

### –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª

- [ ] –û–±–Ω–æ–≤–ª–µ–Ω `src/index.ts`
- [ ] –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –æ–±—ä–µ–∫—Ç `Plugin`
- [ ] –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ø–æ–¥–∫–ª—é—á–µ–Ω—ã (actions, providers, services)

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

- [ ] –°–æ–∑–¥–∞–Ω—ã unit —Ç–µ—Å—Ç—ã –¥–ª—è `validate`
- [ ] –°–æ–∑–¥–∞–Ω—ã unit —Ç–µ—Å—Ç—ã –¥–ª—è `handler`
- [ ] –°–æ–∑–¥–∞–Ω—ã integration —Ç–µ—Å—Ç—ã
- [ ] –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç (100% –ø–æ–∫—Ä—ã—Ç–∏–µ)

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

- [ ] –ü–ª–∞–≥–∏–Ω –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –≤ `src/character.ts`
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- [ ] –ü–ª–∞–≥–∏–Ω –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –≤ —Å–∏—Å—Ç–µ–º–µ

### –í–∞–ª–∏–¥–∞—Ü–∏—è

- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤ –ø—Ä–æ—Ö–æ–¥–∏—Ç –±–µ–∑ –æ—à–∏–±–æ–∫
- [ ] –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- [ ] –õ–∏–Ω—Ç–µ—Ä –Ω–µ –≤—ã–¥–∞–µ—Ç –æ—à–∏–±–æ–∫
- [ ] –ü–ª–∞–≥–∏–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –±–æ—Ç–µ

---

## üö® –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

### 1. –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Å—Ç–∏–ª—å

- ‚úÖ –í—Å–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ `TaskEither`
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `pipe` –¥–ª—è –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏
- ‚úÖ –ù–µ—Ç `throw/catch` - –æ—à–∏–±–∫–∏ —á–µ—Ä–µ–∑ `Either`
- ‚úÖ –ò–º–º—É—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

### 2. –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

- ‚úÖ –í—Å–µ –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ Zod
- ‚úÖ Runtime type safety
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è TypeScript —Ç–∏–ø–æ–≤

### 3. –†–∞–±–æ—Ç–∞ —Å –ë–î

- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Drizzle ORM
- ‚úÖ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç–∏
- ‚úÖ –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Å—Ç—Ä–æ–∫ (`SELECT FOR UPDATE`)

### 4. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

- ‚úÖ –í—Å–µ –æ—à–∏–±–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ `TaskEither`
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –ø–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫

### 5. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

- ‚úÖ TDD –ø–æ–¥—Ö–æ–¥ (—Å–Ω–∞—á–∞–ª–∞ —Ç–µ—Å—Ç—ã, –ø–æ—Ç–æ–º –∫–æ–¥)
- ‚úÖ 100% –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏
- ‚úÖ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

---

## üìö –†–µ—Å—É—Ä—Å—ã

- **ElizaOS Documentation**: https://docs.elizaos.ai/
- **Plugin Development Guide**: https://docs.elizaos.ai/guides/create-a-plugin
- **Replicate API**: https://replicate.com/docs
- **Fal.ai API**: https://fal.ai/docs
- **Drizzle ORM**: https://orm.drizzle.team/
- **Zod**: https://zod.dev/

---

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö —à–∞–≥–æ–≤ —É —Ç–µ–±—è –±—É–¥–µ—Ç:

1. ‚úÖ –†–∞–±–æ—Ç–∞—é—â–∏–π ElizaOS –ø–ª–∞–≥–∏–Ω –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
2. ‚úÖ –ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Replicate/Fal.ai
3. ‚úÖ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Å—Ç–∏–ª—å –∫–æ–¥–∞
4. ‚úÖ 100% –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏
5. ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
6. ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –±–∞–ª–∞–Ω—Å–∞ –∏ –æ–ø–µ—Ä–∞—Ü–∏–π
7. ‚úÖ –û—Ç–ø—Ä–∞–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

**–í—Ä–µ–º—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏**: 3-4 —á–∞—Å–∞  
**–°–ª–æ–∂–Ω–æ—Å—Ç—å**: –°—Ä–µ–¥–Ω—è—è  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: –í—ã—Å–æ–∫–∏–π (–ø–µ—Ä–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–∞–π–ø–ª–∞–π–Ω–∞)

---

**üöÄ –ì–æ—Ç–æ–≤ –Ω–∞—á–∞—Ç—å? –°–ª–µ–¥—É–π –ø–ª–∞–Ω—É —à–∞–≥ –∑–∞ —à–∞–≥–æ–º!**
