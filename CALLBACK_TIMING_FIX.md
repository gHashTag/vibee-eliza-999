# üéØ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï CALLBACK TIMING - –†–ï–®–ï–ù–ò–ï –ü–†–û–ë–õ–ï–ú–´

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞
**–ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ "–ª–æ–≥–∏–Ω" –≤–∏–¥–∂–µ—Ç –º–∏–≥–∞–ª, –Ω–æ –Ω–µ –ø–µ—Ä–µ—Ö–æ–¥–∏–ª –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É Eliza OS**

–ò–∑ –ª–æ–≥–æ–≤ –±—ã–ª–æ –≤–∏–¥–Ω–æ:
- ‚úÖ –í–∏–¥–∂–µ—Ç –∑–∞–≥—Ä—É–∂–∞–ª—Å—è —É—Å–ø–µ—à–Ω–æ
- ‚úÖ Callback —Å–æ–∑–¥–∞–≤–∞–ª—Å—è
- ‚ùå **Callback –ù–ï –≤—ã–∑—ã–≤–∞–ª—Å—è** –ø—Ä–∏ –∫–ª–∏–∫–µ (–Ω–µ—Ç –ª–æ–≥–æ–≤ "=== –ü–û–õ–£–ß–ï–ù–´ –î–ê–ù–ù–´–ï –û–¢ TELEGRAM ===")
- ‚ùå –ù–µ—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ `/api/auth/login`

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –ü—Ä–∏—á–∏–Ω–∞ –ø—Ä–æ–±–ª–µ–º—ã:
**Callback —Å–æ–∑–¥–∞–≤–∞–ª—Å—è –ü–û–°–õ–ï –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–∂–µ—Ç–∞!**

–ü–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ë–´–õ:
1. React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è
2. **–í–∏–¥–∂–µ—Ç –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è** (–∏—â–µ—Ç `window.onTelegramAuth`)
3. Callback —Å–æ–∑–¥–∞–µ—Ç—Å—è (—Å–ª–∏—à–∫–æ–º –ø–æ–∑–¥–Ω–æ!)
4. –í–∏–¥–∂–µ—Ç –Ω–µ –º–æ–∂–µ—Ç –Ω–∞–π—Ç–∏ callback –∏ –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç –µ–≥–æ

### –ü–æ—á–µ–º—É —ç—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ:
```typescript
export default function LoginPage() {
  // Callback —Å–æ–∑–¥–∞–≤–∞–ª—Å—è –í–ù–£–¢–†–ò –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
  if (typeof window !== 'undefined' && !window.onTelegramAuth) {
    window.onTelegramAuth = async (user: any) => { ... };
  }

  useEffect(() => {
    loadTelegramWidget(); // –í–∏–¥–∂–µ—Ç –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∑–¥–µ—Å—å
  }, []);
}
```

**–í–∏–¥–∂–µ—Ç –∑–∞–≥—Ä—É–∂–∞–ª—Å—è –î–û —Å–æ–∑–¥–∞–Ω–∏—è callback!**

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:

#### 1. Callback —Å–æ–∑–¥–∞–µ—Ç—Å—è –ì–õ–û–ë–ê–õ–¨–ù–û, –¥–æ React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
```typescript
// –í–ê–ñ–ù–û: –°–æ–∑–¥–∞–µ–º callback –ì–õ–û–ë–ê–õ–¨–ù–û, –¥–æ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–∂–µ—Ç–∞!
if (typeof window !== 'undefined' && !window.onTelegramAuth) {
  console.log('üîî [GLOBAL] –°–æ–∑–¥–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–π onTelegramAuth –î–û –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–∂–µ—Ç–∞');
  window.onTelegramAuth = (user: any) => {
    console.log('üîî [GLOBAL] === –ü–û–õ–£–ß–ï–ù–´ –î–ê–ù–ù–´–ï –û–¢ TELEGRAM ===');

    // –°–æ–∑–¥–∞–µ–º —Å–æ–±—ã—Ç–∏–µ –¥–ª—è React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
    const event = new CustomEvent('telegramAuthSuccess', { detail: user });
    window.dispatchEvent(event);
  };
}
```

#### 2. React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å–ª—É—à–∞–µ—Ç —Å–æ–±—ã—Ç–∏–µ
```typescript
useEffect(() => {
  const handleAuthSuccess = async (event: any) => {
    console.log('üîî [LOGINPAGE] –ü–æ–ª—É—á–µ–Ω–æ —Å–æ–±—ã—Ç–∏–µ telegramAuthSuccess');
    const user = event.detail;

    setIsLoading(true);
    setError('');

    try {
      console.log('üîî [LOGINPAGE] –í—ã–∑—ã–≤–∞–µ–º login()...');
      await login(user);
      console.log('üéâ [LOGINPAGE] login() –∑–∞–≤–µ—Ä—à—ë–Ω —É—Å–ø–µ—à–Ω–æ!');
    } catch (err: any) {
      console.error('üí• [LOGINPAGE] –û—à–∏–±–∫–∞ –≤ login():', err);
      setError(err.message || '–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞');
    } finally {
      setIsLoading(false);
    }
  };

  window.addEventListener('telegramAuthSuccess', handleAuthSuccess);
  return () => {
    window.removeEventListener('telegramAuthSuccess', handleAuthSuccess);
  };
}, [login]);
```

## üîÑ –ù–æ–≤—ã–π –ø–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
1. **–§–∞–π–ª –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è** ‚Üí Callback —Å–æ–∑–¥–∞–µ—Ç—Å—è –≥–ª–æ–±–∞–ª—å–Ω–æ
2. **React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è** ‚Üí –ù–∞–≤–µ—à–∏–≤–∞–µ—Ç listener –Ω–∞ —Å–æ–±—ã—Ç–∏–µ
3. **–í–∏–¥–∂–µ—Ç –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è** ‚Üí –í–∏–¥–∏—Ç –≥–æ—Ç–æ–≤—ã–π callback `window.onTelegramAuth`
4. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–ª–∏–∫–∞–µ—Ç** ‚Üí –í–∏–¥–∂–µ—Ç –≤—ã–∑—ã–≤–∞–µ—Ç callback
5. **Callback —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç** ‚Üí –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–±—ã—Ç–∏–µ `telegramAuthSuccess`
6. **React –ª–æ–≤–∏—Ç —Å–æ–±—ã—Ç–∏–µ** ‚Üí –í—ã–∑—ã–≤–∞–µ—Ç `login(user)`
7. **–ó–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä** ‚Üí `/api/auth/login` —Å –¥–∞–Ω–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
8. **–¢–æ–∫–µ–Ω —Å–æ—Ö—Ä–∞–Ω–µ–Ω** ‚Üí –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É Eliza OS

## üì¶ –°–±–æ—Ä–∫–∞ –∏ –¥–µ–ø–ª–æ–π

### –ö–æ–º–∞–Ω–¥—ã:
```bash
# –°–±–æ—Ä–∫–∞
bun run build:client

# –î–µ–ø–ª–æ–π
fly deploy -a vibee-eliza-999-prod-v2
```

### –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–±–æ—Ä–∫–∏:
```
@elizaos/client:build: dist/index.html                   0.73 kB ‚îÇ gzip:  0.47 kB
@elizaos/client:build: dist/assets/index-C2_T8xpK.css   11.07 kB ‚îÇ gzip:  2.88 kB
@elizaos/client:build: dist/assets/index-C7f1hMxH.js   156.59 kB ‚îÇ gzip: 50.26 kB
@elizaos/client:build: ‚úì built in 1.30s
```

## üöÄ –°—Ç–∞—Ç—É—Å
```
‚úÖ Deploy completed successfully
‚úÖ DNS configuration verified
‚úÖ Build Summary: image size 880 MB
üåê https://vibee-eliza-999-prod-v2.fly.dev
```

## üìù –û–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏ –ø—Ä–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

### –í –±—Ä–∞—É–∑–µ—Ä–µ (Console):
```
üîî [GLOBAL] –°–æ–∑–¥–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–π onTelegramAuth –î–û –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–∂–µ—Ç–∞
üîî [GLOBAL] === –ü–û–õ–£–ß–ï–ù–´ –î–ê–ù–ù–´–ï –û–¢ TELEGRAM ===
üîî [LOGINPAGE] –ü–æ–ª—É—á–µ–Ω–æ —Å–æ–±—ã—Ç–∏–µ telegramAuthSuccess
üîê [CLIENT] –ù–∞—á–∏–Ω–∞–µ–º –ø—Ä–æ—Ü–µ—Å—Å –ª–æ–≥–∏–Ω–∞...
‚úÖ [CLIENT] response.ok === true, –ø–∞—Ä—Å–∏–º JSON...
üéâ [CLIENT] –õ–æ–≥–∏–Ω –∑–∞–≤–µ—Ä—à—ë–Ω —É—Å–ø–µ—à–Ω–æ!
```

### –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:
```
=== [AUTH] –ù–∞—á–∞–ª–æ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –ª–æ–≥–∏–Ω ===
üîê [AUTH] –ü–æ–ª—É—á–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –æ—Ç Telegram Login Widget: {...}
[AUTH] –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω —Ç–æ–∫–µ–Ω: telegram_123456789_1704123456789
‚úÖ [AUTH] –û—Ç–≤–µ—Ç —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω
=== [AUTH] –ö–æ–Ω–µ—Ü –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –ª–æ–≥–∏–Ω ===
```

## üìã –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### `packages/client/src/pages/LoginPage.tsx`
**–ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∞–Ω–∞ –ª–æ–≥–∏–∫–∞**:
- Callback —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏ (—Å—Ç—Ä–æ–∫–∞ 12-22)
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CustomEvent –¥–ª—è —Å–≤—è–∑–∏ –º–µ–∂–¥—É callback –∏ React
- React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å–ª—É—à–∞–µ—Ç —Å–æ–±—ã—Ç–∏–µ —á–µ—Ä–µ–∑ `addEventListener`
- –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ: –≥–ª–æ–±–∞–ª—å–Ω—ã–π callback + React –ª–æ–≥–∏–∫–∞

## ‚ú® –†–µ–∑—É–ª—å—Ç–∞—Ç

### –¢–µ–ø–µ—Ä—å –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:
1. ‚úÖ **Callback –¥–æ—Å—Ç—É–ø–µ–Ω —Å—Ä–∞–∑—É** –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –≤–∏–¥–∂–µ—Ç–∞
2. ‚úÖ **–í–∏–¥–∂–µ—Ç –≤—ã–∑—ã–≤–∞–µ—Ç callback** –ø—Ä–∏ –∫–ª–∏–∫–µ
3. ‚úÖ **–î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è** –Ω–∞ `/api/auth/login`
4. ‚úÖ **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Ö–æ–¥–∏—Ç** —É—Å–ø–µ—à–Ω–æ
5. ‚úÖ **–ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ Eliza OS** —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Telegram"
    ‚Üì
–û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≤ Telegram
    ‚Üì
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç
    ‚Üì
–í–∏–¥–∂–µ—Ç –≤—ã–∑—ã–≤–∞–µ—Ç onTelegramAuth(user)
    ‚Üì
Callback –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–±—ã—Ç–∏–µ
    ‚Üì
React –ª–æ–≤–∏—Ç —Å–æ–±—ã—Ç–∏–µ –∏ –≤—ã–∑—ã–≤–∞–µ—Ç login()
    ‚Üì
–ó–∞–ø—Ä–æ—Å –Ω–∞ /api/auth/login
    ‚Üì
–°–µ—Ä–≤–µ—Ä –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ–∫–µ–Ω
    ‚Üì
–¢–æ–∫–µ–Ω —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ localStorage
    ‚Üì
–ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É Eliza OS ‚úÖ
```

---

## üéâ –ü–†–û–ë–õ–ï–ú–ê –†–ï–®–ï–ù–ê!

**–¢–µ–ø–µ—Ä—å –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ "–ª–æ–≥–∏–Ω" –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—Å–ø–µ—à–Ω–æ –≤–æ–π–¥–µ—Ç –≤ —Å–∏—Å—Ç–µ–º—É –∏ –ø–µ—Ä–µ–π–¥–µ—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è Eliza OS!**

---
*–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: 2 –¥–µ–∫–∞–±—Ä—è 2025*
*–ê–≤—Ç–æ—Ä: Claude Code*
