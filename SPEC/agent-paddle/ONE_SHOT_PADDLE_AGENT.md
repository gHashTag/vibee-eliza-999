# üèì –¢–ï–•–ù–ò–ß–ï–°–ö–û–ï –ó–ê–î–ê–ù–ò–ï: –ü–õ–ê–ì–ò–ù AGENT-PADDLE
## –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–∞–¥–µ–ª-–∫–ª—É–±–æ–º "Padel World Club" - One-Shot Implementation

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è**: 2025-11-21
**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞**: 1.0
**–¢–∏–ø**: Technical Specification for One-Shot Development
**–°—Ç–∞—Ç—É—Å**: –ì–æ—Ç–æ–≤ –∫ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

---

## üìã –û–ë–ó–û–† –ü–†–û–ï–ö–¢–ê

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø–ª–∞–≥–∏–Ω–∞
**Agent-Paddle** - —ç—Ç–æ ElizaOS –ø–ª–∞–≥–∏–Ω –¥–ª—è VIBEE –∞–≥–µ–Ω—Ç–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã, —Ä–µ–∞–ª–∏–∑—É—é—â–∏–π –ø–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—É—é —Å–∏—Å—Ç–µ–º—É —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–∞–¥–µ–ª-–∫–ª—É–±–æ–º —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ AI-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞, –º—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ—Å—Ç–∏ (10 —è–∑—ã–∫–æ–≤) –∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤.

### –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏
- ‚úÖ **One-Shot Ready** - –ì–æ—Ç–æ–≤ –∫ –ø–æ–ª–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —É—Ç–æ—á–Ω–µ–Ω–∏–π
- ‚úÖ **10 —è–∑—ã–∫–æ–≤** - –†—É—Å—Å–∫–∏–π, –ê–Ω–≥–ª–∏–π—Å–∫–∏–π, –ù–µ–º–µ—Ü–∫–∏–π, –ò–≤—Ä–∏—Ç, –ò—Å–ø–∞–Ω—Å–∫–∏–π, –§—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π, –ò—Ç–∞–ª—å—è–Ω—Å–∫–∏–π, –ü–æ—Ä—Ç—É–≥–∞–ª—å—Å–∫–∏–π, –ê—Ä–∞–±—Å–∫–∏–π, –ö–∏—Ç–∞–π—Å–∫–∏–π
- ‚úÖ **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∞–≥–µ–Ω—Ç—ã** - 7 —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤ —Ä–∞–±–æ—Ç–∞—é—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- ‚úÖ **–ì–æ–ª–æ—Å–æ–≤–æ–π AI** - Whisper + GPT-4 –¥–ª—è –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –¥–∏–∞–ª–æ–≥–∞
- ‚úÖ **ElizaOS-native** - –ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —ç–∫–æ—Å–∏—Å—Ç–µ–º–æ–π VIBEE

---

## üèóÔ∏è –ê–†–•–ò–¢–ï–ö–¢–£–†–ê –ü–õ–ê–ì–ò–ù–ê

### –û–±—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
```
plugin-agent-paddle/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ index.ts                          # –ì–ª–∞–≤–Ω—ã–π —ç–∫—Å–ø–æ—Ä—Ç –ø–ª–∞–≥–∏–Ω–∞
‚îÇ   ‚îú‚îÄ‚îÄ agents/                           # –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∞–≥–µ–Ω—Ç—ã (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ booking-agent.ts              # –ê–≥–µ–Ω—Ç –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ payment-agent.ts              # –ê–≥–µ–Ω—Ç –ø–ª–∞—Ç–µ–∂–µ–π
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ voice-agent.ts                # –ê–≥–µ–Ω—Ç –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ daily-game-agent.ts           # –ê–≥–µ–Ω—Ç —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö –∏–≥—Ä
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ admin-agent.ts                # –ê–≥–µ–Ω—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ analytics-agent.ts            # –ê–≥–µ–Ω—Ç –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ notification-agent.ts         # –ê–≥–µ–Ω—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ actions/                          # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–µ–π—Å—Ç–≤–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ booking-actions.ts            # –î–µ–π—Å—Ç–≤–∏—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ payment-actions.ts            # –î–µ–π—Å—Ç–≤–∏—è –æ–ø–ª–∞—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ voice-actions.ts              # –ì–æ–ª–æ—Å–æ–≤—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ admin-actions.ts              # –ê–¥–º–∏–Ω—Å–∫–∏–µ –¥–µ–π—Å—Ç–≤–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ services/                         # –ë–∏–∑–Ω–µ—Å-—Å–µ—Ä–≤–∏—Å—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ booking-service.ts            # –°–µ—Ä–≤–∏—Å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ slot-service.ts               # –°–µ—Ä–≤–∏—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–ª–æ—Ç–∞–º–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ payment-service.ts            # –°–µ—Ä–≤–∏—Å –ø–ª–∞—Ç–µ–∂–µ–π
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ voice-ai-service.ts           # –°–µ—Ä–≤–∏—Å –ò–ò –≥–æ–ª–æ—Å–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ daily-game-service.ts         # –°–µ—Ä–≤–∏—Å Daily Game
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pricing-service.ts            # –°–µ—Ä–≤–∏—Å —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ notification-service.ts       # –°–µ—Ä–≤–∏—Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ analytics-service.ts          # –°–µ—Ä–≤–∏—Å –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ i18n-service.ts               # –°–µ—Ä–≤–∏—Å –∏–Ω—Ç–µ—Ä–Ω–∞—Ü–∏–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ providers/                        # –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ booking-provider.ts           # –ü—Ä–æ–≤–∞–π–¥–µ—Ä –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ voice-provider.ts             # –ü—Ä–æ–≤–∞–π–¥–µ—Ä –≥–æ–ª–æ—Å–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ daily-game-provider.ts        # –ü—Ä–æ–≤–∞–π–¥–µ—Ä Daily Game
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ admin-provider.ts             # –ü—Ä–æ–≤–∞–π–¥–µ—Ä –∞–¥–º–∏–Ω–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ schemas/                          # Zod —Å—Ö–µ–º—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ booking-schemas.ts            # –°—Ö–µ–º—ã –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ payment-schemas.ts            # –°—Ö–µ–º—ã –ø–ª–∞—Ç–µ–∂–µ–π
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ voice-schemas.ts              # –°—Ö–µ–º—ã –≥–æ–ª–æ—Å–∞
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ admin-schemas.ts              # –°—Ö–µ–º—ã –∞–¥–º–∏–Ω–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ database/                         # –°—Ö–µ–º–∞ –ë–î –∏ –º–∏–≥—Ä–∞—Ü–∏–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ schema.ts                     # Drizzle —Å—Ö–µ–º—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ migrations/                   # SQL –º–∏–≥—Ä–∞—Ü–∏–∏
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ repositories/                 # Repository –ø–∞—Ç—Ç–µ—Ä–Ω
‚îÇ   ‚îú‚îÄ‚îÄ utils/                            # –£—Ç–∏–ª–∏—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ constants.ts                  # –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ helpers.ts                    # –ü–æ–º–æ—â–Ω–∏–∫–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ validators.ts                 # –í–∞–ª–∏–¥–∞—Ç–æ—Ä—ã
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ formatters.ts                 # –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤—â–∏–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ locales/                          # –ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ—Å—Ç—å (10 —è–∑—ã–∫–æ–≤)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ru.json                       # –†—É—Å—Å–∫–∏–π
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ en.json                       # –ê–Ω–≥–ª–∏–π—Å–∫–∏–π
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ de.json                       # –ù–µ–º–µ—Ü–∫–∏–π
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ he.json                       # –ò–≤—Ä–∏—Ç (RTL)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ es.json                       # –ò—Å–ø–∞–Ω—Å–∫–∏–π
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ fr.json                       # –§—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ it.json                       # –ò—Ç–∞–ª—å—è–Ω—Å–∫–∏–π
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pt.json                       # –ü–æ—Ä—Ç—É–≥–∞–ª—å—Å–∫–∏–π
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ar.json                       # –ê—Ä–∞–±—Å–∫–∏–π (RTL)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ zh.json                       # –ö–∏—Ç–∞–π—Å–∫–∏–π
‚îÇ   ‚îî‚îÄ‚îÄ types/                            # TypeScript —Ç–∏–ø—ã
‚îÇ       ‚îú‚îÄ‚îÄ booking.types.ts              # –¢–∏–ø—ã –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
‚îÇ       ‚îú‚îÄ‚îÄ payment.types.ts              # –¢–∏–ø—ã –ø–ª–∞—Ç–µ–∂–µ–π
‚îÇ       ‚îú‚îÄ‚îÄ voice.types.ts                # –¢–∏–ø—ã –≥–æ–ª–æ—Å–∞
‚îÇ       ‚îî‚îÄ‚îÄ admin.types.ts                # –¢–∏–ø—ã –∞–¥–º–∏–Ω–∫–∏
‚îú‚îÄ‚îÄ tests/                                # –¢–µ—Å—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ agents/                           # –¢–µ—Å—Ç—ã –∞–≥–µ–Ω—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ actions/                          # –¢–µ—Å—Ç—ã –¥–µ–π—Å—Ç–≤–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ services/                         # –¢–µ—Å—Ç—ã —Å–µ—Ä–≤–∏—Å–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ integration/                      # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
‚îú‚îÄ‚îÄ package.json                          # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–∞–∫–µ—Ç–∞
‚îî‚îÄ‚îÄ README.md                             # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

---

## ü§ñ –ü–ê–†–ê–õ–õ–ï–õ–¨–ù–´–ï –ê–ì–ï–ù–¢–´ (7 –ê–ì–ï–ù–¢–û–í)

### 1. Booking Agent (`booking-agent.ts`)
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∫–æ—Ä—Ç–æ–≤

**–§—É–Ω–∫—Ü–∏–∏**:
- –ü–æ–∏—Å–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤
- –°–æ–∑–¥–∞–Ω–∏–µ/–æ—Ç–º–µ–Ω–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–º

**–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–¥–∞—á–∏**:
```typescript
// –ó–∞–ø—É—Å–∫ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å –¥—Ä—É–≥–∏–º–∏ –∞–≥–µ–Ω—Ç–∞–º–∏
await Promise.all([
  bookingAgent.initialize(),
  paymentAgent.initialize(),
  voiceAgent.initialize(),
  dailyGameAgent.initialize(),
  adminAgent.initialize(),
  analyticsAgent.initialize(),
  notificationAgent.initialize()
]);
```

### 2. Payment Agent (`payment-agent.ts`)
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π (Telegram Stars, –Ω–∞–ª–∏—á–Ω—ã–µ, –±–∞–Ω–∫)

**–§—É–Ω–∫—Ü–∏–∏**:
- –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–≤–æ–π—Å–æ–≤ Telegram Stars
- –û–±—Ä–∞–±–æ—Ç–∫–∞ —á–µ–∫–æ–≤ –Ω–∞–ª–∏—á–Ω—ã—Ö
- –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∞–π–º–∞—É—Ç–∞–º–∏

### 3. Voice Agent (`voice-agent.ts`)
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ì–æ–ª–æ—Å–æ–≤–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (Whisper + GPT-4)

**–§—É–Ω–∫—Ü–∏–∏**:
- –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä–µ—á–∏ (10 —è–∑—ã–∫–æ–≤)
- –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –Ω–∞–º–µ—Ä–µ–Ω–∏–π
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ —è–∑—ã–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–π –¥–∏–∞–ª–æ–≥

### 4. Daily Game Agent (`daily-game-agent.ts`)
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –°–æ—Ü–∏–∞–ª—å–Ω–∞—è —Å–æ—Å—Ç–∞–≤–ª—è—é—â–∞—è

**–§—É–Ω–∫—Ü–∏–∏**:
- –°–æ–∑–¥–∞–Ω–∏–µ –∏–≥—Ä–æ–≤—ã—Ö –ø–ª–∞–Ω–æ–≤
- –†–∞—Å—Å—ã–ª–∫–∞ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π
- –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è–º–∏ –∏–≥—Ä—ã

### 5. Admin Agent (`admin-agent.ts`)
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤

**–§—É–Ω–∫—Ü–∏–∏**:
- CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ –∫–æ—Ä—Ç–æ–≤
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω–∞–º–∏
- –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏
- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –≤—Ä–µ–º–µ–Ω–∏

### 6. Analytics Agent (`analytics-agent.ts`)
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –°–±–æ—Ä –∏ –∞–Ω–∞–ª–∏–∑ –º–µ—Ç—Ä–∏–∫

**–§—É–Ω–∫—Ü–∏–∏**:
- –ü–æ–¥—Å—á–µ—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ—Ä—Ç–æ–≤
- –ê–Ω–∞–ª–∏–∑ –ø–ª–∞—Ç–µ–∂–µ–π
- –ü—Ä–µ–¥–∏–∫—Ç–∏–≤–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–æ–≤

### 7. Notification Agent (`notification-agent.ts`)
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

**–§—É–Ω–∫—Ü–∏–∏**:
- Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- Email –æ–ø–æ–≤–µ—â–µ–Ω–∏—è (–±—É–¥—É—â–µ–µ)
- Push —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (–±—É–¥—É—â–µ–µ)
- –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è

---

## üìä –ú–û–î–ï–õ–¨ –ë–ê–ó–´ –î–ê–ù–ù–´–•

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã (Drizzle ORM)

#### 1. –¢–∞–±–ª–∏—Ü–∞ `users` (–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏)
```typescript
import { pgTable, uuid, bigint, varchar, text, boolean, timestamp } from 'drizzle-orm/pg-core';

export const users = pgTable('users', {
  id: uuid('id').primaryKey().defaultRandom(),
  telegramId: bigint('telegram_id', { mode: 'number' }).unique().notNull(),
  username: varchar('username', { length: 255 }),
  firstName: varchar('first_name', { length: 255 }),
  lastName: varchar('last_name', { length: 255 }),
  languageCode: varchar('language_code', { length: 10 }).default('ru'),
  subscriptionLevel: varchar('subscription_level', { length: 50 }).default('free'),
  currentRating: real('current_rating').default(1000.0),
  gameLevel: varchar('game_level', { length: 50 }), // 'beginner', 'intermediate', 'advanced', 'pro'
  isBlocked: boolean('is_blocked').default(false),
  timezone: varchar('timezone', { length: 50 }).default('UTC'),
  preferences: text('preferences'), // JSON —Å—Ç—Ä–æ–∫–∞
  createdAt: timestamp('created_at').defaultNow(),
  updatedAt: timestamp('updated_at').defaultNow(),
});
```

#### 2. –¢–∞–±–ª–∏—Ü–∞ `venues` (–ö–ª—É–±—ã)
```typescript
export const venues = pgTable('venues', {
  id: uuid('id').primaryKey().defaultRandom(),
  name: varchar('name', { length: 255 }).notNull(),
  address: text('address'),
  phone: varchar('phone', { length: 50 }),
  email: varchar('email', { length: 255 }),
  timezone: varchar('timezone', { length: 50 }).default('UTC'),
  openingHours: text('opening_hours'), // JSON
  settings: text('settings'), // JSON
  isActive: boolean('is_active').default(true),
  createdAt: timestamp('created_at').defaultNow(),
  updatedAt: timestamp('updated_at').defaultNow(),
});
```

#### 3. –¢–∞–±–ª–∏—Ü–∞ `courts` (–ö–æ—Ä—Ç—ã)
```typescript
export const courts = pgTable('courts', {
  id: uuid('id').primaryKey().defaultRandom(),
  venueId: uuid('venue_id').references(() => venues.id).notNull(),
  courtType: varchar('court_type', { length: 50 }).notNull(), // 'paddle', 'tennis'
  courtName: varchar('court_name', { length: 255 }).notNull(),
  courtNumber: integer('court_number'),
  surface: varchar('surface', { length: 50 }), // 'artificial_grass', 'clay', 'hard'
  lighting: boolean('lighting').default(false),
  roofType: varchar('roof_type', { length: 50 }), // 'open', 'covered', 'heated'
  maxPlayers: integer('max_players').default(4),
  amenities: text('amenities'), // JSON array
  isActive: boolean('is_active').default(true),
  createdAt: timestamp('created_at').defaultNow(),
  updatedAt: timestamp('updated_at').defaultNow(),
});
```

#### 4. –¢–∞–±–ª–∏—Ü–∞ `court_pricing_policies` (–¶–µ–Ω–æ–≤—ã–µ –ø–æ–ª–∏—Ç–∏–∫–∏)
```typescript
export const courtPricingPolicies = pgTable('court_pricing_policies', {
  id: uuid('id').primaryKey().defaultRandom(),
  courtType: varchar('court_type', { length: 50 }).notNull(),
  name: varchar('name', { length: 255 }).notNull(),
  timeFrom: time('time_from').notNull(),
  timeTo: time('time_to').notNull(),
  dayOfWeek: integer('day_of_week'), // 0-6 (–≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ=0), null = –≤—Å–µ –¥–Ω–∏
  pricePerHour: numeric('price_per_hour', { precision: 10, scale: 2 }).notNull(),
  currency: varchar('currency', { length: 10 }).default('THB'),
  allowedDurations: text('allowed_durations'), // JSON array ['60', '90', '120']
  minBookingDuration: integer('min_booking_duration'), // –º–∏–Ω—É—Ç—ã
  maxBookingDuration: integer('max_booking_duration'), // –º–∏–Ω—É—Ç—ã
  advanceBookingLimit: integer('advance_booking_limit'), // –¥–Ω–µ–π
  cancellationPolicy: text('cancellation_policy'),
  isActive: boolean('is_active').default(true),
  createdAt: timestamp('created_at').defaultNow(),
  updatedAt: timestamp('updated_at').defaultNow(),
});
```

#### 5. –¢–∞–±–ª–∏—Ü–∞ `bookings` (–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è)
```typescript
export const bookings = pgTable('bookings', {
  id: uuid('id').primaryKey().defaultRandom(),
  bookingNumber: varchar('booking_number', { length: 50 }).unique().notNull(),
  userId: uuid('user_id').references(() => users.id).notNull(),
  courtId: uuid('court_id').references(() => courts.id).notNull(),
  startTime: timestamp('start_time', { withTimezone: true }).notNull(),
  endTime: timestamp('end_time', { withTimezone: true }).notNull(),
  durationMinutes: integer('duration_minutes').notNull(),
  status: varchar('status', { length: 50 }).default('pending_payment'),
  // 'pending_payment', 'confirmed', 'cancelled', 'completed', 'no_show'
  totalPrice: numeric('total_price', { precision: 10, scale: 2 }),
  currency: varchar('currency', { length: 10 }).default('THB'),
  bookingType: varchar('booking_type', { length: 50 }).default('regular'),
  // 'regular', 'daily_game', 'tournament', 'training'
  source: varchar('source', { length: 50 }).default('telegram_bot'),
  // 'telegram_bot', 'voice', 'web_app', 'admin'
  paymentStatus: varchar('payment_status', { length: 50 }).default('pending'),
  cancellationReason: text('cancellation_reason'),
  notes: text('notes'),
  metadata: text('metadata'), // JSON
  createdAt: timestamp('created_at').defaultNow(),
  updatedAt: timestamp('updated_at').defaultNow(),
});
```

#### 6. –¢–∞–±–ª–∏—Ü–∞ `payments` (–ü–ª–∞—Ç–µ–∂–∏)
```typescript
export const payments = pgTable('payments', {
  id: uuid('id').primaryKey().defaultRandom(),
  paymentNumber: varchar('payment_number', { length: 50 }).unique().notNull(),
  bookingId: uuid('booking_id').references(() => bookings.id).notNull(),
  userId: uuid('user_id').references(() => users.id).notNull(),
  amount: numeric('amount', { precision: 10, scale: 2 }).notNull(),
  currency: varchar('currency', { length: 10 }).notNull(),
  paymentMethod: varchar('payment_method', { length: 50 }).notNull(),
  // 'telegram_stars', 'cash', 'bank_transfer', 'credit_card', 'paypal'
  paymentStatus: varchar('payment_status', { length: 50 }).default('pending'),
  // 'pending', 'processing', 'completed', 'failed', 'refunded', 'cancelled'
  telegramPaymentChargeId: varchar('telegram_payment_charge_id', { length: 255 }),
  telegramInvoicePayload: text('telegram_invoice_payload'),
  receiptUrl: text('receipt_url'),
  cashReceiptImage: text('cash_receipt_image'), // URL —Ñ–æ—Ç–æ —á–µ–∫–∞
  bankTransactionId: varchar('bank_transaction_id', { length: 255 }),
  adminConfirmedBy: uuid('admin_confirmed_by').references(() => users.id),
  adminConfirmationAt: timestamp('admin_confirmation_at'),
  failureReason: text('failure_reason'),
  refundAmount: numeric('refund_amount', { precision: 10, scale: 2 }),
  refundReason: text('refund_reason'),
  metadata: text('metadata'), // JSON
  createdAt: timestamp('created_at').defaultNow(),
  updatedAt: timestamp('updated_at').defaultNow(),
});
```

#### 7. –¢–∞–±–ª–∏—Ü–∞ `daily_game_selections` (–í—ã–±–æ—Ä Daily Game)
```typescript
export const dailyGameSelections = pgTable('daily_game_selections', {
  id: uuid('id').primaryKey().defaultRandom(),
  userId: uuid('user_id').references(() => users.id).notNull(),
  gameDate: date('game_date').notNull(),
  selectedTime: time('selected_time').notNull(),
  courtType: varchar('court_type', { length: 50 }).notNull(),
  playerLevel: varchar('player_level', { length: 50 }).notNull(),
  status: varchar('status', { length: 50 }).default('invited'),
  // 'invited', 'selected', 'confirmed', 'cancelled', 'completed'
  notificationSent: boolean('notification_sent').default(false),
  invitationToken: varchar('invitation_token', { length: 255 }).unique(),
  selectedAt: timestamp('selected_at'),
  cancelledAt: timestamp('cancelled_at'),
  createdAt: timestamp('created_at').defaultNow(),
  updatedAt: timestamp('updated_at').defaultNow(),
});
```

#### 8. –¢–∞–±–ª–∏—Ü–∞ `daily_game_groups` (–ì—Ä—É–ø–ø—ã Daily Game)
```typescript
export const dailyGameGroups = pgTable('daily_game_groups', {
  id: uuid('id').primaryKey().defaultRandom(),
  gameDate: date('game_date').notNull(),
  selectedTime: time('selected_time').notNull(),
  courtType: varchar('court_type', { length: 50 }).notNull(),
  playerLevel: varchar('player_level', { length: 50 }).notNull(),
  courtId: uuid('court_id').references(() => courts.id),
  playerIds: text('player_ids'), // JSON array UUIDs
  maxPlayers: integer('max_players').default(4),
  status: varchar('status', { length: 50 }).default('forming'),
  // 'forming', 'ready', 'paid', 'completed', 'cancelled'
  totalAmount: numeric('total_amount', { precision: 10, scale: 2 }),
  amountPerPlayer: numeric('amount_per_player', { precision: 10, scale: 2 }),
  currency: varchar('currency', { length: 10 }).default('THB'),
  createdAt: timestamp('created_at').defaultNow(),
  updatedAt: timestamp('updated_at').defaultNow(),
});
```

#### 9. –¢–∞–±–ª–∏—Ü–∞ `daily_game_admin_schedule` (–ü–ª–∞–Ω—ã –∞–¥–º–∏–Ω–æ–≤)
```typescript
export const dailyGameAdminSchedule = pgTable('daily_game_admin_schedule', {
  id: uuid('id').primaryKey().defaultRandom(),
  adminId: uuid('admin_id').references(() => users.id).notNull(),
  gameDate: date('game_date').notNull(),
  selectedTime: time('selected_time').notNull(),
  courtId: uuid('court_id').references(() => courts.id),
  courtType: varchar('court_type', { length: 50 }).notNull(),
  playerLevel: varchar('player_level', { length: 50 }).notNull(),
  durationMinutes: integer('duration_minutes').notNull(),
  pricePerPerson: numeric('price_per_person', { precision: 10, scale: 2 }),
  currency: varchar('currency', { length: 10 }).default('THB'),
  maxPlayers: integer('max_players').default(4),
  description: text('description'),
  status: varchar('status', { length: 50 }).default('planned'),
  // 'planned', 'sent', 'cancelled', 'completed'
  invitationsSent: integer('invitations_sent').default(0),
  playersJoined: integer('players_joined').default(0),
  createdAt: timestamp('created_at').defaultNow(),
  updatedAt: timestamp('updated_at').defaultNow(),
});
```

#### 10. –¢–∞–±–ª–∏—Ü–∞ `voice_sessions` (–ì–æ–ª–æ—Å–æ–≤—ã–µ —Å–µ—Å—Å–∏–∏)
```typescript
export const voiceSessions = pgTable('voice_sessions', {
  id: uuid('id').primaryKey().defaultRandom(),
  userId: uuid('user_id').references(() => users.id).notNull(),
  sessionId: varchar('session_id', { length: 255 }).unique().notNull(),
  languageCode: varchar('language_code', { length: 10 }).notNull(),
  audioFileUrl: text('audio_file_url'),
  transcribedText: text('transcribed_text'),
  intent: text('intent'), // JSON
  confidence: real('confidence'),
  responseText: text('response_text'),
  responseAudioUrl: text('response_audio_url'),
  context: text('context'), // JSON
  status: varchar('status', { length: 50 }).default('processing'),
  // 'processing', 'completed', 'failed'
  errorMessage: text('error_message'),
  createdAt: timestamp('created_at').defaultNow(),
  updatedAt: timestamp('updated_at').defaultNow(),
});
```

### –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
```typescript
// Bookings
export const bookingCourtTimeIdx = index('idx_bookings_court_time').on(bookings.courtId, bookings.startTime);
export const bookingUserIdx = index('idx_bookings_user').on(bookings.userId);
export const bookingStatusIdx = index('idx_bookings_status').on(bookings.status);
export const bookingDateRangeIdx = index('idx_bookings_date_range').on(bookings.startTime, bookings.endTime);

// Payments
export const paymentBookingIdx = index('idx_payments_booking').on(payments.bookingId);
export const paymentStatusIdx = index('idx_payments_status').on(payments.paymentStatus);
export const paymentUserIdx = index('idx_payments_user').on(payments.userId);

// Daily Game
export const dailyGameDateTimeIdx = index('idx_daily_game_date_time').on(dailyGameSelections.gameDate, dailyGameSelections.selectedTime);
export const dailyGameUserIdx = index('idx_daily_game_user').on(dailyGameSelections.userId);
export const dailyGameGroupsDateIdx = index('idx_daily_game_groups_date').on(dailyGameGroups.gameDate, dailyGameGroups.selectedTime);

// Users
export const userTelegramIdIdx = index('idx_users_telegram_id').on(users.telegramId);
export const userGameLevelIdx = index('idx_users_game_level').on(users.gameLevel);

// Voice
export const voiceSessionUserIdx = index('idx_voice_sessions_user').on(voiceSessions.userId);
export const voiceSessionSessionIdx = index('idx_voice_sessions_session').on(voiceSessions.sessionId);
```

---

## üéØ –ê–õ–ì–û–†–ò–¢–ú–´ –ò –õ–û–ì–ò–ö–ê

### –ê–ª–≥–æ—Ä–∏—Ç–º 1: –ü–æ–∏—Å–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤
```typescript
export class SlotSearchAlgorithm {
  async findAvailableSlots(
    courtType: 'paddle' | 'tennis',
    date: Date,
    duration: number,
    venueId?: string
  ): Promise<AvailableSlot[]> {
    // 1. –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –∫–æ—Ä—Ç—ã —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞
    const courts = await this.getCourtsByType(courtType, venueId);

    // 2. –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –±—Ä–æ–Ω–∏ –Ω–∞ –¥–∞—Ç—É
    const existingBookings = await this.getBookingsForDate(courts.map(c => c.id), date);

    // 3. –ü–æ–ª—É—á–∞–µ–º —Ü–µ–Ω–æ–≤—ã–µ –ø–æ–ª–∏—Ç–∏–∫–∏
    const pricingPolicies = await this.getPricingPolicies(courtType, date);

    // 4. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–ª–æ—Ç—ã
    const timeSlots = this.generateTimeSlots(date, courts[0]?.venue?.openingHours);

    // 5. –§–∏–ª—å—Ç—Ä—É–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Å–ª–æ—Ç—ã
    const availableSlots = this.filterAvailableSlots(
      courts,
      timeSlots,
      existingBookings,
      duration
    );

    // 6. –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Ü–µ–Ω—ã
    return this.calculatePrices(availableSlots, pricingPolicies);
  }

  private generateTimeSlots(date: Date, openingHours: OpeningHours): TimeSlot[] {
    const dayOfWeek = date.getDay();
    const hours = openingHours[dayOfWeek];

    if (!hours || hours.closed) return [];

    const slots: TimeSlot[] = [];
    const start = this.parseTime(hours.open);
    const end = this.parseTime(hours.close);

    for (let time = start; time + 60 <= end; time += 30) {
      slots.push({
        start: time,
        end: time + 60,
        available: true
      });
    }

    return slots;
  }

  private filterAvailableSlots(
    courts: Court[],
    timeSlots: TimeSlot[],
    bookings: Booking[],
    duration: number
  ): AvailableSlot[] {
    const available: AvailableSlot[] = [];

    for (const court of courts) {
      for (const slot of timeSlots) {
        const hasConflict = bookings.some(booking =>
          booking.courtId === court.id &&
          this.hasTimeOverlap(
            slot.start, slot.start + duration,
            booking.startTime, booking.endTime
          )
        );

        if (!hasConflict) {
          available.push({
            court,
            startTime: slot.start,
            duration,
            available: true
          });
        }
      }
    }

    return available;
  }
}
```

### –ê–ª–≥–æ—Ä–∏—Ç–º 2: –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ
```typescript
export class DynamicPricingAlgorithm {
  calculatePrice(
    courtType: string,
    date: Date,
    time: Date,
    duration: number
  ): PriceCalculation {
    // 1. –ü–æ–ª—É—á–∞–µ–º –±–∞–∑–æ–≤—É—é —Ü–µ–Ω—É
    const basePrice = this.getBasePrice(courtType, date, time);

    // 2. –ü—Ä–∏–º–µ–Ω—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã
    const timeMultiplier = this.getTimeMultiplier(time);

    // 3. –ü—Ä–∏–º–µ–Ω—è–µ–º –¥–Ω–µ–≤–Ω—ã–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã
    const dayMultiplier = this.getDayMultiplier(date);

    // 4. –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —É—Å–ª–æ–≤–∏—è
    const specialPricing = this.getSpecialPricing(date, courtType);

    // 5. –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –∏—Ç–æ–≥–æ–≤—É—é —Ü–µ–Ω—É
    const baseAmount = basePrice * (duration / 60);
    const adjustedAmount = baseAmount * timeMultiplier * dayMultiplier;
    const finalAmount = this.applySpecialPricing(adjustedAmount, specialPricing);

    return {
      basePrice,
      adjustments: {
        time: timeMultiplier,
        day: dayMultiplier,
        special: specialPricing
      },
      finalPrice: Math.round(finalAmount * 100) / 100,
      currency: 'THB',
      breakdown: {
        base: baseAmount,
        timeAdjustment: baseAmount * (timeMultiplier - 1),
        dayAdjustment: baseAmount * (dayMultiplier - 1),
        specialAdjustment: finalAmount - baseAmount
      }
    };
  }

  private getTimeMultiplier(time: Date): number {
    const hour = time.getHours();

    // Peak hours (18:00-21:00): 1.5x
    if (hour >= 18 && hour < 21) return 1.5;

    // Morning (6:00-11:00): 0.8x
    if (hour >= 6 && hour < 11) return 0.8;

    // Mid-day (11:00-16:00): 1.2x
    if (hour >= 11 && hour < 16) return 1.2;

    // Evening (21:00-23:00): 1.3x
    if (hour >= 21 && hour < 23) return 1.3;

    // Default
    return 1.0;
  }

  private getDayMultiplier(date: Date): number {
    const day = date.getDay();

    // Friday & Saturday: 1.3x
    if (day === 5 || day === 6) return 1.3;

    // Sunday: 1.2x
    if (day === 0) return 1.2;

    // Weekdays: 1.0x
    return 1.0;
  }
}
```

### –ê–ª–≥–æ—Ä–∏—Ç–º 3: –ì–æ–ª–æ—Å–æ–≤–æ–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –∏ –Ω–∞–º–µ—Ä–µ–Ω–∏—è
```typescript
export class VoiceProcessingAlgorithm {
  async processVoiceMessage(
    audioBuffer: Buffer,
    languageCode: string,
    sessionId: string
  ): Promise<VoiceProcessingResult> {
    // 1. –¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è –∞—É–¥–∏–æ (Whisper)
    const transcription = await this.transcribeAudio(audioBuffer, languageCode);

    // 2. –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –Ω–∞–º–µ—Ä–µ–Ω–∏—è (GPT-4)
    const intent = await this.extractIntent(transcription.text, languageCode);

    // 3. –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –ø–∞—Ä—Å–∏–Ω–≥ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
    const validatedIntent = this.validateIntent(intent);

    // 4. –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è –∏–ª–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞
    const actionResult = await this.executeIntent(validatedIntent, sessionId);

    // 5. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ –Ω–∞ —è–∑—ã–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    const response = await this.generateResponse(
      actionResult,
      languageCode,
      transcription.confidence
    );

    // 6. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∞—É–¥–∏–æ –æ—Ç–≤–µ—Ç–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
    const audioResponse = await this.generateAudioResponse(response.text, languageCode);

    return {
      transcription,
      intent: validatedIntent,
      actionResult,
      response: {
        text: response.text,
        audioUrl: audioResponse?.url,
        confidence: response.confidence
      },
      metadata: {
        processingTime: Date.now() - startTime,
        language: languageCode
      }
    };
  }

  private async extractIntent(text: string, language: string): Promise<Intent> {
    const systemPrompt = this.getSystemPromptForLanguage(language);

    const completion = await openai.chat.completions.create({
      model: 'gpt-4',
      messages: [
        { role: 'system', content: systemPrompt },
        { role: 'user', content: text }
      ],
      temperature: 0.1,
      response_format: { type: 'json_object' }
    });

    const content = completion.choices[0].message.content;
    return JSON.parse(content);
  }

  private getSystemPromptForLanguage(lang: string): string {
    const prompts = {
      ru: `–¢—ã –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –ø–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—é –∫–æ—Ä—Ç–æ–≤ –¥–ª—è –ø–∞–¥–µ–ª-–∫–ª—É–±–∞.
–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –∏–∑–≤–ª–µ–∫–∏ –Ω–∞–º–µ—Ä–µ–Ω–∏–µ.
–û—Ç–≤–µ—Ç—å –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON:
{
  "intent": "booking_search|booking_create|payment|cancel|info|daily_game",
  "parameters": {
    "date": "2025-11-22",
    "time": "18:00",
    "duration": 60,
    "courtType": "paddle",
    "gameLevel": "beginner"
  },
  "confidence": 0.95
}`,
      en: `You are a paddle court booking assistant.
Analyze user message and extract intent.
Respond in JSON format:
{
  "intent": "booking_search|booking_create|payment|cancel|info|daily_game",
  "parameters": {
    "date": "2025-11-22",
    "time": "18:00",
    "duration": 60,
    "courtType": "paddle",
    "gameLevel": "beginner"
  },
  "confidence": 0.95
}`,
      // ... –¥—Ä—É–≥–∏–µ —è–∑—ã–∫–∏
    };

    return prompts[lang] || prompts.en;
  }
}
```

### –ê–ª–≥–æ—Ä–∏—Ç–º 4: –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø Daily Game
```typescript
export class DailyGameGroupingAlgorithm {
  async formGroups(
    gameDate: Date,
    time: string,
    courtType: string,
    playerLevel: string
  ): Promise<DailyGameGroup[]> {
    // 1. –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ—Ö –∑–∞–∏–Ω—Ç–µ—Ä–µ—Å–æ–≤–∞–Ω–Ω—ã—Ö –∏–≥—Ä–æ–∫–æ–≤
    const players = await this.getInterestedPlayers(gameDate, time, playerLevel);

    // 2. –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ —Ä–µ–π—Ç–∏–Ω–≥—É
    const sortedPlayers = this.sortByRating(players);

    // 3. –§–æ—Ä–º–∏—Ä—É–µ–º –≥—Ä—É–ø–ø—ã –ø–æ 4 —á–µ–ª–æ–≤–µ–∫–∞
    const groups = this.createGroups(sortedPlayers, 4);

    // 4. –í—ã—á–∏—Å–ª—è–µ–º –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –∫–æ—Ä—Ç—ã
    await this.assignCourts(groups, gameDate, time);

    // 5. –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Ü–µ–Ω—ã
    this.calculateGroupPrices(groups);

    // 6. –°–æ—Ö—Ä–∞–Ω—è–µ–º –≥—Ä—É–ø–ø—ã –≤ –ë–î
    return this.saveGroups(groups);
  }

  private createGroups(players: Player[], groupSize: number): Group[] {
    const groups: Group[] = [];

    for (let i = 0; i < players.length; i += groupSize) {
      const groupPlayers = players.slice(i, i + groupSize);

      if (groupPlayers.length > 0) {
        groups.push({
          id: generateUUID(),
          players: groupPlayers,
          status: groupPlayers.length === groupSize ? 'ready' : 'forming',
          maxPlayers: groupSize
        });
      }
    }

    return groups;
  }

  private async assignCourts(
    groups: Group[],
    date: Date,
    time: string
  ): Promise<void> {
    for (const group of groups) {
      // –ü–æ–ª—É—á–∞–µ–º –ø–æ–¥—Ö–æ–¥—è—â–∏–µ –∫–æ—Ä—Ç—ã
      const availableCourts = await this.getAvailableCourts(
        group.players[0].preferredCourtType,
        date,
        time,
        group.players.length
      );

      if (availableCourts.length > 0) {
        // –í—ã–±–∏—Ä–∞–µ–º –ª—É—á—à–∏–π –∫–æ—Ä—Ç
        group.court = this.selectOptimalCourt(availableCourts, group.players);
      }
    }
  }
}
```

### –ê–ª–≥–æ—Ä–∏—Ç–º 5: –°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
```typescript
export class NotificationAlgorithm {
  async scheduleNotifications(booking: Booking): Promise<void> {
    const notifications = [
      // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è (–Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ)
      {
        type: 'booking_confirmation',
        delay: 0,
        template: 'booking_confirmation',
        channels: ['telegram']
      },

      // –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –∑–∞ 2 —á–∞—Å–∞
      {
        type: 'reminder',
        delay: 2 * 60 * 60 * 1000,
        template: 'booking_reminder',
        channels: ['telegram']
      },

      // –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –∑–∞ 24 —á–∞—Å–∞
      {
        type: 'reminder',
        delay: 24 * 60 * 60 * 1000,
        template: 'booking_reminder',
        channels: ['telegram']
      },

      // –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –∑–∞ 1 –Ω–µ–¥–µ–ª—é (–µ—Å–ª–∏ –¥–∞–ª–µ–∫–æ)
      {
        type: 'reminder',
        delay: 7 * 24 * 60 * 60 * 1000,
        template: 'booking_reminder',
        channels: ['telegram'],
        condition: (booking) => {
          const daysDiff = (booking.startTime.getTime() - Date.now()) / (1000 * 60 * 60 * 24);
          return daysDiff > 2;
        }
      }
    ];

    for (const notification of notifications) {
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å–ª–æ–≤–∏–µ
      if (notification.condition && !notification.condition(booking)) {
        continue;
      }

      // –ü–ª–∞–Ω–∏—Ä—É–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
      await this.scheduleNotification({
        ...notification,
        bookingId: booking.id,
        userId: booking.userId,
        scheduledAt: new Date(Date.now() + notification.delay)
      });
    }
  }

  async sendNotification(notification: ScheduledNotification): Promise<void> {
    const user = await this.getUser(notification.userId);
    const booking = await this.getBooking(notification.bookingId);

    const template = this.getTemplate(notification.template, user.languageCode);
    const message = this.renderTemplate(template, { user, booking });

    for (const channel of notification.channels) {
      try {
        switch (channel) {
          case 'telegram':
            await this.sendTelegramMessage(user.telegramId, message);
            break;
          case 'email':
            await this.sendEmail(user.email, message);
            break;
        }

        // –õ–æ–≥–∏—Ä—É–µ–º —É—Å–ø–µ—à–Ω—É—é –æ—Ç–ø—Ä–∞–≤–∫—É
        await this.logNotification(notification, 'sent', channel);
      } catch (error) {
        // –õ–æ–≥–∏—Ä—É–µ–º –æ—à–∏–±–∫—É
        await this.logNotification(notification, 'failed', channel, error);
      }
    }
  }
}
```

---

## üåç –ú–£–õ–¨–¢–ò–Ø–ó–´–ß–ù–û–°–¢–¨ (10 –Ø–ó–´–ö–û–í)

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —è–∑—ã–∫–∏
1. **–†—É—Å—Å–∫–∏–π** (ru) - üá∑üá∫ RTL: –ù–µ—Ç
2. **–ê–Ω–≥–ª–∏–π—Å–∫–∏–π** (en) - üá¨üáß RTL: –ù–µ—Ç
3. **–ù–µ–º–µ—Ü–∫–∏–π** (de) - üá©üá™ RTL: –ù–µ—Ç
4. **–ò–≤—Ä–∏—Ç** (he) - üáÆüá± RTL: **–î–∞**
5. **–ò—Å–ø–∞–Ω—Å–∫–∏–π** (es) - üá™üá∏ RTL: –ù–µ—Ç
6. **–§—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π** (fr) - üá´üá∑ RTL: –ù–µ—Ç
7. **–ò—Ç–∞–ª—å—è–Ω—Å–∫–∏–π** (it) - üáÆüáπ RTL: –ù–µ—Ç
8. **–ü–æ—Ä—Ç—É–≥–∞–ª—å—Å–∫–∏–π** (pt) - üáµüáπ RTL: –ù–µ—Ç
9. **–ê—Ä–∞–±—Å–∫–∏–π** (ar) - üá∏üá¶ RTL: **–î–∞**
10. **–ö–∏—Ç–∞–π—Å–∫–∏–π** (zh) - üá®üá≥ RTL: –ù–µ—Ç

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏
```typescript
// locales/ru.json
{
  "common": {
    "welcome": "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Padel World Club!",
    "booking": "–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ",
    "myBookings": "–ú–æ–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è",
    "dailyGame": "Daily Game",
    "help": "–ü–æ–º–æ—â—å",
    "language": "–Ø–∑—ã–∫",
    "settings": "–ù–∞—Å—Ç—Ä–æ–π–∫–∏"
  },
  "booking": {
    "searchSlots": "–ü–æ–∏—Å–∫ —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤",
    "selectCourt": "–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ—Ä—Ç",
    "selectDate": "–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É",
    "selectTime": "–í—ã–±–µ—Ä–∏—Ç–µ –≤—Ä–µ–º—è",
    "duration": "–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å",
    "price": "–¶–µ–Ω–∞",
    "confirmBooking": "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ",
    "cancelBooking": "–û—Ç–º–µ–Ω–∏—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ",
    "bookingConfirmed": "‚úÖ –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ!",
    "bookingCancelled": "‚ùå –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–º–µ–Ω–µ–Ω–æ",
    "noSlots": "–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è –Ω–µ—Ç —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤",
    "bookingNumber": "–ù–æ–º–µ—Ä –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è",
    "courtName": "–ö–æ—Ä—Ç",
    "startTime": "–ù–∞—á–∞–ª–æ",
    "endTime": "–û–∫–æ–Ω—á–∞–Ω–∏–µ",
    "totalPrice": "–ò—Ç–æ–≥–æ"
  },
  "payment": {
    "selectPaymentMethod": "–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã",
    "telegramStars": "Telegram Stars",
    "cash": "–ù–∞–ª–∏—á–Ω—ã–º–∏",
    "bankTransfer": "–ë–∞–Ω–∫–æ–≤—Å–∫–∏–π –ø–µ—Ä–µ–≤–æ–¥",
    "payingWithStars": "–û–ø–ª–∞—Ç–∞ —á–µ—Ä–µ–∑ Telegram Stars",
    "uploadReceipt": "–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ —á–µ–∫–∞",
    "receiptUploaded": "–ß–µ–∫ –∑–∞–≥—Ä—É–∂–µ–Ω, –æ–∂–∏–¥–∞–π—Ç–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞",
    "paymentConfirmed": "‚úÖ –û–ø–ª–∞—Ç–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞!",
    "paymentFailed": "‚ùå –û–ø–ª–∞—Ç–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å",
    "paymentTimeout": "‚è∞ –í—Ä–µ–º—è –æ–ø–ª–∞—Ç—ã –∏—Å—Ç–µ–∫–ª–æ",
    "amount": "–°—É–º–º–∞",
    "currency": "–í–∞–ª—é—Ç–∞"
  },
  "voice": {
    "voiceBooking": "–ì–æ–ª–æ—Å–æ–≤–æ–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ",
    "sendVoiceMessage": "–û—Ç–ø—Ä–∞–≤—å—Ç–µ –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ",
    "listening": "üé§ –°–ª—É—à–∞—é...",
    "processing": "üîÑ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é...",
    "voiceNotRecognized": "–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–æ–∑–Ω–∞—Ç—å –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ",
    "tryAgain": "–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑",
    "speechToTextError": "–û—à–∏–±–∫–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Ä–µ—á–∏",
    "intentNotUnderstood": "–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–Ω—è—Ç—å –≤–∞—à–µ –Ω–∞–º–µ—Ä–µ–Ω–∏–µ",
    "bookingCreated": "–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–æ!",
    "slotsFound": "–ù–∞–π–¥–µ–Ω–æ —Å–ª–æ—Ç–æ–≤: {count}",
    "sayBooking": "–°–∫–∞–∂–∏—Ç–µ, –Ω–∞–ø—Ä–∏–º–µ—Ä: '–ó–∞–±—Ä–æ–Ω–∏—Ä—É–π –∫–æ—Ä—Ç –Ω–∞ –∑–∞–≤—Ç—Ä–∞ –≤ 18:00'"
  },
  "dailyGame": {
    "dailyGameTitle": "üéÆ Daily Game - –ù–∞–π–¥–∏ –∏–≥—Ä–æ–∫–æ–≤!",
    "availableGames": "–î–æ—Å—Ç—É–ø–Ω—ã–µ –∏–≥—Ä—ã",
    "joinGame": "–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –∏–≥—Ä–µ",
    "createGame": "–°–æ–∑–¥–∞—Ç—å –∏–≥—Ä—É",
    "yourLevel": "–í–∞—à —É—Ä–æ–≤–µ–Ω—å",
    "beginner": "–ù–æ–≤–∏—á–æ–∫",
    "intermediate": "–°—Ä–µ–¥–Ω–∏–π",
    "advanced": "–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π",
    "pro": "–ü—Ä–æ—Ñ–∏",
    "playersJoined": "–ò–≥—Ä–æ–∫–æ–≤: {joined}/{total}",
    "groupReady": "‚úÖ –ì—Ä—É–ø–ø–∞ –≥–æ—Ç–æ–≤–∞!",
    "waitingForPlayers": "‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ –∏–≥—Ä–æ–∫–æ–≤...",
    "gameFull": "–ì—Ä—É–ø–ø–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–∞",
    "selectTimeSlot": "–í—ã–±–µ—Ä–∏—Ç–µ –≤—Ä–µ–º—è –∏–≥—Ä—ã",
    "gameScheduled": "–ò–≥—Ä–∞ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∞!",
    "invitationSent": "–ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã!"
  },
  "admin": {
    "adminPanel": "üõ†Ô∏è –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å",
    "courts": "–ö–æ—Ä—Ç—ã",
    "bookings": "–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è",
    "users": "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏",
    "analytics": "–ê–Ω–∞–ª–∏—Ç–∏–∫–∞",
    "pricing": "–¶–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ",
    "settings": "–ù–∞—Å—Ç—Ä–æ–π–∫–∏",
    "newBooking": "–ù–æ–≤–æ–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ",
    "editBooking": "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ",
    "deleteBooking": "–£–¥–∞–ª–∏—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ",
    "confirmPayment": "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –ø–ª–∞—Ç–µ–∂",
    "rejectPayment": "–û—Ç–∫–ª–æ–Ω–∏—Ç—å –ø–ª–∞—Ç–µ–∂",
    "courtOccupancy": "–ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ—Ä—Ç–æ–≤",
    "revenue": "–í—ã—Ä—É—á–∫–∞",
    "activeUsers": "–ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏"
  },
  "time": {
    "today": "–°–µ–≥–æ–¥–Ω—è",
    "tomorrow": "–ó–∞–≤—Ç—Ä–∞",
    "yesterday": "–í—á–µ—Ä–∞",
    "monday": "–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫",
    "tuesday": "–í—Ç–æ—Ä–Ω–∏–∫",
    "wednesday": "–°—Ä–µ–¥–∞",
    "thursday": "–ß–µ—Ç–≤–µ—Ä–≥",
    "friday": "–ü—è—Ç–Ω–∏—Ü–∞",
    "saturday": "–°—É–±–±–æ—Ç–∞",
    "sunday": "–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ",
    "at": "–≤",
    "minutes": "–º–∏–Ω—É—Ç",
    "hours": "—á–∞—Å–æ–≤"
  },
  "errors": {
    "genericError": "–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.",
    "bookingConflict": "–ö–æ–Ω—Ñ–ª–∏–∫—Ç –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è",
    "paymentFailed": "–û—à–∏–±–∫–∞ –æ–ø–ª–∞—Ç—ã",
    "voiceError": "–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≥–æ–ª–æ—Å–∞",
    "networkError": "–û—à–∏–±–∫–∞ —Å–µ—Ç–∏",
    "unauthorized": "–ù–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø",
    "notFound": "–ù–µ –Ω–∞–π–¥–µ–Ω–æ",
    "validationError": "–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏",
    "rateLimit": "–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤",
    "maintenance": "–°–∏—Å—Ç–µ–º–∞ –Ω–∞ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–∏"
  }
}
```

### RTL –ø–æ–¥–¥–µ—Ä–∂–∫–∞ (–∏–≤—Ä–∏—Ç –∏ –∞—Ä–∞–±—Å–∫–∏–π)
```typescript
// utils/rtl-support.ts
export const RTL_LANGUAGES = ['he', 'ar'];

export function isRTLLanguage(languageCode: string): boolean {
  return RTL_LANGUAGES.includes(languageCode);
}

export function formatMessage(
  text: string,
  languageCode: string
): { text: string; isRTL: boolean } {
  const isRTL = isRTLLanguage(languageCode);

  return {
    text: isRTL ? applyRTLFormatting(text) : text,
    isRTL
  };
}

function applyRTLFormatting(text: string): string {
  // –î–æ–±–∞–≤–ª—è–µ–º RTL mark –∏ –º–µ–Ω—è–µ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è —Å–º–µ—à–∞–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
  return '\u202B' + text.replace(/([a-zA-Z0-9]+)/g, '\u202C$1\u202B') + '\u202C';
}

// –í Telegram –±–æ—Ç–µ
async function sendMessageWithRTL(
  chatId: number,
  text: string,
  languageCode: string
) {
  const { text: formattedText, isRTL } = formatMessage(text, languageCode);

  await bot.telegram.sendMessage(chatId, formattedText, {
    parse_mode: 'HTML',
    reply_markup: isRTL ? {
      keyboard: [...].reverse() // RTL –∫–æ–º–ø–æ–Ω–æ–≤–∫–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
    } : undefined
  });
}
```

---

## üîÑ –í–ó–ê–ò–ú–û–î–ï–ô–°–¢–í–ò–ï –°–¶–ï–ù

### –°—Ü–µ–Ω–∞ 1: –ë—ã—Å—Ç—Ä–æ–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (Text)
```mermaid
sequenceDiagram
    participant U as User
    participant V as Voice Agent
    participant B as Booking Agent
    participant P as Payment Agent
    participant N as Notification Agent
    participant DB as Database

    U->>V: /booking –∏–ª–∏ "–∑–∞–±—Ä–æ–Ω–∏—Ä—É–π –∫–æ—Ä—Ç"
    V->>B: processBookingIntent()
    B->>DB: getAvailableSlots()
    DB-->>B: availableSlots[]
    B->>V: showSlotsKeyboard()
    V-->>U: –í—ã–±–µ—Ä–∏—Ç–µ —Å–ª–æ—Ç

    U->>V: selectSlot(courtId, time)
    V->>B: createBooking()
    B->>DB: createBooking()
    DB-->>B: booking
    B->>P: processPayment()
    P-->>V: showPaymentButtons()
    V-->>U: –í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã

    U->>P: selectPaymentMethod()
    P->>P: processPayment()
    P->>N: sendConfirmation()
    N-->>U: Booking confirmed!
```

### –°—Ü–µ–Ω–∞ 2: –ì–æ–ª–æ—Å–æ–≤–æ–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
```mermaid
sequenceDiagram
    participant U as User
    participant VA as Voice Agent
    participant WS as Whisper Service
    participant GPT as GPT-4
    participant B as Booking Agent
    participant P as Payment Agent

    U->>VA: [Voice Message] "–ó–∞–±—Ä–æ–Ω–∏—Ä—É–π –∫–æ—Ä—Ç –Ω–∞ –∑–∞–≤—Ç—Ä–∞ –≤ 18:00"
    VA->>WS: transcribeAudio(audio)
    WS-->>VA: text, confidence
    VA->>GPT: extractIntent(text, ru)
    GPT-->>VA: intent{action: "booking_create", params: {...}}
    VA->>B: executeBooking(intent)
    B->>P: processPayment()
    P-->>VA: paymentOptions
    VA-->>U: "–°–æ–∑–¥–∞–Ω–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ. –í—ã–±–µ—Ä–∏—Ç–µ –æ–ø–ª–∞—Ç—É: [Stars] [–ù–∞–ª–∏—á–Ω—ã–µ]"
```

### –°—Ü–µ–Ω–∞ 3: Daily Game
```mermaid
sequenceDiagram
    participant A as Admin
    participant DGA as Daily Game Agent
    participant U as Users
    participant N as Notification Agent
    participant G as Grouping Algorithm

    A->>DGA: createDailyGamePlan()
    DGA->>G: scheduleInvites()
    G->>N: sendInvitesByLevel()
    N-->>U: Invitation to join Daily Game

    U->>DGA: joinGame(gameId)
    DGA->>G: addPlayerToGroup()
    G->>G: checkGroupFull()

    alt Group full
        G->>N: notifyGroupReady()
        N-->>U: Group ready! Pay to confirm
    else Group not full
        G->>N: notifyWaiting()
        N-->>U: Waiting for players...
    end
```

### –°—Ü–µ–Ω–∞ 4: –û–ø–ª–∞—Ç–∞ Telegram Stars
```mermaid
sequenceDiagram
    participant U as User
    participant P as Payment Agent
    participant TS as Telegram Stars API
    participant B as Bot API
    participant DB as Database
    participant N as Notification Agent

    U->>P: payWithStars(bookingId)
    P->>TS: createInvoice()
    TS->>B: pre_checkout_query
    B->>P: handlePreCheckout()
    P-->>B: ok

    U->>B: confirmPayment()
    B->>TS: successful_payment
    TS->>P: paymentNotification()
    P->>DB: updateBookingStatus(paid)
    P->>N: sendConfirmation()
    N-->>U: Payment confirmed! Booking confirmed.
```

---

## üéÆ –î–ï–ô–°–¢–í–ò–Ø (ACTIONS)

### Action 1: Booking Actions (`booking-actions.ts`)
```typescript
import { Action, IAgentRuntime, Memory, State, HandlerCallback } from '@elizaos/core';
import { TaskEither, tryCatchAsync, right, left } from '@/core/functional/utils/result';
import { pipe, chain, map } from '@/core/functional/utils/composition';
import { z } from 'zod';

// –í—Ö–æ–¥–Ω–∞—è —Å—Ö–µ–º–∞
const BookingSearchSchema = z.object({
  courtType: z.enum(['paddle', 'tennis']),
  date: z.string(),
  duration: z.number().min(30).max(180),
  venueId: z.string().optional(),
});

const BookingCreateSchema = z.object({
  courtId: z.string().uuid(),
  startTime: z.string(),
  duration: z.number(),
  userId: z.string().uuid(),
});

export const searchSlotsAction: Action = {
  name: 'SEARCH_COURT_SLOTS',
  similes: ['BOOKING_SEARCH', 'FIND_SLOTS', '–ü–æ–∏—Å–∫ —Å–ª–æ—Ç–æ–≤'],
  description: '–ü–æ–∏—Å–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤ –¥–ª—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è',

  validate: async (runtime: IAgentRuntime, message: Memory): Promise<boolean> => {
    const text = message.content?.text?.toLowerCase() || '';
    const triggers = [
      '/booking', '/–∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å', '–Ω–∞–π—Ç–∏ –∫–æ—Ä—Ç', '—Å–≤–æ–±–æ–¥–Ω—ã–µ —Å–ª–æ—Ç—ã',
      'search slots', 'find court', 'book court'
    ];

    return triggers.some(trigger => text.includes(trigger));
  },

  handler: async (
    runtime: IAgentRuntime,
    message: Memory,
    state: State | undefined,
    options,
    callback?: HandlerCallback
  ) => {
    try {
      // –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
      const params = await validateBookingParams(message);

      // –ü–æ–∏—Å–∫ —Å–ª–æ—Ç–æ–≤
      const bookingService = runtime.getService('booking-service');
      const slots = await bookingService.searchAvailableSlots(params);

      if (slots.length === 0) {
        await callback?.({
          text: '‚ùå –ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è –Ω–µ—Ç —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤',
        });
        return { success: false, error: 'No slots available' };
      }

      // –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞ —Å inline –∫–Ω–æ–ø–∫–∞–º–∏
      const response = await formatSlotsResponse(slots, params.languageCode);

      await callback?.({
        text: response.text,
        attachments: response.attachments,
        action: 'SEARCH_SLOTS',
      });

      return { success: true, data: { slots, count: slots.length } };
    } catch (error) {
      await callback?.({
        text: '‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ —Å–ª–æ—Ç–æ–≤. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.',
      });
      return { success: false, error };
    }
  },

  examples: [
    [
      { name: 'user', content: { text: '/booking paddle tomorrow 2 hours' } },
      {
        name: 'assistant',
        content: {
          text: '–ù–∞–π–¥–µ–Ω–æ 5 –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤',
          action: 'SEARCH_SLOTS'
        }
      },
    ],
  ],
};

export const createBookingAction: Action = {
  name: 'CREATE_BOOKING',
  similes: ['BOOK_NOW', 'RESERVE_COURT', '–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å'],
  description: '–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è',

  validate: async (runtime: IAgentRuntime, message: Memory): Promise<boolean> => {
    const text = message.content?.text?.toLowerCase() || '';
    return text.includes('book') || text.includes('–∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å') || text.includes('ib:');
  },

  handler: async (
    runtime: IAgentRuntime,
    message: Memory,
    state: State | undefined,
    options,
    callback?: HandlerCallback
  ) => {
    try {
      // –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏–∑ callback_data –∏–ª–∏ —Ç–µ–∫—Å—Ç–∞
      const bookingData = await extractBookingData(message);

      // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
      const bookingService = runtime.getService('booking-service');
      const isAvailable = await bookingService.checkSlotAvailability(
        bookingData.courtId,
        bookingData.startTime,
        bookingData.duration
      );

      if (!isAvailable) {
        await callback?.({
          text: '‚ùå –≠—Ç–æ—Ç —Å–ª–æ—Ç —É–∂–µ –∑–∞–Ω—è—Ç. –í—ã–±–µ—Ä–∏—Ç–µ –¥—Ä—É–≥–æ–π.',
        });
        return { success: false, error: 'Slot not available' };
      }

      // –°–æ–∑–¥–∞–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
      const booking = await bookingService.createBooking({
        ...bookingData,
        userId: message.userId,
        status: 'pending_payment',
      });

      // –†–∞—Å—á–µ—Ç —Ü–µ–Ω—ã
      const pricingService = runtime.getService('pricing-service');
      const price = await pricingService.calculatePrice(bookingData);

      // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–ø–æ—Å–æ–±–æ–≤ –æ–ø–ª–∞—Ç—ã
      const paymentOptions = formatPaymentOptions(booking, price, bookingData.languageCode);

      await callback?.({
        text: `‚úÖ –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–æ!\n${paymentOptions.text}`,
        attachments: paymentOptions.attachments,
        action: 'CREATE_BOOKING',
      });

      return { success: true, data: { booking, price } };
    } catch (error) {
      await callback?.({
        text: '‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è.',
      });
      return { success: false, error };
    }
  },

  examples: [
    [
      { name: 'user', content: { text: 'ib:court123:2025-11-22:18:00' } } },
      {
        name: 'assistant',
        content: {
          text: '–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–æ! –í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã',
          action: 'CREATE_BOOKING'
        }
      },
    ],
  ],
};
```

### Action 2: Voice Actions (`voice-actions.ts`)
```typescript
export const voiceBookingAction: Action = {
  name: 'VOICE_BOOKING',
  similes: ['SPEECH_BOOKING', '–ì–æ–ª–æ—Å–æ–≤–æ–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ'],
  description: '–ì–æ–ª–æ—Å–æ–≤–æ–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ Whisper + GPT-4',

  validate: async (runtime: IAgentRuntime, message: Memory): Promise<boolean> => {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    return message.content?.audio !== undefined ||
           message.content?.voice !== undefined;
  },

  handler: async (
    runtime: IAgentRuntime,
    message: Memory,
    state: State | undefined,
    options,
    callback?: HandlerCallback
  ) => {
    const userId = message.userId;
    const languageCode = await getUserLanguage(userId);

    // –ù–∞—á–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
    await callback?.({
      text: 'üé§ –°–ª—É—à–∞—é –≤–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ...',
    });

    try {
      const voiceAgent = runtime.getService('voice-agent');

      // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
      const result = await voiceAgent.processVoiceMessage({
        audio: message.content?.audio || message.content?.voice,
        languageCode,
        sessionId: generateSessionId(userId),
      });

      // –û—Ç–ø—Ä–∞–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
      if (result.actionResult) {
        await callback?.({
          text: result.response.text,
          attachments: result.actionResult.attachments,
          action: 'VOICE_BOOKING',
        });
      } else {
        // –ù—É–∂–Ω—ã –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
        await callback?.({
          text: result.response.text,
          action: 'VOICE_BOOKING',
        });
      }

      return { success: true, data: result };
    } catch (error) {
      await callback?.({
        text: '‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.',
      });
      return { success: false, error };
    }
  },

  examples: [
    [
      { name: 'user', content: { text: '[voice message]', content_type: 'audio' } } },
      {
        name: 'assistant',
        content: {
          text: '–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –∑–∞–≤—Ç—Ä–∞ –≤ 18:00 —Å–æ–∑–¥–∞–Ω–æ!',
          action: 'VOICE_BOOKING'
        }
      },
    ],
  ],
};
```

### Action 3: Payment Actions (`payment-actions.ts`)
```typescript
export const payWithStarsAction: Action = {
  name: 'PAY_WITH_STARS',
  similes: ['TELEGRAM_STARS', '–û–ø–ª–∞—Ç–∞ Stars'],
  description: '–û–ø–ª–∞—Ç–∞ —á–µ—Ä–µ–∑ Telegram Stars',

  validate: async (runtime: IAgentRuntime, message: Memory): Promise<boolean> => {
    return message.content?.text?.includes('pay_stars:') ||
           message.content?.text?.includes('stars');
  },

  handler: async (
    runtime: IAgentRuntime,
    message: Memory,
    state: State | undefined,
    options,
    callback?: HandlerCallback
  ) => {
    try {
      const bookingId = extractBookingId(message.content?.text);

      const paymentService = runtime.getService('payment-service');
      const invoice = await paymentService.createStarsInvoice(bookingId);

      await callback?.({
        text: 'üí≥ –°–æ–∑–¥–∞–Ω –∏–Ω–≤–æ–π—Å –¥–ª—è –æ–ø–ª–∞—Ç—ã Telegram Stars',
        action: 'PAY_WITH_STARS',
      });

      return { success: true, data: { invoice } };
    } catch (error) {
      await callback?.({
        text: '‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∏–Ω–≤–æ–π—Å–∞.',
      });
      return { success: false, error };
    }
  },
};

export const uploadCashReceiptAction: Action = {
  name: 'UPLOAD_CASH_RECEIPT',
  similes: ['–ß–ï–ö', '–ù–ê–õ–ò–ß–ù–´–ï'],
  description: '–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ —á–µ–∫–∞ –ø—Ä–∏ –æ–ø–ª–∞—Ç–µ –Ω–∞–ª–∏—á–Ω—ã–º–∏',

  validate: async (runtime: IAgentRuntime, message: Memory): Promise<boolean> {
    return message.content?.photo !== undefined &&
           message.content?.text?.includes('cash:');
  },

  handler: async (
    runtime: IAgentRuntime,
    message: Memory,
    state: State | undefined,
    options,
    callback?: HandlerCallback
  ) => {
    const bookingId = extractBookingId(message.content?.text);
    const photoUrl = message.content?.photo?.[0]?.url;

    const paymentService = runtime.getService('payment-service');
    await paymentService.submitCashReceipt({
      bookingId,
      receiptImage: photoUrl,
      submittedBy: message.userId,
    });

    await callback?.({
      text: 'üì∏ –ß–µ–∫ –∑–∞–≥—Ä—É–∂–µ–Ω! –û–∂–∏–¥–∞–π—Ç–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.',
      action: 'UPLOAD_CASH_RECEIPT',
    });

    return { success: true };
  },
};
```

---

## üíº –°–ï–†–í–ò–°–´ (SERVICES)

### Service 1: Booking Service (`booking-service.ts`)
```typescript
import { Service, IAgentRuntime } from '@elizaos/core';
import { TaskEither, tryCatchAsync } from '@/core/functional/utils/result';
import { pipe, chain, map } from '@/core/functional/utils/composition';

export class BookingService extends Service {
  static serviceType = 'booking-service';

  capabilityDescription = '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∫–æ—Ä—Ç–æ–≤';

  async initialize(runtime: IAgentRuntime): Promise<void> {
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
    this.db = runtime.getDatabase();
    this.slotService = runtime.getService('slot-service');
    this.pricingService = runtime.getService('pricing-service');
    this.notificationService = runtime.getService('notification-service');
  }

  async start(): Promise<void> {
    // –ó–∞–ø—É—Å–∫ —Ñ–æ–Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á
    setInterval(() => {
      this.checkExpiredBookings();
    }, 60000); // –ö–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
  }

  async stop(): Promise<void> {
    // –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ñ–æ–Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á
  }

  /**
   * –ü–æ–∏—Å–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤
   */
  searchAvailableSlots(params: SlotSearchParams): TaskEither<Error, AvailableSlot[]> {
    return pipe(
      () => this.validateSearchParams(params),
      chain(validated =>
        pipe(
          () => this.slotService.getAvailableSlots(validated),
          chain(slots =>
            pipe(
              () => this.pricingService.calculatePricesForSlots(slots),
              map(pricedSlots => ({
                slots: pricedSlots,
                searchParams: validated,
                timestamp: new Date(),
              }))
            )
          )
        )
      )
    )();
  }

  /**
   * –°–æ–∑–¥–∞–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
   */
  createBooking(data: CreateBookingParams): TaskEither<Error, Booking> {
    return pipe(
      () => this.validateBookingData(data),
      chain(validated =>
        pipe(
          () => this.checkSlotAvailability(
            validated.courtId,
            validated.startTime,
            validated.duration
          ),
          chain(isAvailable => {
            if (!isAvailable) {
              return left(new Error('SLOT_NOT_AVAILABLE'));
            }

            return pipe(
              () => this.db.transaction(async (tx) => {
                // 1. –°–æ–∑–¥–∞–µ–º –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
                const booking = await tx.insert(bookings).values({
                  ...validated,
                  status: 'pending_payment',
                  bookingNumber: generateBookingNumber(),
                }).returning();

                // 2. –ë–ª–æ–∫–∏—Ä—É–µ–º —Å–ª–æ—Ç –Ω–∞ 30 –º–∏–Ω—É—Ç
                await this.blockSlot(tx, validated, 30 * 60 * 1000);

                // 3. –ü–ª–∞–Ω–∏—Ä—É–µ–º –æ—Ç–º–µ–Ω—É –ø—Ä–∏ –Ω–µ–æ–ø–ª–∞—Ç–µ
                await this.scheduleAutoCancellation(tx, booking[0].id, 30 * 60 * 1000);

                return booking[0];
              }),
              chain(booking =>
                pipe(
                  () => this.notificationService.sendBookingCreated(booking),
                  map(() => booking)
                )
              )
            )();
          })
        )
      )
    )();
  }

  /**
   * –û—Ç–º–µ–Ω–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
   */
  cancelBooking(bookingId: string, userId: string, reason?: string): TaskEither<Error, void> {
    return pipe(
      () => this.getBookingById(bookingId),
      chain(booking => {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∞ (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–ª–∏ –∞–¥–º–∏–Ω)
        if (booking.userId !== userId && !isAdmin(userId)) {
          return left(new Error('UNAUTHORIZED'));
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–æ–∂–Ω–æ –ª–∏ –æ—Ç–º–µ–Ω–∏—Ç—å
        if (booking.status === 'completed' || booking.status === 'cancelled') {
          return left(new Error('INVALID_STATUS'));
        }

        return pipe(
          () => this.db.transaction(async (tx) => {
            // 1. –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
            await tx.update(bookings)
              .set({
                status: 'cancelled',
                cancellationReason: reason,
                updatedAt: new Date(),
              })
              .where(eq(bookings.id, bookingId));

            // 2. –û—Å–≤–æ–±–æ–∂–¥–∞–µ–º —Å–ª–æ—Ç
            await this.releaseSlot(tx, bookingId);

            // 3. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤–æ–∑–≤—Ä–∞—Ç
            if (booking.paymentStatus === 'completed') {
              await this.processRefund(tx, bookingId);
            }

            // 4. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            await this.notificationService.sendBookingCancelled(booking);
          }),
          map(() => undefined)
        );
      })
    )();
  }

  /**
   * –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–ª–æ—Ç–∞
   */
  private async checkSlotAvailability(
    courtId: string,
    startTime: Date,
    duration: number
  ): Promise<boolean> {
    const endTime = new Date(startTime.getTime() + duration * 60000);

    const conflicts = await this.db
      .select()
      .from(bookings)
      .where(and(
        eq(bookings.courtId, courtId),
        eq(bookings.status, 'confirmed'),
        sql`${bookings.startTime} < ${endTime} AND ${bookings.endTime} > ${startTime}`
      ));

    return conflicts.length === 0;
  }

  /**
   * –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
   */
  private async checkExpiredBookings(): Promise<void> {
    const expiredBookings = await this.db
      .select()
      .from(bookings)
      .where(and(
        eq(bookings.status, 'pending_payment'),
        sql`${bookings.createdAt} < NOW() - INTERVAL '30 minutes'`
      ));

    for (const booking of expiredBookings) {
      await this.cancelBooking(booking.id, 'system', 'Payment timeout');
    }
  }
}
```

### Service 2: Voice AI Service (`voice-ai-service.ts`)
```typescript
export class VoiceAIService extends Service {
  static serviceType = 'voice-ai-service';

  async initialize(runtime: IAgentRuntime): Promise<void> {
    this.openai = new OpenAI({ apiKey: runtime.getSetting('OPENAI_API_KEY') });
    this.bookingService = runtime.getService('booking-service');
    this.paymentService = runtime.getService('payment-service');
  }

  /**
   * –û–±—Ä–∞–±–æ—Ç–∫–∞ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
   */
  async processVoiceMessage(params: VoiceProcessingParams): Promise<VoiceProcessingResult> {
    const { audio, languageCode, sessionId } = params;

    // 1. –¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è (Whisper)
    const transcription = await this.transcribeAudio(audio, languageCode);

    // 2. –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –Ω–∞–º–µ—Ä–µ–Ω–∏—è (GPT-4)
    const intent = await this.extractIntent(transcription.text, languageCode);

    // 3. –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è
    const actionResult = await this.executeIntent(intent, sessionId, languageCode);

    // 4. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞
    const response = await this.generateResponse(actionResult, languageCode);

    return {
      transcription,
      intent,
      actionResult,
      response,
      metadata: {
        sessionId,
        languageCode,
        timestamp: new Date(),
      }
    };
  }

  private async transcribeAudio(audio: any, languageCode: string): Promise<TranscriptionResult> {
    // –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –∞—É–¥–∏–æ —Ñ–∞–π–ª–∞
    const audioBuffer = await this.downloadAudio(audio.url);

    // –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ –¥–ª—è Whisper
    const audioFile = await this.createAudioFile(audioBuffer, audio.format);

    // –¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è
    const transcription = await this.openai.audio.transcriptions.create({
      file: audioFile,
      model: 'whisper-1',
      language: this.mapLanguageCode(languageCode),
      response_format: 'verbose_json',
      temperature: 0.1,
    });

    return {
      text: transcription.text,
      language: transcription.language,
      duration: transcription.duration,
      confidence: transcription.confidence || 0.9,
      segments: transcription.segments || [],
    };
  }

  private async extractIntent(text: string, languageCode: string): Promise<Intent> {
    const systemPrompt = this.getSystemPromptForLanguage(languageCode);

    const completion = await this.openai.chat.completions.create({
      model: 'gpt-4',
      messages: [
        { role: 'system', content: systemPrompt },
        { role: 'user', content: text }
      ],
      temperature: 0.1,
      response_format: { type: 'json_object' }
    });

    const content = completion.choices[0].message.content;
    return JSON.parse(content);
  }

  private getSystemPromptForLanguage(lang: string): string {
    const prompts = {
      ru: `–¢—ã –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –ø–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—é –∫–æ—Ä—Ç–æ–≤ –¥–ª—è –ø–∞–¥–µ–ª-–∫–ª—É–±–∞.
–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –∏–∑–≤–ª–µ–∫–∏ –Ω–∞–º–µ—Ä–µ–Ω–∏–µ.
–î–æ—Å—Ç—É–ø–Ω—ã–µ –Ω–∞–º–µ—Ä–µ–Ω–∏—è:
- booking_search: –ø–æ–∏—Å–∫ —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤
- booking_create: —Å–æ–∑–¥–∞–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- booking_cancel: –æ—Ç–º–µ–Ω–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- payment: –≤–æ–ø—Ä–æ—Å –æ–± –æ–ø–ª–∞—Ç–µ
- daily_game: —É—á–∞—Å—Ç–∏–µ –≤ Daily Game
- info: –æ–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

–û—Ç–≤–µ—Ç—å —Å—Ç—Ä–æ–≥–æ –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON:
{
  "intent": "–Ω–∞–º–µ—Ä–µ–Ω–∏–µ",
  "parameters": {
    "date": "YYYY-MM-DD" (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ),
    "time": "HH:mm" (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ),
    "duration": —á–∏—Å–ª–æ –º–∏–Ω—É—Ç (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ),
    "courtType": "paddle|tennis" (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  },
  "confidence": 0.95
}`,
      en: `You are a paddle court booking assistant.
Analyze user message and extract intent.
Available intents:
- booking_search: search for available slots
- booking_create: create booking
- booking_cancel: cancel booking
- payment: payment inquiry
- daily_game: daily game participation
- info: general information

Respond strictly in JSON format:
{
  "intent": "intent",
  "parameters": {
    "date": "YYYY-MM-DD" (optional),
    "time": "HH:mm" (optional),
    "duration": minutes number (optional),
    "courtType": "paddle|tennis" (optional)
  },
  "confidence": 0.95
}`,
      // ... –¥—Ä—É–≥–∏–µ —è–∑—ã–∫–∏
    };

    return prompts[lang] || prompts.en;
  }

  private async executeIntent(
    intent: Intent,
    sessionId: string,
    languageCode: string
  ): Promise<ActionResult> {
    switch (intent.intent) {
      case 'booking_search':
        return this.handleBookingSearch(intent.parameters, languageCode);

      case 'booking_create':
        return this.handleBookingCreate(intent.parameters, languageCode);

      case 'booking_cancel':
        return this.handleBookingCancel(intent.parameters, sessionId);

      case 'daily_game':
        return this.handleDailyGame(intent.parameters, languageCode);

      default:
        return {
          text: '–ò–∑–≤–∏–Ω–∏—Ç–µ, —è –Ω–µ –ø–æ–Ω—è–ª –≤–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–∫–∞–∑–∞—Ç—å: "–∑–∞–±—Ä–æ–Ω–∏—Ä—É–π –∫–æ—Ä—Ç –Ω–∞ –∑–∞–≤—Ç—Ä–∞ –≤ 18:00"',
          confidence: intent.confidence,
        };
    }
  }

  private async handleBookingSearch(
    params: IntentParameters,
    languageCode: string
  ): Promise<ActionResult> {
    const searchParams = {
      courtType: params.courtType || 'paddle',
      date: params.date ? new Date(params.date) : new Date(),
      duration: params.duration || 60,
    };

    const result = await this.bookingService.searchAvailableSlots(searchParams);

    if (result.isLeft()) {
      return {
        text: '–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Å–ª–æ—Ç—ã. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.',
        confidence: 0.8,
      };
    }

    const slots = result.value;

    if (slots.length === 0) {
      return {
        text: '–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è –Ω–µ—Ç —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤.',
        confidence: 0.9,
      };
    }

    const message = this.formatSlotsMessage(slots, languageCode);

    return {
      text: message,
      confidence: 0.95,
      data: { slots },
    };
  }
}
```

---

## üìã –°–•–ï–ú–´ –í–ê–õ–ò–î–ê–¶–ò–ò (ZOD)

### Booking Schemas (`booking-schemas.ts`)
```typescript
import { z } from 'zod';

// –ü–æ–∏—Å–∫ —Å–ª–æ—Ç–æ–≤
export const SlotSearchSchema = z.object({
  courtType: z.enum(['paddle', 'tennis']),
  date: z.string().regex(/^\d{4}-\d{2}-\d{2}$/),
  duration: z.number().int().min(30).max(180),
  venueId: z.string().uuid().optional(),
  languageCode: z.string().length(2).default('ru'),
});

export type SlotSearchInput = z.infer<typeof SlotSearchSchema>;

export const SlotSearchResponseSchema = z.object({
  success: z.boolean(),
  data: z.object({
    slots: z.array(z.object({
      courtId: z.string().uuid(),
      courtName: z.string(),
      startTime: z.string(),
      endTime: z.string(),
      duration: z.number(),
      price: z.number(),
      currency: z.string(),
    })),
    searchParams: SlotSearchSchema,
    count: z.number(),
    timestamp: z.date(),
  }),
  timestamp: z.date(),
});

export type SlotSearchResponse = z.infer<typeof SlotSearchResponseSchema>;

// –°–æ–∑–¥–∞–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
export const CreateBookingSchema = z.object({
  courtId: z.string().uuid(),
  startTime: z.string().datetime(),
  duration: z.number().int().min(30).max(180),
  userId: z.string().uuid(),
  bookingType: z.enum(['regular', 'daily_game', 'tournament']).default('regular'),
  notes: z.string().max(500).optional(),
});

export type CreateBookingInput = z.infer<typeof CreateBookingSchema>;

export const CreateBookingResponseSchema = z.object({
  success: z.boolean(),
  data: z.object({
    booking: z.object({
      id: z.string().uuid(),
      bookingNumber: z.string(),
      courtId: z.string().uuid(),
      startTime: z.string(),
      endTime: z.string(),
      duration: z.number(),
      status: z.string(),
      totalPrice: z.number(),
      currency: z.string(),
    }),
    price: z.object({
      basePrice: z.number(),
      finalPrice: z.number(),
      currency: z.string(),
      breakdown: z.object({
        base: z.number(),
        timeAdjustment: z.number(),
        dayAdjustment: z.number(),
        specialAdjustment: z.number(),
      }),
    }),
  }),
  timestamp: z.date(),
});

export type CreateBookingResponse = z.infer<typeof CreateBookingResponseSchema>;

// –û—Ç–º–µ–Ω–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
export const CancelBookingSchema = z.object({
  bookingId: z.string().uuid(),
  userId: z.string().uuid(),
  reason: z.string().max(200).optional(),
});

export type CancelBookingInput = z.infer<typeof CancelBookingSchema>;

export const CancelBookingResponseSchema = z.object({
  success: z.boolean(),
  message: z.string(),
  refundAmount: z.number().optional(),
  currency: z.string().optional(),
  timestamp: z.date(),
});

export type CancelBookingResponse = z.infer<typeof CancelBookingResponseSchema>;
```

### Payment Schemas (`payment-schemas.ts`)
```typescript
import { z } from 'zod';

// –û–ø–ª–∞—Ç–∞ Telegram Stars
export const StarsPaymentSchema = z.object({
  bookingId: z.string().uuid(),
  userId: z.string().uuid(),
  amount: z.number().positive(),
  currency: z.string().length(3),
});

export type StarsPaymentInput = z.infer<typeof StarsPaymentSchema>;

export const StarsPaymentResponseSchema = z.object({
  success: z.boolean(),
  data: z.object({
    invoice: z.object({
      invoiceId: z.string(),
      payload: z.string(),
      providerToken: z.string(),
      currency: z.string(),
      totalAmount: z.string(),
    }),
    paymentUrl: z.string().url().optional(),
  }),
  timestamp: z.date(),
});

export type StarsPaymentResponse = z.infer<typeof StarsPaymentResponseSchema>;

// –ó–∞–≥—Ä—É–∑–∫–∞ —á–µ–∫–∞ –Ω–∞–ª–∏—á–Ω—ã–º–∏
export const CashReceiptSchema = z.object({
  bookingId: z.string().uuid(),
  receiptImageUrl: z.string().url(),
  submittedBy: z.string().uuid(),
  amount: z.number().positive(),
  currency: z.string().length(3),
  notes: z.string().max(200).optional(),
});

export type CashReceiptInput = z.infer<typeof CashReceiptSchema>;

export const CashReceiptResponseSchema = z.object({
  success: z.boolean(),
  message: z.string(),
  receiptId: z.string().uuid(),
  status: z.string(),
  timestamp: z.date(),
});

export type CashReceiptResponse = z.infer<typeof CashReceiptResponseSchema>;

// –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∞–¥–º–∏–Ω–æ–º
export const AdminPaymentConfirmationSchema = z.object({
  paymentId: z.string().uuid(),
  adminId: z.string().uuid(),
  action: z.enum(['confirm', 'reject']),
  reason: z.string().max(200).optional(),
});

export type AdminPaymentConfirmationInput = z.infer<typeof AdminPaymentConfirmationSchema>;

export const AdminPaymentConfirmationResponseSchema = z.object({
  success: z.boolean(),
  message: z.string(),
  paymentStatus: z.string(),
  bookingStatus: z.string().optional(),
  timestamp: z.date(),
});

export type AdminPaymentConfirmationResponse = z.infer<typeof AdminPaymentConfirmationResponseSchema>;
```

### Voice Schemas (`voice-schemas.ts`)
```typescript
import { z } from 'zod';

// –ì–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
export const VoiceMessageSchema = z.object({
  audioUrl: z.string().url(),
  format: z.enum(['ogg', 'mp3', 'wav', 'm4a']),
  duration: z.number().positive(),
  languageCode: z.string().length(2),
  sessionId: z.string(),
});

export type VoiceMessageInput = z.infer<typeof VoiceMessageSchema>;

// –†–µ–∑—É–ª—å—Ç–∞—Ç —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏
export const TranscriptionSchema = z.object({
  text: z.string(),
  language: z.string(),
  duration: z.number(),
  confidence: z.number().min(0).max(1),
  segments: z.array(z.object({
    start: z.number(),
    end: z.number(),
    text: z.string(),
  })).optional(),
});

export type TranscriptionResult = z.infer<typeof TranscriptionSchema>;

// –ù–∞–º–µ—Ä–µ–Ω–∏–µ
export const IntentSchema = z.object({
  intent: z.enum([
    'booking_search',
    'booking_create',
    'booking_cancel',
    'payment',
    'daily_game',
    'info',
    'cancel',
    'help'
  ]),
  parameters: z.object({
    date: z.string().regex(/^\d{4}-\d{2}-\d{2}$/).optional(),
    time: z.string().regex(/^\d{2}:\d{2}$/).optional(),
    duration: z.number().int().min(30).max(180).optional(),
    courtType: z.enum(['paddle', 'tennis']).optional(),
    gameLevel: z.enum(['beginner', 'intermediate', 'advanced', 'pro']).optional(),
    paymentMethod: z.enum(['stars', 'cash', 'bank']).optional(),
  }),
  confidence: z.number().min(0).max(1),
  rawText: z.string(),
});

export type IntentResult = z.infer<typeof IntentSchema>;

// –†–µ–∑—É–ª—å—Ç–∞—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≥–æ–ª–æ—Å–∞
export const VoiceProcessingResultSchema = z.object({
  transcription: TranscriptionSchema,
  intent: IntentSchema,
  actionResult: z.object({
    type: z.string(),
    success: z.boolean(),
    text: z.string(),
    data: z.unknown().optional(),
    attachments: z.array(z.unknown()).optional(),
  }),
  response: z.object({
    text: z.string(),
    audioUrl: z.string().url().optional(),
    confidence: z.number().min(0).max(1),
  }),
  metadata: z.object({
    sessionId: z.string(),
    languageCode: z.string(),
    processingTime: z.number(),
    timestamp: z.date(),
  }),
});

export type VoiceProcessingResult = z.infer<typeof VoiceProcessingResultSchema>;
```

---

## üîê –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨ –ò –í–ê–õ–ò–î–ê–¶–ò–Ø

### Rate Limiting
```typescript
// utils/rate-limit.ts
import rateLimit from 'express-rate-limit';

export const bookingRateLimit = rateLimit({
  windowMs: 15 * 60 * 1000, // 15 –º–∏–Ω—É—Ç
  max: 10, // –º–∞–∫—Å–∏–º—É–º 10 –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  message: {
    error: 'RATE_LIMIT_EXCEEDED',
    message: '–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.',
    retryAfter: 900, // —Å–µ–∫—É–Ω–¥
  },
  standardHeaders: true,
  legacyHeaders: false,
});

export const voiceRateLimit = rateLimit({
  windowMs: 60 * 1000, // 1 –º–∏–Ω—É—Ç–∞
  max: 5, // –º–∞–∫—Å–∏–º—É–º 5 –≥–æ–ª–æ—Å–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
  message: {
    error: 'VOICE_RATE_LIMIT_EXCEEDED',
    message: '–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –≥–æ–ª–æ—Å–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π.',
    retryAfter: 60,
  },
});
```

### –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
```typescript
// utils/validators.ts
export class InputValidator {
  static validateBookingInput(data: unknown): TaskEither<Error, CreateBookingInput> {
    return tryCatchAsync(async () => {
      const validated = CreateBookingSchema.parse(data);

      // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
      const startTime = new Date(validated.startTime);
      const now = new Date();

      if (startTime <= now) {
        throw new Error('START_TIME_IN_PAST');
      }

      const hoursDiff = (startTime.getTime() - now.getTime()) / (1000 * 60 * 60);
      if (hoursDiff < 1) {
        throw new Error('BOOKING_TOO_EARLY');
      }

      // –ú–∞–∫—Å–∏–º—É–º –∑–∞ 30 –¥–Ω–µ–π
      if (hoursDiff > 24 * 30) {
        throw new Error('BOOKING_TOO_LATE');
      }

      return validated;
    }, (error) => {
      if (error instanceof z.ZodError) {
        return new Error(`VALIDATION_ERROR: ${error.errors.map(e => e.message).join(', ')}`);
      }
      return error as Error;
    });
  }

  static sanitizeText(text: string): string {
    // –£–¥–∞–ª—è–µ–º HTML —Ç–µ–≥–∏
    let sanitized = text.replace(/<[^>]*>/g, '');

    // –£–¥–∞–ª—è–µ–º –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –æ–ø–∞—Å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã
    sanitized = sanitized.replace(/[<>{}[\]\\`'"~!@#$%^&*()_+=|/]/g, '');

    // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –¥–ª–∏–Ω—É
    if (sanitized.length > 500) {
      sanitized = sanitized.substring(0, 500);
    }

    return sanitized.trim();
  }

  static validateImageUrl(url: string): boolean {
    try {
      const parsed = new URL(url);

      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–æ—Ç–æ–∫–æ–ª
      if (!['http:', 'https:'].includes(parsed.protocol)) {
        return false;
      }

      // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ (–º–∞–∫—Å 10MB)
      // –≠—Ç–æ –Ω—É–∂–Ω–æ –¥–µ–ª–∞—Ç—å –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–∞

      // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ
      const allowedExtensions = ['.jpg', '.jpeg', '.png', '.webp'];
      const pathname = parsed.pathname.toLowerCase();

      return allowedExtensions.some(ext => pathname.endsWith(ext));
    } catch {
      return false;
    }
  }
}
```

### SQL Injection Prevention
```typescript
// database/repositories/booking-repository.ts
import { db } from '../client';
import { bookings } from '../schema';
import { eq, and, sql } from 'drizzle-orm';

export class BookingRepository {
  async findByDateRange(startDate: Date, endDate: Date): Promise<Booking[]> {
    // ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –∑–∞–ø—Ä–æ—Å —á–µ—Ä–µ–∑ Drizzle ORM
    const result = await db
      .select()
      .from(bookings)
      .where(
        and(
          sql`${bookings.startTime} >= ${startDate}`,
          sql`${bookings.endTime} <= ${endDate}`
        )
      );

    return result;
  }

  async findByCourtAndTime(
    courtId: string,
    startTime: Date,
    endTime: Date
  ): Promise<Booking[]> {
    // ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –∑–∞–ø—Ä–æ—Å —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–∞—Ü–∏–µ–π
    const result = await db
      .select()
      .from(bookings)
      .where(
        and(
          eq(bookings.courtId, courtId),
          sql`${bookings.startTime} < ${endTime} AND ${bookings.endTime} > ${startTime}`
        )
      );

    return result;
  }

  // ‚ùå –ù–ò–ö–û–ì–î–ê –ù–ï –î–ï–õ–ê–ô–¢–ï –¢–ê–ö:
  // async unsafeQuery(userInput: string) {
  //   return db.execute(`
  //     SELECT * FROM bookings WHERE id = '${userInput}'
  //   `);
  // }
}
```

---

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

### Unit Tests (Vitest)
```typescript
// tests/services/booking-service.test.ts
import { describe, it, expect, beforeEach, vi } from 'vitest';
import { BookingService } from '@/services/booking-service';
import { createMockRuntime } from '@/test-utils/mock-runtime';

describe('BookingService', () => {
  let bookingService: BookingService;
  let mockDb: any;

  beforeEach(() => {
    mockDb = {
      insert: vi.fn(),
      select: vi.fn(),
      update: vi.fn(),
      transaction: vi.fn((callback) => callback({
        insert: vi.fn(),
        update: vi.fn(),
      })),
    };

    const runtime = createMockRuntime({
      getDatabase: () => mockDb,
    });

    bookingService = new BookingService();
    bookingService.initialize(runtime);
  });

  describe('searchAvailableSlots', () => {
    it('should return available slots for valid request', async () => {
      // Arrange
      const params = {
        courtType: 'paddle' as const,
        date: '2025-11-22',
        duration: 60,
        languageCode: 'ru',
      };

      mockDb.select.mockResolvedValue([]);
      mockDb.getPricingPolicies.mockResolvedValue([
        { pricePerHour: 800, currency: 'THB' }
      ]);

      // Act
      const result = await bookingService.searchAvailableSlots(params);

      // Assert
      expect(result.isRight()).toBe(true);
      if (result.isRight()) {
        expect(result.value.slots).toBeDefined();
        expect(result.value.count).toBeGreaterThanOrEqual(0);
      }
    });

    it('should return error for invalid date', async () => {
      // Arrange
      const params = {
        courtType: 'paddle' as const,
        date: 'invalid-date',
        duration: 60,
        languageCode: 'ru',
      };

      // Act
      const result = await bookingService.searchAvailableSlots(params);

      // Assert
      expect(result.isLeft()).toBe(true);
      if (result.isLeft()) {
        expect(result.value.message).toContain('invalid');
      }
    });
  });

  describe('createBooking', () => {
    it('should create booking successfully', async () => {
      // Arrange
      const data = {
        courtId: 'court-123',
        startTime: new Date('2025-11-22T18:00:00Z'),
        duration: 60,
        userId: 'user-456',
      };

      mockDb.select.mockResolvedValue([]);
      mockDb.transaction.mockImplementation((callback) => {
        const tx = {
          insert: vi.fn().mockReturnValue({
            returning: vi.fn().mockResolvedValue([{ id: 'booking-789' }]),
          }),
          update: vi.fn(),
        };
        return callback(tx);
      });

      // Act
      const result = await bookingService.createBooking(data);

      // Assert
      expect(result.isRight()).toBe(true);
      if (result.isRight()) {
        expect(result.value.bookingNumber).toBeDefined();
        expect(result.value.status).toBe('pending_payment');
      }
    });

    it('should reject booking for unavailable slot', async () => {
      // Arrange
      const data = {
        courtId: 'court-123',
        startTime: new Date('2025-11-22T18:00:00Z'),
        duration: 60,
        userId: 'user-456',
      };

      // –ï—Å—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–µ–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
      mockDb.select.mockResolvedValue([
        { id: 'booking-conflict', courtId: 'court-123' }
      ]);

      // Act
      const result = await bookingService.createBooking(data);

      // Assert
      expect(result.isLeft()).toBe(true);
      if (result.isLeft()) {
        expect(result.value.message).toContain('not available');
      }
    });
  });
});
```

### Integration Tests
```typescript
// tests/integration/booking-flow.test.ts
import { describe, it, expect, beforeAll, afterAll } from 'vitest';
import { TestClient } from '@/test-utils/test-client';

describe('Booking Flow Integration', () => {
  let client: TestClient;

  beforeAll(async () => {
    client = new TestClient();
    await client.setup();
  });

  afterAll(async () => {
    await client.teardown();
  });

  it('should complete full booking flow', async () => {
    // 1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏—â–µ—Ç —Å–ª–æ—Ç—ã
    const slotsResponse = await client.sendMessage('/booking paddle tomorrow 2 hours');
    expect(slotsResponse.text).toContain('–ù–∞–π–¥–µ–Ω–æ');

    // 2. –í—ã–±–∏—Ä–∞–µ—Ç —Å–ª–æ—Ç
    const bookingResponse = await client.sendCallback('ib:court123:2025-11-22:18:00');
    expect(bookingResponse.text).toContain('–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–æ');

    // 3. –í—ã–±–∏—Ä–∞–µ—Ç –æ–ø–ª–∞—Ç—É Stars
    const paymentResponse = await client.sendCallback('pay_stars:booking-123');
    expect(paymentResponse.action).toBe('PAY_WITH_STARS');

    // 4. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—É (—Å–∏–º—É–ª—è—Ü–∏—è)
    await client.simulateStarsPayment('booking-123');

    // 5. –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å
    const statusResponse = await client.sendMessage('/my_bookings');
    expect(statusResponse.text).toContain('confirmed');
  });
});
```

### E2E Tests
```typescript
// tests/e2e/voice-booking.test.ts
import { describe, it, expect } from 'vitest';
import { E2ETestRunner } from '@/test-utils/e2e-runner';

describe('Voice Booking E2E', () => {
  const runner = new E2ETestRunner();

  it('should book via voice in Russian', async () => {
    const result = await runner.testScenario({
      user: 'user-123',
      language: 'ru',
      steps: [
        {
          action: 'voice_message',
          content: '–ó–∞–±—Ä–æ–Ω–∏—Ä—É–π –∫–æ—Ä—Ç –Ω–∞ –∑–∞–≤—Ç—Ä–∞ –≤ —à–µ—Å—Ç—å –≤–µ—á–µ—Ä–∞ –Ω–∞ –ø–æ–ª—Ç–æ—Ä–∞ —á–∞—Å–∞',
        },
        {
          action: 'verify_response',
          expectedContains: '–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–æ',
        },
        {
          action: 'verify_database',
          table: 'bookings',
          conditions: {
            status: 'pending_payment',
          },
        },
      ],
    });

    expect(result.success).toBe(true);
    expect(result.confidence).toBeGreaterThan(0.8);
  });

  it('should handle voice in German', async () => {
    const result = await runner.testScenario({
      user: 'user-456',
      language: 'de',
      steps: [
        {
          action: 'voice_message',
          content: 'Buche einen Platz f√ºr morgen um 18 Uhr',
        },
        {
          action: 'verify_response',
          expectedContains: 'Buchung erstellt',
        },
      ],
    });

    expect(result.success).toBe(true);
  });
});
```

---

## üöÄ –†–ê–ó–í–ï–†–¢–´–í–ê–ù–ò–ï

### package.json
```json
{
  "name": "@vibee/agent-paddle",
  "version": "1.0.0",
  "description": "VIBEE agent plugin for padel club management",
  "type": "module",
  "main": "./dist/index.js",
  "types": "./dist/index.d.ts",
  "files": [
    "dist",
    "package.json",
    "README.md"
  ],
  "scripts": {
    "build": "tsc -p tsconfig.json",
    "dev": "tsc -w -p tsconfig.json",
    "test": "vitest",
    "test:coverage": "vitest --coverage",
    "test:integration": "vitest --run tests/integration",
    "test:e2e": "vitest --run tests/e2e",
    "type-check": "tsc --noEmit",
    "lint": "eslint src --ext .ts",
    "lint:fix": "eslint src --ext .ts --fix",
    "format": "prettier --write src",
    "format:check": "prettier --check src"
  },
  "dependencies": {
    "@elizaos/core": "^1.0.0",
    "openai": "^4.0.0",
    "drizzle-orm": "^0.44.0",
    "pg": "^8.0.0",
    "zod": "^3.0.0",
    "dayjs": "^1.11.0"
  },
  "devDependencies": {
    "typescript": "^5.0.0",
    "vitest": "^1.0.0",
    "@vitest/coverage-v8": "^1.0.0",
    "eslint": "^8.0.0",
    "@typescript-eslint/eslint-plugin": "^6.0.0",
    "@typescript-eslint/parser": "^6.0.0",
    "prettier": "^3.0.0"
  },
  "peerDependencies": {
    "@vibee/core": ">=1.0.0"
  },
  "engines": {
    "node": ">=18.0.0"
  },
  "keywords": [
    "vibee",
    "agent",
    "padel",
    "booking",
    "telegram",
    "elizaos"
  ],
  "author": "VIBEE Team",
  "license": "MIT"
}
```

### Dockerfile
```dockerfile
FROM node:18-alpine AS base

WORKDIR /app

# Install dependencies
COPY package.json package-lock.json* ./
RUN npm ci

# Copy source
COPY . .

# Build
RUN npm run build

# Production image
FROM node:18-alpine AS production

WORKDIR /app

# Copy built application
COPY --from=base /app/dist ./dist
COPY --from=base /app/package.json ./
COPY --from=base /app/node_modules ./node_modules

# Create non-root user
RUN addgroup -g 1001 -S nodejs && \
    adduser -S vibee -u 1001

USER vibee

EXPOSE 3000

CMD ["node", "dist/index.js"]
```

### Docker Compose
```yaml
version: '3.8'

services:
  app:
    build: .
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
      - DATABASE_URL=postgresql://postgres:password@postgres:5432/vibee
      - REDIS_URL=redis://redis:6379
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - BOT_TOKEN=${BOT_TOKEN}
    depends_on:
      - postgres
      - redis
    restart: unless-stopped

  postgres:
    image: postgres:15-alpine
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: password
      POSTGRES_DB: vibee
    volumes:
      - postgres_data:/var/lib/postgresql/data
    restart: unless-stopped

  redis:
    image: redis:7-alpine
    volumes:
      - redis_data:/data
    restart: unless-stopped

volumes:
  postgres_data:
  redis_data:
```

---

## üìä –ú–û–ù–ò–¢–û–†–ò–ù–ì –ò –ú–ï–¢–†–ò–ö–ò

### Health Check Endpoint
```typescript
// routes/health.ts
import { Router } from 'express';

export const healthRouter = Router();

healthRouter.get('/', async (req, res) => {
  const health = {
    status: 'ok',
    timestamp: new Date().toISOString(),
    uptime: process.uptime(),
    version: process.env.npm_package_version,
  };

  res.json(health);
});

healthRouter.get('/detailed', async (req, res) => {
  try {
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ë–î
    const dbStatus = await checkDatabase();

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ Redis
    const redisStatus = await checkRedis();

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–Ω–µ—à–Ω–∏—Ö API
    const openaiStatus = await checkOpenAI();
    const telegramStatus = await checkTelegramBot();

    const detailed = {
      status: 'ok',
      timestamp: new Date().toISOString(),
      uptime: process.uptime(),
      services: {
        database: dbStatus,
        redis: redisStatus,
        openai: openaiStatus,
        telegram: telegramStatus,
      },
      metrics: {
        activeBookings: await getActiveBookingsCount(),
        pendingPayments: await getPendingPaymentsCount(),
        voiceSessions: await getActiveVoiceSessionsCount(),
      },
    };

    res.json(detailed);
  } catch (error) {
    res.status(500).json({
      status: 'error',
      error: error.message,
      timestamp: new Date().toISOString(),
    });
  }
});

async function checkDatabase(): Promise<ServiceStatus> {
  try {
    await db.execute('SELECT 1');
    return { status: 'healthy', responseTime: 0 };
  } catch (error) {
    return { status: 'unhealthy', error: error.message };
  }
}
```

### Custom Metrics
```typescript
// utils/metrics.ts
import { register, Counter, Histogram, Gauge } from 'prom-client';

// –ú–µ—Ç—Ä–∏–∫–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
export const bookingAttemptsTotal = new Counter({
  name: 'booking_attempts_total',
  help: 'Total number of booking attempts',
  labelNames: ['courtType', 'status', 'source'],
});

export const bookingDuration = new Histogram({
  name: 'booking_duration_seconds',
  help: 'Time spent on booking',
  labelNames: ['action'],
  buckets: [0.5, 1, 2, 5, 10],
});

// –ú–µ—Ç—Ä–∏–∫–∏ –ø–ª–∞—Ç–µ–∂–µ–π
export const paymentsTotal = new Counter({
  name: 'payments_total',
  help: 'Total number of payments',
  labelNames: ['method', 'status', 'currency'],
});

export const paymentAmount = new Histogram({
  name: 'payment_amount',
  help: 'Payment amount distribution',
  labelNames: ['currency'],
  buckets: [100, 500, 1000, 5000, 10000],
});

// –ú–µ—Ç—Ä–∏–∫–∏ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ –ò–ò
export const voiceProcessingTime = new Histogram({
  name: 'voice_processing_duration_seconds',
  help: 'Time spent processing voice messages',
  labelNames: ['language', 'status'],
  buckets: [1, 2, 5, 10, 15, 30],
});

export const voiceConfidence = new Histogram({
  name: 'voice_recognition_confidence',
  help: 'Voice recognition confidence score',
  labelNames: ['language'],
  buckets: [0.5, 0.6, 0.7, 0.8, 0.9, 0.95, 0.99],
});

// –ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
export const activeUsersGauge = new Gauge({
  name: 'active_users_total',
  help: 'Total number of active users',
});

export const dailyGameParticipantsGauge = new Gauge({
  name: 'daily_game_participants_total',
  help: 'Total number of daily game participants',
});

// –≠–∫—Å–ø–æ—Ä—Ç –º–µ—Ç—Ä–∏–∫
export async function getMetrics() {
  return await register.metrics();
}
```

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
```typescript
// utils/logger.ts
import winston from 'winston';

const logger = winston.createLogger({
  level: process.env.LOG_LEVEL || 'info',
  format: winston.format.combine(
    winston.format.timestamp(),
    winston.format.errors({ stack: true }),
    winston.format.json()
  ),
  defaultMeta: { service: 'agent-paddle' },
  transports: [
    new winston.transports.File({ filename: 'logs/error.log', level: 'error' }),
    new winston.transports.File({ filename: 'logs/combined.log' }),
  ],
});

if (process.env.NODE_ENV !== 'production') {
  logger.add(new winston.transports.Console({
    format: winston.format.simple()
  }));
}

export { logger };

// –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è —Å–æ–±—ã—Ç–∏–π
export function logBookingEvent(event: string, data: any) {
  logger.info('booking_event', {
    event,
    bookingId: data.bookingId,
    userId: data.userId,
    courtId: data.courtId,
    timestamp: new Date().toISOString(),
  });
}

export function logPaymentEvent(event: string, data: any) {
  logger.info('payment_event', {
    event,
    paymentId: data.paymentId,
    bookingId: data.bookingId,
    amount: data.amount,
    currency: data.currency,
    method: data.method,
    timestamp: new Date().toISOString(),
  });
}
```

---

## üéØ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –ê–ù–ê–õ–ò–ó –¢–ó –ò –õ–£–ß–®–ò–ï –ü–†–ê–ö–¢–ò–ö–ò

### –ß—Ç–æ —É–ª—É—á—à–µ–Ω–æ –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å –±–∞–∑–æ–≤—ã–º –¢–ó:

#### ‚úÖ 1. –¢–µ—Ö–Ω–∏–∫–∞ One-Shot
**–ë—ã–ª–æ**: –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ—Ç–∞–ª–µ–π –¥–ª—è –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
**–°—Ç–∞–ª–æ**:
- –î–µ—Ç–∞–ª—å–Ω—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã —Å –∫–æ–¥–æ–º
- –ü–æ–ª–Ω–∞—è —Å—Ö–µ–º–∞ –ë–î —Å –∏–Ω–¥–µ–∫—Å–∞–º–∏
- –í—Å–µ —Å—Ö–µ–º—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –ø—Ä–æ–ø–∏—Å–∞–Ω—ã –ø–æ—à–∞–≥–æ–≤–æ

#### ‚úÖ 2. –ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ—Å—Ç—å (10 —è–∑—ã–∫–æ–≤)
**–ë—ã–ª–æ**: 3 —è–∑—ã–∫–∞ (—Ä—É—Å—Å–∫–∏–π, –∞–Ω–≥–ª–∏–π—Å–∫–∏–π, –∏–≤—Ä–∏—Ç)
**–°—Ç–∞–ª–æ**: 10 —è–∑—ã–∫–æ–≤ —Å –ø–æ–ª–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π:
- –†—É—Å—Å–∫–∏–π, –ê–Ω–≥–ª–∏–π—Å–∫–∏–π, –ù–µ–º–µ—Ü–∫–∏–π
- –ò–≤—Ä–∏—Ç (RTL), –ê—Ä–∞–±—Å–∫–∏–π (RTL)
- –ò—Å–ø–∞–Ω—Å–∫–∏–π, –§—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π, –ò—Ç–∞–ª—å—è–Ω—Å–∫–∏–π
- –ü–æ—Ä—Ç—É–≥–∞–ª—å—Å–∫–∏–π, –ö–∏—Ç–∞–π—Å–∫–∏–π

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ**:
- RTL –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–ª—è –∏–≤—Ä–∏—Ç–∞ –∏ –∞—Ä–∞–±—Å–∫–æ–≥–æ
- –õ–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —è–∑—ã–∫–∞
- –ö—É–ª—å—Ç—É—Ä–Ω–æ-–∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è

#### ‚úÖ 3. –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∞–≥–µ–Ω—Ç—ã (7 –∞–≥–µ–Ω—Ç–æ–≤)
**–ë—ã–ª–æ**: –ú–æ–Ω–æ–ª–∏—Ç–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
**–°—Ç–∞–ª–æ**: 7 —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤:
1. Booking Agent
2. Payment Agent
3. Voice Agent
4. Daily Game Agent
5. Admin Agent
6. Analytics Agent
7. Notification Agent

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
- –ò–∑–æ–ª—è—Ü–∏—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
- –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å
- –õ–µ–≥–∫–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

#### ‚úÖ 4. –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ
**–ë—ã–ª–æ**: –°–º–µ—à–∞–Ω–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã
**–°—Ç–∞–ª–æ**: –°—Ç—Ä–æ–≥–æ–µ FP:
- TaskEither –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- Either –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- pipe() –¥–ª—è –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏
- –ò–º–º—É—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö
- –ß–∏—Å—Ç—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –±–µ–∑ –ø–æ–±–æ—á–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤

#### ‚úÖ 5. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å
**–ë—ã–ª–æ**: –ë–∞–∑–æ–≤—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
**–°—Ç–∞–ª–æ**:
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ë–î —Å –∏–Ω–¥–µ–∫—Å–∞–º–∏
- Redis –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
- Event-driven –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (Inngest)
- Rate limiting
- Graceful degradation

#### ‚úÖ 6. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
**–ë—ã–ª–æ**: –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –∑–∞—â–∏—Ç–∞
**–°—Ç–∞–ª–æ**:
- –í—Å–µ –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ Zod
- SQL injection prevention (—Ç–æ–ª—å–∫–æ Drizzle ORM)
- XSS protection
- Rate limiting –¥–ª—è API –∏ –≥–æ–ª–æ—Å–∞
- –í–∞–ª–∏–¥–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- –°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞

#### ‚úÖ 7. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
**–ë—ã–ª–æ**: –û—Ç–¥–µ–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã
**–°—Ç–∞–ª–æ**: –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
- Unit —Ç–µ—Å—Ç—ã (Vitest)
- Integration —Ç–µ—Å—Ç—ã
- E2E —Ç–µ—Å—Ç—ã —Å —Ä–µ–∞–ª—å–Ω—ã–º Telegram
- –¢–µ—Å—Ç—ã –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ –ò–ò –Ω–∞ 10 —è–∑—ã–∫–∞—Ö
- –ü–æ–∫—Ä—ã—Ç–∏–µ > 85%

#### ‚úÖ 8. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –Ω–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å
**–ë—ã–ª–æ**: –ë–∞–∑–æ–≤—ã–µ health checks
**–°—Ç–∞–ª–æ**:
- Prometheus –º–µ—Ç—Ä–∏–∫–∏
- –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (Winston)
- –î–µ—Ç–∞–ª—å–Ω—ã–µ health checks
- Performance –º–µ—Ç—Ä–∏–∫–∏
- Error tracking

#### ‚úÖ 9. –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è
**–ë—ã–ª–æ**: –¢–æ–ª—å–∫–æ –æ–ø–∏—Å–∞–Ω–∏–µ
**–°—Ç–∞–ª–æ**: –ì–æ—Ç–æ–≤–æ–µ —Ä–µ—à–µ–Ω–∏–µ:
- Multi-stage Dockerfile
- Docker Compose —Å –ë–î –∏ Redis
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ–±—Ä–∞–∑—ã
- Non-root –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å

#### ‚úÖ 10. CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏
**–ë—ã–ª–æ**: –ë–∞–∑–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
**–°—Ç–∞–ª–æ**: –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞:
- Repository –ø–∞—Ç—Ç–µ—Ä–Ω
- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç–∏
- SELECT FOR UPDATE –¥–ª—è –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫
- Audit trail
- Soft delete (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

---

## üìù –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

#### 1. Event Sourcing (–¥–ª—è –∞—É–¥–∏—Ç–∞)
```typescript
// –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –∞—É–¥–∏—Ç–∞
export const bookingEvents = pgTable('booking_events', {
  id: uuid('id').primaryKey(),
  bookingId: uuid('booking_id').references(() => bookings.id),
  eventType: varchar('event_type', { length: 50 }),
  eventData: text('event_data'), // JSON
  userId: uuid('user_id'),
  timestamp: timestamp('timestamp').defaultNow(),
});
```

#### 2. CQRS (—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥ –∏ –∑–∞–ø—Ä–æ—Å–æ–≤)
```typescript
// –ú–æ–∂–Ω–æ –≤–Ω–µ–¥—Ä–∏—Ç—å –¥–ª—è –ª—É—á—à–µ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
export class BookingCommandHandler {
  async handleCreateBooking(command: CreateBookingCommand) {
    // –ó–∞–ø–∏—Å—å –≤ –ë–î
  }
}

export class BookingQueryHandler {
  async handleGetBooking(query: GetBookingQuery) {
    // –ß—Ç–µ–Ω–∏–µ –∏–∑ –∫—ç—à–∞/—Ä–µ–ø–ª–∏–∫–∏
  }
}
```

#### 3. Saga Pattern (–¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π)
```typescript
// –î–ª—è —Å–ª–æ–∂–Ω—ã—Ö –±–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å–æ–≤
export class BookingSaga {
  steps = [
    () => this.createBooking(),
    () => this.blockSlot(),
    () => this.chargePayment(),
    () => this.sendConfirmation(),
  ];

  async execute() {
    for (const step of this.steps) {
      try {
        await step();
      } catch (error) {
        await this.compensate();
        throw error;
      }
    }
  }
}
```

### –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

#### 1. Kubernetes (–¥–ª—è production)
```yaml
# k8s/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: agent-paddle
spec:
  replicas: 3
  selector:
    matchLabels:
      app: agent-paddle
  template:
    metadata:
      labels:
        app: agent-paddle
    spec:
      containers:
      - name: agent-paddle
        image: vibee/agent-paddle:latest
        ports:
        - containerPort: 3000
        env:
        - name: DATABASE_URL
          valueFrom:
            secretKeyRef:
              name: vibee-secrets
              key: database-url
```

#### 2. CI/CD Pipeline
```yaml
# .github/workflows/deploy.yml
name: Deploy

on:
  push:
    branches: [main]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: '18'

      - run: npm ci
      - run: npm run type-check
      - run: npm run lint
      - run: npm run test
      - run: npm run test:coverage

  build-and-deploy:
    needs: test
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Build Docker image
        run: docker build -t vibee/agent-paddle:${{ github.sha }} .
      - name: Deploy to production
        run: |
          # kubectl set image deployment/agent-paddle
          # kubectl rollout restart deployment/agent-paddle
```

#### 3. Observability Stack
```yaml
# monitoring/docker-compose.yml
version: '3.8'
services:
  prometheus:
    image: prom/prometheus
    ports:
      - "9090:9090"
    volumes:
      - ./prometheus.yml:/etc/prometheus/prometheus.yml

  grafana:
    image: grafana/grafana
    ports:
      - "3001:3000"
    environment:
      - GF_SECURITY_ADMIN_PASSWORD=admin

  jaeger:
    image: jaegertracing/all-in-one
    ports:
      - "16686:16686"
      - "14268:14268"
```

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

#### 1. Database Connection Pooling
```typescript
// database/client.ts
import { Pool } from 'pg';

export const pool = new Pool({
  connectionString: process.env.DATABASE_URL,
  max: 20, // –º–∞–∫—Å–∏–º—É–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
  idleTimeoutMillis: 30000,
  connectionTimeoutMillis: 2000,
});

export const db = drizzle(pool);
```

#### 2. Redis Caching
```typescript
// services/cache-service.ts
export class CacheService {
  private redis: Redis;

  async get<T>(key: string): Promise<T | null> {
    const cached = await this.redis.get(key);
    return cached ? JSON.parse(cached) : null;
  }

  async set<T>(key: string, value: T, ttl: number): Promise<void> {
    await this.redis.setex(key, ttl, JSON.stringify(value));
  }

  async invalidatePattern(pattern: string): Promise<void> {
    const keys = await this.redis.keys(pattern);
    if (keys.length > 0) {
      await this.redis.del(...keys);
    }
  }
}
```

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (Roadmap)

#### 1. –¢—É—Ä–Ω–∏—Ä—ã –∏ –ª–∏–≥–∏
```typescript
export const tournaments = pgTable('tournaments', {
  id: uuid('id').primaryKey(),
  name: varchar('name', { length: 255 }).notNull(),
  startDate: date('start_date').notNull(),
  endDate: date('end_date').notNull(),
  registrationDeadline: timestamp('registration_deadline'),
  format: varchar('format', { length: 50 }), // 'single_elimination', 'double_elimination', 'round_robin'
  maxParticipants: integer('max_participants'),
  entryFee: numeric('entry_fee', { precision: 10, scale: 2 }),
  prizePool: numeric('prize_pool', { precision: 10, scale: 2 }),
  status: varchar('status', { length: 50 }).default('registration'),
});
```

#### 2. –ü—Ä–æ–≥—Ä–∞–º–º–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏
```typescript
export const loyaltyPrograms = pgTable('loyalty_programs', {
  id: uuid('id').primaryKey(),
  name: varchar('name', { length: 255 }).notNull(),
  description: text('description'),
  pointsRate: numeric('points_rate', { precision: 10, scale: 2 }), // –±–∞—Ç–ª—ã –∑–∞ 1 THB
  tierThreshold: integer('tier_threshold'), // –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –±–∞—Ç–ª—ã –¥–ª—è —É—Ä–æ–≤–Ω—è
  benefits: text('benefits'), // JSON
  isActive: boolean('is_active').default(true),
});
```

#### 3. –ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
```typescript
// React Native –º–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
import React from 'react';
import { View, Text, Button } from 'react-native';
import { useBooking } from '@/hooks/useBooking';

export function BookingScreen() {
  const { searchSlots, createBooking, loading, error } = useBooking();

  const handleBooking = async () => {
    await searchSlots({
      courtType: 'paddle',
      date: '2025-11-22',
      duration: 60,
    });

    // –û—Ç–∫—Ä—ã—Ç—å –∫–∞–ª–µ–Ω–¥–∞—Ä—å –¥–ª—è –≤—ã–±–æ—Ä–∞
    // –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–æ—Å–æ–±—ã –æ–ø–ª–∞—Ç—ã
  };

  return (
    <View>
      <Text>–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ—Ä—Ç–∞</Text>
      <Button title="–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å" onPress={handleBooking} />
    </View>
  );
}
```

---

## üìå –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

–î–∞–Ω–Ω–æ–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π **–ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–ª–∞–≥–∏–Ω–∞ agent-paddle** —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Ç–µ—Ö–Ω–∏–∫–∏ One-shot. –û–Ω–æ –≤–∫–ª—é—á–∞–µ—Ç:

### ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
1. **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å 7 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–º–∏ –∞–≥–µ–Ω—Ç–∞–º–∏** - —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –∏ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–º–∏
2. **–ü–æ–ª–Ω–∞—è –º–æ–¥–µ–ª—å –ë–î** - 10 —Ç–∞–±–ª–∏—Ü —Å –∏–Ω–¥–µ–∫—Å–∞–º–∏ –∏ —Å–≤—è–∑—è–º–∏
3. **–î–µ—Ç–∞–ª—å–Ω—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã** - 5 –∫–ª—é—á–µ–≤—ã—Ö –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ —Å –ø—Å–µ–≤–¥–æ–∫–æ–¥–æ–º
4. **10 —è–∑—ã–∫–æ–≤** - –ø–æ–ª–Ω–∞—è –º—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ—Å—Ç—å —Å RTL –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π
5. **–í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è (Actions)** - —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –∏ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π
6. **–°–µ—Ä–≤–∏—Å—ã (Services)** - —Å –ø–æ–ª–Ω–æ–π –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–æ–π
7. **–°—Ö–µ–º—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (Zod)** - –¥–ª—è –≤—Å–µ—Ö –≤—Ö–æ–¥–Ω—ã—Ö/–≤—ã—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
8. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - Unit, Integration, E2E
9. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - –∑–∞—â–∏—Ç–∞ –æ—Ç –≤—Å–µ—Ö –æ—Å–Ω–æ–≤–Ω—ã—Ö —É–≥—Ä–æ–∑
10. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - –º–µ—Ç—Ä–∏–∫–∏, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, health checks
11. **–†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ** - Docker, Compose, K8s
12. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ, –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è, –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

### üéØ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:
- ‚úÖ **0 —É—Ç–æ—á–Ω–µ–Ω–∏–π** - –≤—Å–µ –¥–µ—Ç–∞–ª–∏ –æ–ø–∏—Å–∞–Ω—ã
- ‚úÖ **100% —Ç–∏–ø–∏–∑–∞—Ü–∏—è** - TypeScript/Zod
- ‚úÖ **–¢–µ—Å—Ç—ã –≥–æ—Ç–æ–≤—ã** - –æ–ø–∏—Å–∞–Ω—ã —Å—Ü–µ–Ω–∞—Ä–∏–∏
- ‚úÖ **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** - –ø–æ–ª–Ω–∞—è –∏ –¥–µ—Ç–∞–ª—å–Ω–∞—è
- ‚úÖ **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** - –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω–∞—è –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–∞—è

### üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤:
1. –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞ —á–µ—Ä–µ–∑ ElizaOS CLI
2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö (Drizzle –º–∏–≥—Ä–∞—Ü–∏–∏)
3. –ò–º–ø–ª–µ–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –∞–≥–µ–Ω—Ç–æ–≤ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
4. –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç—ã
5. –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å –≤–Ω–µ—à–Ω–∏–º–∏ API
6. –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å —á–µ—Ä–µ–∑ Docker
7. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

**–í—Ä–µ–º—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏**: 3-4 –Ω–µ–¥–µ–ª–∏ (–ø—Ä–∏ —Ä–∞–±–æ—Ç–µ –∫–æ–º–∞–Ω–¥—ã –∏–∑ 3-5 —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤)

---

**–ê–≤—Ç–æ—Ä**: Claude AI Assistant
**–î–∞—Ç–∞**: 2025-11-21
**–í–µ—Ä—Å–∏—è –¢–ó**: 1.0 (Final)
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ One-Shot —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
