{"version":3,"sources":["../src/index.ts"],"sourcesContent":["import { createOpenAI } from '@ai-sdk/openai';\nimport type {\n  IAgentRuntime,\n  ImageDescriptionParams,\n  ModelTypeName,\n  ObjectGenerationParams,\n  Plugin,\n  TextEmbeddingParams,\n} from '@elizaos/core';\nimport {\n  type DetokenizeTextParams,\n  type GenerateTextParams,\n  ModelType,\n  type TokenizeTextParams,\n  logger,\n} from '@elizaos/core';\nimport { generateObject, generateText } from 'ai';\nimport { type TiktokenModel, encodingForModel } from 'js-tiktoken';\n\n\n/**\n * Resolves the base URL for the RedPill API using runtime settings or a default value.\n *\n * @param runtime - The runtime environment providing configuration settings.\n * @returns The resolved base URL for RedPill API requests.\n */\nfunction getBaseURL(runtime: IAgentRuntime): string {\n  return runtime.getSetting('REDPILL_BASE_URL') || 'https://api.redpill.ai/v1';\n}\n\n/**\n * Asynchronously tokenizes the given text based on the specified model and prompt.\n *\n * @param {ModelTypeName} model - The type of model to use for tokenization.\n * @param {string} prompt - The text prompt to tokenize.\n * @returns {number[]} - An array of tokens representing the encoded prompt.\n */\nasync function tokenizeText(model: ModelTypeName, prompt: string) {\n  const modelName =\n    model === ModelType.TEXT_SMALL\n      ? (process.env.REDPILL_SMALL_MODEL ?? process.env.SMALL_MODEL ?? 'gpt-4o-mini')\n      : (process.env.REDPILL_LARGE_MODEL ?? process.env.LARGE_MODEL ?? 'gpt-4o');\n  const encoding = encodingForModel(modelName as TiktokenModel);\n  const tokens = encoding.encode(prompt);\n  return tokens;\n}\n\n/**\n * Detokenize a sequence of tokens back into text using the specified model.\n *\n * @param {ModelTypeName} model - The type of model to use for detokenization.\n * @param {number[]} tokens - The sequence of tokens to detokenize.\n * @returns {string} The detokenized text.\n */\nasync function detokenizeText(model: ModelTypeName, tokens: number[]) {\n  const modelName =\n    model === ModelType.TEXT_SMALL\n      ? (process.env.REDPILL_SMALL_MODEL ?? process.env.SMALL_MODEL ?? 'gpt-4o-mini')\n      : (process.env.REDPILL_LARGE_MODEL ?? process.env.LARGE_MODEL ?? 'gpt-4o');\n  const encoding = encodingForModel(modelName as TiktokenModel);\n  return encoding.decode(tokens);\n}\n\n/**\n * Defines the RedPill plugin with its name, description, and configuration options.\n * @type {Plugin}\n */\nexport const redpillPlugin: Plugin = {\n  name: 'redpill',\n  description: 'RedPill plugin',\n  config: {\n    REDPILL_API_KEY: process.env.REDPILL_API_KEY,\n    REDPILL_BASE_URL: process.env.REDPILL_BASE_URL,\n    REDPILL_SMALL_MODEL: process.env.REDPILL_SMALL_MODEL,\n    REDPILL_LARGE_MODEL: process.env.REDPILL_LARGE_MODEL,\n    SMALL_MODEL: process.env.SMALL_MODEL,\n    LARGE_MODEL: process.env.LARGE_MODEL,\n  },\n  async init(_, runtime) {\n    try {\n\n      // If API key is not set, we'll show a warning but continue\n      if (!process.env.REDPILL_API_KEY) {\n        logger.warn(\n          'REDPILL_API_KEY is not set in environment - RedPill functionality will be limited'\n        );\n        // Return early without throwing an error\n        return;\n      }\n\n      // Verify API key only if we have one\n      try {\n        const response = await fetch(`${getBaseURL(runtime)}/models`, {\n          headers: { Authorization: `Bearer ${runtime.getSetting('REDPILL_API_KEY')}` },\n        });\n\n        if (!response.ok) {\n          logger.warn(`RedPill API key validation failed: ${response.statusText}`);\n          logger.warn('RedPill functionality will be limited until a valid API key is provided');\n          // Continue execution instead of throwing\n        } else {\n          logger.success('RedPill API key validated successfully');\n        }\n      } catch (fetchError) {\n        logger.warn(`Error validating RedPill API key: ${fetchError}`);\n        logger.warn('RedPill functionality will be limited until a valid API key is provided');\n        // Continue execution instead of throwing\n      }\n    } catch (error) {\n      // Convert to warning instead of error\n      logger.warn(\n        `RedPill plugin configuration issue: ${error.errors\n          .map((e) => e.message)\n          .join(', ')} - You need to configure the REDPILL_API_KEY in your environment variables`\n      );\n    }\n  },\n  models: {\n    [ModelType.TEXT_EMBEDDING]: async (\n      _runtime,\n      params: TextEmbeddingParams | string | null\n    ): Promise<number[]> => {\n      // Handle null input (initialization case)\n      const model = 'text-embedding-3-small';\n      logger.log(`[Redpill] Using TEXT_EMBEDDING model: ${model}`);\n      if (params === null) {\n        logger.debug('Creating test embedding for initialization');\n        // Return a consistent vector for null input\n        const testVector = Array(1536).fill(0);\n        testVector[0] = 0.1; // Make it non-zero\n        return testVector;\n      }\n\n      // Get the text from whatever format was provided\n      let text: string;\n      if (typeof params === 'string') {\n        text = params; // Direct string input\n      } else if (typeof params === 'object' && params.text) {\n        text = params.text; // Object with text property\n      } else {\n        logger.warn('Invalid input format for embedding');\n        // Return a fallback for invalid input\n        const fallbackVector = Array(1536).fill(0);\n        fallbackVector[0] = 0.2; // Different value for tracking\n        return fallbackVector;\n      }\n\n      // Skip API call for empty text\n      if (!text.trim()) {\n        logger.warn('Empty text for embedding');\n        const emptyVector = Array(1536).fill(0);\n        emptyVector[0] = 0.3; // Different value for tracking\n        return emptyVector;\n      }\n\n      try {\n        const baseURL = getBaseURL(_runtime);\n\n        // Call the RedPill API\n        const response = await fetch(`${baseURL}/embeddings`, {\n          method: 'POST',\n          headers: {\n            Authorization: `Bearer ${process.env.REDPILL_API_KEY}`,\n            'Content-Type': 'application/json',\n          },\n          body: JSON.stringify({\n            model: 'text-embedding-3-small',\n            input: text,\n          }),\n        });\n\n        if (!response.ok) {\n          logger.error(`RedPill API error: ${response.status} - ${response.statusText}`);\n          const errorVector = Array(1536).fill(0);\n          errorVector[0] = 0.4; // Different value for tracking\n          return errorVector;\n        }\n\n        const data = (await response.json()) as {\n          data: [{ embedding: number[] }];\n        };\n\n        if (!data?.data?.[0]?.embedding) {\n          logger.error('API returned invalid structure');\n          const errorVector = Array(1536).fill(0);\n          errorVector[0] = 0.5; // Different value for tracking\n          return errorVector;\n        }\n\n        const embedding = data.data[0].embedding;\n        logger.log(`Got valid embedding with length ${embedding.length}`);\n        return embedding;\n      } catch (error) {\n        logger.error('Error generating embedding:', error);\n        const errorVector = Array(1536).fill(0);\n        errorVector[0] = 0.6; // Different value for tracking\n        return errorVector;\n      }\n    },\n    [ModelType.TEXT_TOKENIZER_ENCODE]: async (\n      _runtime,\n      { prompt, modelType = ModelType.TEXT_LARGE }: TokenizeTextParams\n    ) => {\n      const modelName =\n        modelType === ModelType.TEXT_SMALL\n          ? (process.env.REDPILL_SMALL_MODEL ?? process.env.SMALL_MODEL ?? 'gpt-4o-mini')\n          : (process.env.REDPILL_LARGE_MODEL ?? process.env.LARGE_MODEL ?? 'gpt-4o');\n      logger.log(`[Redpill] Using TEXT_TOKENIZER_ENCODE model: ${modelName}`);\n      return await tokenizeText(modelType ?? ModelType.TEXT_LARGE, prompt);\n    },\n    [ModelType.TEXT_TOKENIZER_DECODE]: async (\n      _runtime,\n      { tokens, modelType = ModelType.TEXT_LARGE }: DetokenizeTextParams\n    ) => {\n      const modelName =\n        modelType === ModelType.TEXT_SMALL\n          ? (process.env.REDPILL_SMALL_MODEL ?? process.env.SMALL_MODEL ?? 'gpt-4o-mini')\n          : (process.env.REDPILL_LARGE_MODEL ?? process.env.LARGE_MODEL ?? 'gpt-4o');\n      logger.log(`[Redpill] Using TEXT_TOKENIZER_DECODE model: ${modelName}`);\n      return await detokenizeText(modelType ?? ModelType.TEXT_LARGE, tokens);\n    },\n    [ModelType.TEXT_SMALL]: async (runtime, { prompt, stopSequences = [] }: GenerateTextParams) => {\n      const temperature = 0.7;\n      const frequency_penalty = 0.7;\n      const presence_penalty = 0.7;\n      const max_response_length = 8192;\n\n      const baseURL = getBaseURL(runtime);\n\n      const redpill = createOpenAI({\n        apiKey: runtime.getSetting('REDPILL_API_KEY'),\n        baseURL,\n      });\n\n      const model =\n        runtime.getSetting('REDPILL_SMALL_MODEL') ??\n        runtime.getSetting('SMALL_MODEL') ??\n        'gpt-4o-mini';\n\n      logger.log(`[Redpill] Using TEXT_SMALL model: ${model}`);\n      logger.log('generating text');\n      logger.log(prompt);\n\n      const { text: redpillResponse } = await generateText({\n        model: redpill.languageModel(model),\n        prompt: prompt,\n        system: runtime.character.system ?? undefined,\n        temperature: temperature,\n        maxTokens: max_response_length,\n        frequencyPenalty: frequency_penalty,\n        presencePenalty: presence_penalty,\n        stopSequences: stopSequences,\n      });\n\n      return redpillResponse;\n    },\n    [ModelType.TEXT_LARGE]: async (\n      runtime,\n      {\n        prompt,\n        stopSequences = [],\n        maxTokens = 8192,\n        temperature = 0.7,\n        frequencyPenalty = 0.7,\n        presencePenalty = 0.7,\n      }: GenerateTextParams\n    ) => {\n      const baseURL = getBaseURL(runtime);\n\n      const redpill = createOpenAI({\n        apiKey: runtime.getSetting('REDPILL_API_KEY'),\n        baseURL,\n      });\n\n      const model =\n        runtime.getSetting('REDPILL_LARGE_MODEL') ?? runtime.getSetting('LARGE_MODEL') ?? 'gpt-4o';\n\n      logger.log(`[Redpill] Using TEXT_LARGE model: ${model}`);\n      const { text: redpillResponse } = await generateText({\n        model: redpill.languageModel(model),\n        prompt: prompt,\n        system: runtime.character.system ?? undefined,\n        temperature: temperature,\n        maxTokens: maxTokens,\n        frequencyPenalty: frequencyPenalty,\n        presencePenalty: presencePenalty,\n        stopSequences: stopSequences,\n      });\n\n      return redpillResponse;\n    },\n    [ModelType.IMAGE_DESCRIPTION]: async (runtime, params: ImageDescriptionParams | string) => {\n      // Handle string case (direct URL)\n      let imageUrl: string;\n      let prompt: string | undefined;\n\n      if (typeof params === 'string') {\n        imageUrl = params;\n        prompt = undefined;\n      } else {\n        // Object parameter case\n        imageUrl = params.imageUrl;\n        prompt = params.prompt;\n      }\n\n      const model = 'gpt-4-vision-preview';\n      logger.log(`[Redpill] Using IMAGE_DESCRIPTION model: ${model}`);\n      try {\n        const baseURL = getBaseURL(runtime);\n        const apiKey = process.env.REDPILL_API_KEY;\n\n        if (!apiKey) {\n          logger.error('RedPill API key not set');\n          return {\n            title: 'Failed to analyze image',\n            description: 'API key not configured',\n          };\n        }\n\n        // Call the GPT-4 Vision API\n        const response = await fetch(`${baseURL}/chat/completions`, {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n            Authorization: `Bearer ${apiKey}`,\n          },\n          body: JSON.stringify({\n            model: 'gpt-4-vision-preview',\n            messages: [\n              {\n                role: 'user',\n                content: [\n                  {\n                    type: 'text',\n                    text:\n                      prompt ||\n                      'Please analyze this image and provide a title and detailed description.',\n                  },\n                  {\n                    type: 'image_url',\n                    image_url: { url: imageUrl },\n                  },\n                ],\n              },\n            ],\n            max_tokens: 300,\n          }),\n        });\n\n        if (!response.ok) {\n          throw new Error(`RedPill API error: ${response.status}`);\n        }\n\n        const result: any = await response.json();\n        const content = result.choices?.[0]?.message?.content;\n\n        if (!content) {\n          return {\n            title: 'Failed to analyze image',\n            description: 'No response from API',\n          };\n        }\n\n        // Extract title and description\n        const titleMatch = content.match(/title[:\\s]+(.+?)(?:\\n|$)/i);\n        const title = titleMatch?.[1] || 'Image Analysis';\n\n        // Rest of content is the description\n        const description = content.replace(/title[:\\s]+(.+?)(?:\\n|$)/i, '').trim();\n\n        return { title, description };\n      } catch (error) {\n        logger.error('Error analyzing image:', error);\n        return {\n          title: 'Failed to analyze image',\n          description: `Error: ${error instanceof Error ? error.message : String(error)}`,\n        };\n      }\n    },\n    [ModelType.OBJECT_SMALL]: async (runtime, params: ObjectGenerationParams) => {\n      const baseURL = getBaseURL(runtime);\n      const redpill = createOpenAI({\n        apiKey: runtime.getSetting('REDPILL_API_KEY'),\n        baseURL,\n      });\n      const model =\n        runtime.getSetting('REDPILL_SMALL_MODEL') ??\n        runtime.getSetting('SMALL_MODEL') ??\n        'gpt-4o-mini';\n\n      logger.log(`[Redpill] Using OBJECT_SMALL model: ${model}`);\n      try {\n        if (params.schema) {\n          // Skip zod validation and just use the generateObject without schema\n          logger.info('Using OBJECT_SMALL without schema validation');\n          const { object } = await generateObject({\n            model: redpill.languageModel(model),\n            output: 'no-schema',\n            prompt: params.prompt,\n            temperature: params.temperature,\n          });\n          return object;\n        }\n\n        const { object } = await generateObject({\n          model: redpill.languageModel(model),\n          output: 'no-schema',\n          prompt: params.prompt,\n          temperature: params.temperature,\n        });\n        return object;\n      } catch (error) {\n        logger.error('Error generating object:', error);\n        throw error;\n      }\n    },\n    [ModelType.OBJECT_LARGE]: async (runtime, params: ObjectGenerationParams) => {\n      const baseURL = getBaseURL(runtime);\n      const redpill = createOpenAI({\n        apiKey: runtime.getSetting('REDPILL_API_KEY'),\n        baseURL,\n      });\n      const model =\n        runtime.getSetting('REDPILL_LARGE_MODEL') ?? runtime.getSetting('LARGE_MODEL') ?? 'gpt-4o';\n\n      logger.log(`[Redpill] Using OBJECT_LARGE model: ${model}`);\n      try {\n        if (params.schema) {\n          // Skip zod validation and just use the generateObject without schema\n          logger.info('Using OBJECT_LARGE without schema validation');\n          const { object } = await generateObject({\n            model: redpill.languageModel(model),\n            output: 'no-schema',\n            prompt: params.prompt,\n            temperature: params.temperature,\n          });\n          return object;\n        }\n\n        const { object } = await generateObject({\n          model: redpill.languageModel(model),\n          output: 'no-schema',\n          prompt: params.prompt,\n          temperature: params.temperature,\n        });\n        return object;\n      } catch (error) {\n        logger.error('Error generating object:', error);\n        throw error;\n      }\n    },\n  },\n  tests: [\n    {\n      name: 'redpill_plugin_tests',\n      tests: [\n        {\n          name: 'redpill_test_url_and_api_key_validation',\n          fn: async (runtime) => {\n            const baseURL = getBaseURL(runtime);\n            const response = await fetch(`${baseURL}/models`, {\n              headers: {\n                Authorization: `Bearer ${runtime.getSetting('REDPILL_API_KEY')}`,\n              },\n            });\n            const data = await response.json();\n            logger.log('Models Available:', (data as any)?.data.length);\n            if (!response.ok) {\n              throw new Error(`Failed to validate RedPill API key: ${response.statusText}`);\n            }\n          },\n        },\n        {\n          name: 'redpill_test_text_embedding',\n          fn: async (runtime) => {\n            try {\n              const embedding = await runtime.useModel(ModelType.TEXT_EMBEDDING, {\n                text: 'Hello, world!',\n              });\n              logger.log('embedding', embedding);\n            } catch (error) {\n              logger.error('Error in test_text_embedding:', error);\n              throw error;\n            }\n          },\n        },\n        {\n          name: 'redpill_test_text_large',\n          fn: async (runtime) => {\n            try {\n              const text = await runtime.useModel(ModelType.TEXT_LARGE, {\n                prompt: 'What is the nature of reality in 10 words?',\n              });\n              if (text.length === 0) {\n                throw new Error('Failed to generate text');\n              }\n              logger.log('generated with test_text_large:', text);\n            } catch (error) {\n              logger.error('Error in test_text_large:', error);\n              throw error;\n            }\n          },\n        },\n        {\n          name: 'redpill_test_text_small',\n          fn: async (runtime) => {\n            try {\n              const text = await runtime.useModel(ModelType.TEXT_SMALL, {\n                prompt: 'What is the nature of reality in 10 words?',\n              });\n              if (text.length === 0) {\n                throw new Error('Failed to generate text');\n              }\n              logger.log('generated with test_text_small:', text);\n            } catch (error) {\n              logger.error('Error in test_text_small:', error);\n              throw error;\n            }\n          },\n        },\n        {\n          name: 'image-description',\n          fn: async (runtime) => {\n            try {\n              logger.log('redpill_test_image_description');\n              try {\n                const result = await runtime.useModel(\n                  ModelType.IMAGE_DESCRIPTION,\n                  'https://upload.wikimedia.org/wikipedia/commons/thumb/1/1c/Vitalik_Buterin_TechCrunch_London_2015_%28cropped%29.jpg/537px-Vitalik_Buterin_TechCrunch_London_2015_%28cropped%29.jpg'\n                );\n\n                // Check if result has the expected structure\n                if (\n                  result &&\n                  typeof result === 'object' &&\n                  'title' in result &&\n                  'description' in result\n                ) {\n                  logger.log('Image description:', result);\n                } else {\n                  logger.error('Invalid image description result format:', result);\n                }\n              } catch (e) {\n                logger.error('Error in image description test:', e);\n              }\n            } catch (e) {\n              logger.error('Error in redpill_test_image_description:', e);\n            }\n          },\n        },\n        {\n          name: 'redpill_test_text_tokenizer_encode',\n          fn: async (runtime) => {\n            const prompt = 'Hello tokenizer encode!';\n            const tokens = await runtime.useModel(ModelType.TEXT_TOKENIZER_ENCODE, { prompt });\n            if (!Array.isArray(tokens) || tokens.length === 0) {\n              throw new Error('Failed to tokenize text: expected non-empty array of tokens');\n            }\n            logger.log('Tokenized output:', tokens);\n          },\n        },\n        {\n          name: 'redpill_test_text_tokenizer_decode',\n          fn: async (runtime) => {\n            const prompt = 'Hello tokenizer decode!';\n            // Encode the string into tokens first\n            const tokens = await runtime.useModel(ModelType.TEXT_TOKENIZER_ENCODE, { prompt });\n            // Now decode tokens back into text\n            const decodedText = await runtime.useModel(ModelType.TEXT_TOKENIZER_DECODE, { tokens });\n            if (decodedText !== prompt) {\n              throw new Error(\n                `Decoded text does not match original. Expected \"${prompt}\", got \"${decodedText}\"`\n              );\n            }\n            logger.log('Decoded text:', decodedText);\n          },\n        },\n      ],\n    },\n  ],\n};\nexport default redpillPlugin;\n"],"mappings":"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","names":["object"]}