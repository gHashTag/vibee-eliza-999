# üìä –û—Ç—á–µ—Ç –æ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ OpenTofu –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

**–î–∞—Ç–∞:** $(date)  
**–ü—Ä–æ–µ–∫—Ç:** VIBEE Agent  
**–û–∫—Ä—É–∂–µ–Ω–∏–µ:** Stage

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ü—Ä–æ–≤–µ—Ä–∫–∏

### 1. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –§–∞–π–ª–æ–≤ ‚úÖ

–í—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ñ–∞–π–ª—ã –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç:
- ‚úÖ `main.tf` - –≥–ª–∞–≤–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- ‚úÖ `variables.tf` - –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
- ‚úÖ `terraform.tfvars.example` - –ø—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- ‚úÖ `modules/vibee-agent/main.tf` - –º–æ–¥—É–ª—å –¥–µ–ø–ª–æ—è
- ‚úÖ `modules/vibee-agent/variables.tf` - –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –º–æ–¥—É–ª—è
- ‚úÖ `modules/vibee-agent/outputs.tf` - –≤—ã–≤–æ–¥—ã –º–æ–¥—É–ª—è

### 2. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ ‚úÖ

–í—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è:
- ‚úÖ `server_ip` - IP —Å–µ—Ä–≤–µ—Ä–∞
- ‚úÖ `environment` - –æ–∫—Ä—É–∂–µ–Ω–∏–µ (stage/production)
- ‚úÖ `infisical_client_id` - Infisical Client ID
- ‚úÖ `infisical_client_secret` - Infisical Client Secret
- ‚úÖ `infisical_project_id` - Infisical Project ID
- ‚úÖ `infisical_environment` - Infisical Environment
- ‚úÖ `postgres_url` - PostgreSQL URL (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### 3. –ü—É—Ç–∏ –∏ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ ‚úÖ

- ‚úÖ Dockerfile –¥–æ—Å—Ç—É–ø–µ–Ω –∏–∑ –º–æ–¥—É–ª—è (`../../../Dockerfile`)
- ‚úÖ package.json –¥–æ—Å—Ç—É–ø–µ–Ω –∏–∑ –º–æ–¥—É–ª—è
- ‚úÖ src/ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ –∏–∑ –º–æ–¥—É–ª—è
- ‚úÖ –í—Å–µ –ø—É—Ç–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã –¥–ª—è —Å–±–æ—Ä–∫–∏ Docker –æ–±—Ä–∞–∑–∞

### 4. Dockerfile –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å ‚úÖ

- ‚úÖ –ü–æ—Ä—Ç 3000 —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è
- ‚úÖ curl —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω (–¥–ª—è health checks)
- ‚úÖ –ö–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞: `elizaos start`
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç node:23.3.0-slim
- ‚úÖ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç bun –¥–ª—è —Å–±–æ—Ä–∫–∏

### 5. –†–µ—Å—É—Ä—Å—ã –∏ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ ‚úÖ

**Docker Network:**
- ‚úÖ –°–æ–∑–¥–∞–µ—Ç—Å—è —Å–µ—Ç—å `vibee-network`
- ‚úÖ Subnet: 172.20.0.0/16

**PostgreSQL:**
- ‚úÖ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä: `vibee-postgres-stage`
- ‚úÖ –û–±—Ä–∞–∑: `ankane/pgvector:latest`
- ‚úÖ –ü–æ—Ä—Ç: 5432 (—Ç–æ–ª—å–∫–æ localhost)
- ‚úÖ Volume: `vibee-postgres-data-stage`
- ‚úÖ Health check –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- ‚úÖ IP: 172.20.0.10

**VIBEE Agent:**
- ‚úÖ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä: `vibee-agent-stage`
- ‚úÖ –û–±—Ä–∞–∑: `vibee/agent:stage-latest` (—Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
- ‚úÖ –ü–æ—Ä—Ç: 3000 (–≤–Ω–µ—à–Ω–∏–π –¥–æ—Å—Ç—É–ø)
- ‚úÖ IP: 172.20.0.20
- ‚úÖ Health check –Ω–∞—Å—Ç—Ä–æ–µ–Ω (curl)
- ‚úÖ –ó–∞–≤–∏—Å–∏—Ç –æ—Ç PostgreSQL –∏ —Å–±–æ—Ä–∫–∏ –æ–±—Ä–∞–∑–∞
- ‚úÖ –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã

### 6. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –û–∫—Ä—É–∂–µ–Ω–∏—è ‚úÖ

VIBEE Agent –ø–æ–ª—É—á–∞–µ—Ç:
- ‚úÖ `NODE_ENV=stage`
- ‚úÖ `INFISICAL_CLIENT_ID`
- ‚úÖ `INFISICAL_CLIENT_SECRET`
- ‚úÖ `INFISICAL_PROJECT_ID`
- ‚úÖ `INFISICAL_ENVIRONMENT=stage`
- ‚úÖ `POSTGRES_URL` (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –∏–ª–∏ –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π)
- ‚úÖ `SERVER_PORT=3000`
- ‚úÖ `ELIZA_UI_ENABLE=true`
- ‚úÖ `LOG_LEVEL=info`

### 7. Health Checks ‚úÖ

**PostgreSQL:**
- ‚úÖ –ö–æ–º–∞–Ω–¥–∞: `pg_isready -U postgres -d eliza`
- ‚úÖ –ò–Ω—Ç–µ—Ä–≤–∞–ª: 10s
- ‚úÖ –¢–∞–π–º–∞—É—Ç: 5s
- ‚úÖ Retries: 5
- ‚úÖ Start period: 30s

**VIBEE Agent:**
- ‚úÖ –ö–æ–º–∞–Ω–¥–∞: `curl -f http://localhost:3000/health`
- ‚úÖ –ò–Ω—Ç–µ—Ä–≤–∞–ª: 30s
- ‚úÖ –¢–∞–π–º–∞—É—Ç: 10s
- ‚úÖ Retries: 3
- ‚úÖ Start period: 90s (–≤—Ä–µ–º—è –Ω–∞ –∑–∞–≥—Ä—É–∑–∫—É —Å–µ–∫—Ä–µ—Ç–æ–≤ –∏–∑ Infisical)

### 8. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å ‚úÖ

- ‚úÖ PostgreSQL –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –Ω–∞ localhost (127.0.0.1)
- ‚úÖ VIBEE Agent –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ 0.0.0.0:3000 (–≤–Ω–µ—à–Ω–∏–π –¥–æ—Å—Ç—É–ø)
- ‚úÖ –°–µ–∫—Ä–µ—Ç—ã —á–µ—Ä–µ–∑ Infisical Cloud (–Ω–µ –≤ –∫–æ–¥–µ)
- ‚úÖ terraform.tfvars –≤ .gitignore

## ‚ö†Ô∏è –ó–∞–º–µ—á–∞–Ω–∏—è

1. **OpenTofu –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ª–æ–∫–∞–ª—å–Ω–æ** - –≤–∞–ª–∏–¥–∞—Ü–∏—è —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
2. **–ü—É—Ç–∏ –≤ –º–æ–¥—É–ª–µ** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã —Å `../../` –Ω–∞ `../../../` –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–æ—Ä–Ω—é –ø—Ä–æ–µ–∫—Ç–∞
3. **Health check** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç curl, –∫–æ—Ç–æ—Ä—ã–π —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ Dockerfile

## üöÄ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –î–µ–ø–ª–æ—é

### ‚úÖ –ì–æ—Ç–æ–≤–æ:
- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤
- –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏ –∏—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
- –ü—É—Ç–∏ –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- Dockerfile —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤
- Health checks
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### üìã –ü–µ—Ä–µ–¥ –î–µ–ø–ª–æ–µ–º:

1. **–°–æ–∑–¥–∞—Ç—å terraform.tfvars:**
   ```bash
   cd opentofu
   cp terraform.tfvars.example terraform.tfvars
   # –ó–∞–ø–æ–ª–Ω–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ .env.dev
   ```

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:**
   ```bash
   # –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
   cd /home/aiagent/vibee-agent/opentofu
   tofu init
   tofu validate
   tofu plan
   ```

3. **–î–µ–ø–ª–æ–π:**
   ```bash
   tofu apply -auto-approve
   ```

## üìù –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:** –ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏:
   ```bash
   docker logs vibee-agent-stage -f
   docker logs vibee-postgres-stage -f
   ```

2. **Health Check:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å:
   ```bash
   curl http://188.137.250.63:3000/health
   ```

3. **Backup:** –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ backup PostgreSQL volume

4. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–æ–¥–∞ –ø–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑:
   ```bash
   cd /home/aiagent/vibee-agent
   docker build -t vibee/agent:stage-latest -f Dockerfile .
   docker restart vibee-agent-stage
   ```

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ì–û–¢–û–í–û –ö –î–ï–ü–õ–û–Æ**

–í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–π–¥–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≥–æ—Ç–æ–≤–∞ –¥–ª—è –¥–µ–ø–ª–æ—è –≤ Stage –æ–∫—Ä—É–∂–µ–Ω–∏–µ.

