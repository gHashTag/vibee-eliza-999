{
  "version": 3,
  "sources": ["../src/actions/generateImage.ts", "../src/utils/functional/result.ts", "../src/types/schemas.ts", "../src/services/provider-registry.ts", "../src/db/client.ts", "../src/db/schema.ts", "../src/db/schema.sqlite.ts", "../src/services/modelLoader.ts", "../src/services/generateNeuroPhotoHybrid.ts", "../src/utils/getTelegramId.ts", "../src/actions/faceTrainAction.ts", "../src/actions/photoUploadAction.ts", "../src/services/falTrainingService.ts", "../src/actions/listModelsAction.ts", "../src/utils/userHelpers.ts", "../src/actions/deleteModelAction.ts", "../src/actions/setActiveModelAction.ts", "../src/providers/neuroPhotoProvider.ts", "../src/services/replicateService.ts", "../src/services/falService.ts", "../src/config/image-models.config.ts", "../src/providers/replicateProvider.ts", "../src/providers/falProvider.ts", "../src/services/providers.ts", "../src/index.ts"],
  "sourcesContent": [
    "import {\n  Action,\n  IAgentRuntime,\n  Memory,\n  State,\n  HandlerCallback,\n  ActionExample,\n  logger,\n} from \"@elizaos/core\";\nimport {\n  TaskEither,\n  tryCatchAsync,\n  taskRight,\n  runTaskEither,\n  Either,\n} from \"../utils/functional/result\";\nimport { pipe, chain, map } from \"../utils/functional/composition\";\nimport { GenerateImageInputSchema } from \"../types/schemas\";\nimport { generateNeuroPhotoHybrid } from \"../services/generateNeuroPhotoHybrid\";\nimport { getUserModelsTask, UserModelDB } from \"../services/modelLoader\";\nimport { getTelegramId } from \"../utils/getTelegramId\";\n\nconst COST_STARS = 7.5;\n\n// Helper to validate input using Zod\nconst validateInput = (input: unknown): TaskEither<Error, any> => {\n    return tryCatchAsync(\n        async () => GenerateImageInputSchema.parseAsync(input),\n        (error) => error instanceof Error ? error : new Error(String(error))\n    );\n};\n\nexport const generateImageAction: Action = {\n  name: \"GENERATE_NEUROPHOTO\",\n  similes: [\n    \"MAKE_IMAGE\",\n    \"CREATE_PHOTO\",\n    \"NEUROPHOTO\",\n    \"GENERATE_IMAGE\",\n    \"AI_IMAGE\",\n    \"DRAW_IMAGE\",\n  ],\n  description: `–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç AI-–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å –ø–æ–º–æ—â—å—é Flux/SDXL –º–æ–¥–µ–ª–µ–π.\n–ò—Å–ø–æ–ª—å–∑—É–π –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:\n- –ü—Ä–æ—Å–∏—Ç –Ω–∞—Ä–∏—Å–æ–≤–∞—Ç—å/—Å–æ–∑–¥–∞—Ç—å/—Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ\n- –•–æ—á–µ—Ç —É–≤–∏–¥–µ—Ç—å –∫–∞–∫ —á—Ç–æ-—Ç–æ –≤—ã–≥–ª—è–¥–∏—Ç\n- –°–ø—Ä–∞—à–∏–≤–∞–µ—Ç \"–ø–æ–∫–∞–∂–∏...\", \"—Å–¥–µ–ª–∞–π —Ñ–æ—Ç–æ...\", \"–Ω–∞—Ä–∏—Å—É–π...\"\n- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–æ–º–∞–Ω–¥—É /neurophoto\n–ù–µ —Ç—Ä–µ–±—É–µ—Ç —Å—Ç—Ä–æ–≥–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞ –∫–æ–º–∞–Ω–¥—ã - –ø–æ–Ω–∏–º–∞–µ—Ç –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —è–∑—ã–∫.`,\n\n  validate: async (\n    _runtime: IAgentRuntime,\n    message: Memory\n  ): Promise<boolean> => {\n    const text = message.content?.text?.toLowerCase();\n\n    if (!text) return false;\n\n    const commands = [\"/neurophoto\", \"–Ω–µ–π—Ä–æ—Ñ–æ—Ç–æ\", \"neurophoto\"];\n    if (commands.some((cmd) => text.includes(cmd))) {\n      return true;\n    }\n\n    const intents = [\n      \"–Ω–∞—Ä–∏—Å—É–π\",\n      \"—Å–æ–∑–¥–∞–π –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ\",\n      \"—Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π\",\n      \"—Å–¥–µ–ª–∞–π –∫–∞—Ä—Ç–∏–Ω–∫\",\n      \"—Ö–æ—á—É —Ñ–æ—Ç–æ\",\n      \"–ø–æ–∫–∞–∂–∏ –∫–∞–∫ –≤—ã–≥–ª—è–¥–∏—Ç\",\n      \"—Å–¥–µ–ª–∞–π —Ñ–æ—Ç–æ\",\n      \"generate image\",\n      \"create image\",\n      \"draw\",\n      \"make a picture\",\n      \"show me how\",\n      \"can you draw\",\n      \"make an image\",\n    ];\n\n    return intents.some((intent) => text.includes(intent));\n  },\n\n  handler: async (\n    runtime: IAgentRuntime,\n    message: Memory,\n    _state: State | undefined,\n    _options: any,\n    callback?: HandlerCallback\n  ) => {\n    console.log(\"üî•üî•üî• generateImageAction HANDLER CALLED! üî•üî•üî•\");\n    console.log(\"Message:\", JSON.stringify(message, null, 2));\n    try {\n      const text = message.content?.text || \"\";\n      let userId = message.userId; // ElizaOS userId (UUID)\n\n      // FIX: –ï—Å–ª–∏ userId –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç, –ø—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å –∏–∑ metadata\n      if (!userId && message.metadata?.raw?.senderId) {\n        userId = message.metadata.raw.senderId;\n      }\n\n      if (!userId) {\n        await callback?.({\n          text: \"‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.\",\n        });\n        return {\n            success: false,\n            error: new Error(\"User ID not found\"),\n        };\n      }\n\n      logger.info({ userId, text }, \"Processing image generation request\");\n\n      const prompt = extractPrompt(text);\n\n      if (!prompt || prompt.length < 3) {\n        await callback?.({\n          text: `‚ùå –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–ø–∏—à–∏—Ç–µ –∫–∞–∫–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—ã —Ö–æ—Ç–∏—Ç–µ —Å–æ–∑–¥–∞—Ç—å.\n\n**–ü—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏—Ç–µ —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–æ–∑–¥–∞—Ç—å:**\n\n**–ü—Ä–∏–º–µ—Ä—ã**:\n‚Ä¢ \"–Ω–∞—Ä–∏—Å—É–π –∫—Ä–∞—Å–∏–≤—ã–π –∑–∞–∫–∞—Ç –Ω–∞–¥ –æ–∫–µ–∞–Ω–æ–º\"\n‚Ä¢ \"—Å–æ–∑–¥–∞–π —Ñ—É—Ç—É—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∏–π –≥–æ—Ä–æ–¥ —Å –ª–µ—Ç–∞—é—â–∏–º–∏ –º–∞—à–∏–Ω–∞–º–∏\"\n‚Ä¢ \"—Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π –ø–æ—Ä—Ç—Ä–µ—Ç –∫–æ—Ç–∞ –≤ –∫–æ—Å–º–∏—á–µ—Å–∫–æ–º —à–ª–µ–º–µ\"\n‚Ä¢ \"–Ω–∞—Ä–∏—Å—É–π —Å—É–ø–µ—Ä–º–µ–Ω–∞\"\n\n**–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –æ–ø–∏—Å–∞–Ω–∏—è: 3 —Å–∏–º–≤–æ–ª–∞.**`,\n        });\n        return {\n            success: false,\n            error: new Error(\"Prompt too short\"),\n        };\n      }\n\n      // CRITICAL: –ü–æ–ª—É—á–∞–µ–º –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n      // –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∫–∞–∫ —Ä–µ–∞–ª—å–Ω—ã–µ Telegram ID, —Ç–∞–∫ –∏ UUID –¥–ª—è –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞\n      const telegramId = getTelegramId(message);\n\n      // –î–ª—è –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º UUID (entity_id) –Ω–∞–ø—Ä—è–º—É—é –¥–ª—è –ø–æ–∏—Å–∫–∞ –º–æ–¥–µ–ª–µ–π\n      // userId - —ç—Ç–æ UUID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ ElizaOS (aa7cf0e2-f10f-49dd-9ec2-0ea7befc8bcf)\n      const userIdentifier = userId || (telegramId ? String(telegramId) : null);\n\n      if (!userIdentifier) {\n        await callback?.({\n          text: \"‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.\",\n        });\n        return {\n          success: false,\n          error: new Error(\"User ID not found\"),\n        };\n      }\n\n      logger.info({ userId, telegramId, userIdentifier }, \"Using user ID for model lookup\");\n\n      // –ü–µ—Ä–µ–¥–∞—ë–º UUID –Ω–∞–ø—Ä—è–º—É—é - modelLoader —É–º–µ–µ—Ç –∏—Å–∫–∞—Ç—å –ø–æ entity_id\n      const modelsTask = getUserModelsTask(userIdentifier, 'neuro_face_bot');\n      const modelsResult = await modelsTask();\n\n      if (modelsResult.isLeft() || modelsResult.value.length === 0) {\n        await callback?.({\n          text: `‚ùå **–°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ—é –º–æ–¥–µ–ª—å!**\n\n–ß—Ç–æ–±—ã —è –º–æ–≥ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å –≤–∞—à–∏–º –ª–∏—Ü–æ–º, –Ω—É–∂–Ω–æ:\n\n1Ô∏è‚É£ –ó–∞–≥—Ä—É–∑–∏—Ç–µ 10-25 —Å–≤–æ–∏—Ö —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π (–≤ —Ö–æ—Ä–æ—à–µ–º –∫–∞—á–µ—Å—Ç–≤–µ)\n2Ô∏è‚É£ –°–∫–∞–∂–∏—Ç–µ \"–æ–±—É—á–∏—Ç—å –º–æ–¥–µ–ª—å\" –∏ —É–∫–∞–∂–∏—Ç–µ –∏–º—è –º–æ–¥–µ–ª–∏\n3Ô∏è‚É£ –ü–æ–¥–æ–∂–¥–∏—Ç–µ 10-15 –º–∏–Ω—É—Ç –ø–æ–∫–∞ –º–æ–¥–µ–ª—å –æ–±—É—á–∏—Ç—Å—è\n\n**–ö–∞–∫ –Ω–∞—á–∞—Ç—å:**\n–ü—Ä–æ—Å—Ç–æ —Å–∫–∞–∂–∏—Ç–µ \"–æ–±—É—á–∏—Ç—å –º–æ–¥–µ–ª—å –º–æ–µ_–∏–º—è\" –∏ –ø—Ä–∏–ª–æ–∂–∏—Ç–µ —Ñ–æ—Ç–æ.\n\n–¢–æ–≥–¥–∞ —è —Å–º–æ–≥—É —Å–æ–∑–¥–∞–≤–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å –≤–∞–º–∏! üé®`,\n        });\n        return {\n          success: false,\n          error: new Error(\"No trained models found\"),\n        };\n      }\n\n      const userModel = modelsResult.value[0]; // –ë–µ—Ä–µ–º –ø–µ—Ä–≤—É—é –∞–∫—Ç–∏–≤–Ω—É—é –º–æ–¥–µ–ª—å\n      logger.info({ userId, modelName: userModel.model_name }, \"Using user's trained model\");\n\n      await callback?.({\n        text: `üé® –ì–µ–Ω–µ—Ä–∏—Ä—É—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å –≤–∞—à–µ–π –º–æ–¥–µ–ª—å—é **${userModel.model_name}**...\n‚è± –≠—Ç–æ –∑–∞–π–º—ë—Ç 10-30 —Å–µ–∫—É–Ω–¥...`,\n      });\n\n      // Prepare generation parameters\n      let fullPrompt = prompt;\n      if (userModel.trigger_word) {\n        fullPrompt = `${userModel.trigger_word}, ${fullPrompt}`;\n      }\n\n      logger.info({\n        prompt: fullPrompt,\n        modelUrl: userModel.model_url,\n        triggerWord: userModel.trigger_word\n      }, \"Generating with user's LoRA\");\n\n      // Generate Image directly (simplified approach)\n      try {\n        const generationResult = await generateNeuroPhotoHybrid(\n            fullPrompt,\n            userModel.model_url,\n            1,\n            userId,\n            { gender: userModel.gender },\n            \"web-chat\"\n        );\n\n        if (!generationResult.success) {\n            throw new Error(generationResult.error || \"Generation failed\");\n        }\n\n        const resultText = `‚ú® **–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–æ!**\n\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\nüìù **–ü—Ä–æ–º–ø—Ç**\n${fullPrompt}\n\nüé® **–î–µ—Ç–∞–ª–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏**\n‚îú ü§ñ –ú–æ–¥–µ–ª—å: **${userModel.model_name}** (–≤–∞—à–∞ LoRA)\n‚îú üéØ Trigger: **${userModel.trigger_word}**\n‚îú ‚è± –í—Ä–µ–º—è: **${Math.round(generationResult.metadata.generationTime / 1000)}—Å**\n‚îî üí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å: **${COST_STARS}‚≠ê**\n\n_–°–æ–∑–¥–∞–Ω–æ —Å –≤–∞—à–µ–π –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–π –º–æ–¥–µ–ª—å—é ‚Ä¢ @999-agents_`;\n\n        if (callback) {\n            await callback({\n                text: resultText,\n                attachments: generationResult.imageUrls.map((url: string, index: number) => ({\n                    id: `neurophoto-${Date.now()}-${index}`,\n                    url,\n                    type: \"image\",\n                    title: fullPrompt,\n                    description: `Generated by ${userModel.model_name}`,\n                })),\n            });\n        }\n\n        return {\n            success: true,\n            text: \"–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ\",\n            data: generationResult,\n        };\n      } catch (error) {\n        logger.error({ error }, \"Generation failed\");\n        throw error;\n      }\n\n    } catch (error) {\n      logger.error({ error }, \"Unexpected error in generateImageAction\");\n      await callback?.({\n        text: \"‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –Ω–µ–ø—Ä–µ–¥–≤–∏–¥–µ–Ω–Ω–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.\",\n      });\n      return {\n        success: false,\n        error: error instanceof Error ? error : new Error(String(error)),\n      };\n    }\n  },\n\n  examples: [\n    [\n      {\n        user: \"{{user1}}\",\n        content: { text: \"/neurophoto –∫—Ä–∞—Å–∏–≤—ã–π –∑–∞–∫–∞—Ç –Ω–∞–¥ –æ–∫–µ–∞–Ω–æ–º\" },\n      },\n      {\n        user: \"{{agentName}}\",\n        content: {\n          text: \"‚úÖ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ!\",\n          action: \"GENERATE_NEUROPHOTO\",\n        },\n      },\n    ],\n    [\n      {\n        user: \"{{user1}}\",\n        content: { text: \"–Ω–∞—Ä–∏—Å—É–π —Ñ—É—Ç—É—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∏–π –≥–æ—Ä–æ–¥\" },\n      },\n      {\n        user: \"{{agentName}}\",\n        content: {\n          text: \"üé® –ì–µ–Ω–µ—Ä–∏—Ä—É—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ...\",\n          action: \"GENERATE_NEUROPHOTO\",\n        },\n      },\n    ],\n  ] as ActionExample[][],\n};\n\nfunction extractPrompt(text: string): string {\n  // Try to extract prompt by removing command words\n  const cleaned = text\n    .replace(/\\/neurophoto/gi, \"\")\n    .replace(/\\/generate/gi, \"\")\n    .replace(/–Ω–µ–π—Ä–æ—Ñ–æ—Ç–æ/gi, \"\")\n    .replace(/—Å–æ–∑–¥–∞–π –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ/gi, \"\")\n    .replace(/—Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π –∫–∞—Ä—Ç–∏–Ω–∫—É/gi, \"\")\n    .replace(/–Ω–∞—Ä–∏—Å—É–π/gi, \"\")\n    .replace(/generate image/gi, \"\")\n    .replace(/create image/gi, \"\")\n    .replace(/draw/gi, \"\")\n    .trim();\n\n  // If cleaned text is too short, use original text (for natural language)\n  // This handles cases like \"–Ω–∞—Ä–∏—Å—É–π —Å—É–ø–µ—Ä–º–µ–Ω–∞\" -> we want \"—Å—É–ø–µ—Ä–º–µ–Ω–∞\"\n  if (cleaned.length < 3 && text.length > cleaned.length) {\n    // Extract words after common command words\n    const words = text.split(/\\s+/);\n    const commandWords = ['–Ω–∞—Ä–∏—Å—É–π', '—Å–æ–∑–¥–∞–π', '—Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π', 'draw', 'generate'];\n\n    for (let i = 0; i < words.length; i++) {\n      const word = words[i].toLowerCase().replace(/[^\\w]/g, '');\n      if (commandWords.includes(word) && i + 1 < words.length) {\n        return words.slice(i + 1).join(' ').trim();\n      }\n    }\n\n    // If no command words found, return original text\n    return text;\n  }\n\n  return cleaned;\n}\n",
    "/**\n * Result and TaskEither monad implementations\n */\n\nexport type Either<L, R> = Left<L> | Right<R>;\n\nexport class Left<L> {\n  readonly _tag = 'Left';\n  constructor(readonly value: L) {}\n  \n  isLeft(): this is Left<L> { return true; }\n  isRight(): this is Right<never> { return false; }\n  \n  map<U>(_f: (r: never) => U): Either<L, U> { return this as any; }\n  chain<U>(_f: (r: never) => Either<L, U>): Either<L, U> { return this as any; }\n  match<U>(onLeft: (l: L) => U, _onRight: (r: never) => U): U { return onLeft(this.value); }\n}\n\nexport class Right<R> {\n  readonly _tag = 'Right';\n  constructor(readonly value: R) {}\n  \n  isLeft(): this is Left<never> { return false; }\n  isRight(): this is Right<R> { return true; }\n  \n  map<U>(f: (r: R) => U): Either<never, U> { return new Right(f(this.value)); }\n  chain<L, U>(f: (r: R) => Either<L, U>): Either<L, U> { return f(this.value); }\n  match<U>(_onLeft: (l: never) => U, onRight: (r: R) => U): U { return onRight(this.value); }\n}\n\nexport const left = <L>(l: L): Either<L, never> => new Left(l);\nexport const right = <R>(r: R): Either<never, R> => new Right(r);\n\nexport type TaskEither<L, R> = () => Promise<Either<L, R>>;\n\nexport const taskRight = <R>(v: R): TaskEither<never, R> => async () => right(v);\nexport const taskLeft = <L>(v: L): TaskEither<L, never> => async () => left(v);\n\nexport const tryCatchAsync = <L, R>(\n  f: () => Promise<R>,\n  onRejected: (reason: unknown) => L\n): TaskEither<L, R> => async () => {\n  try {\n    const v = await f();\n    return right(v);\n  } catch (e) {\n    return left(onRejected(e));\n  }\n};\n\nexport const runTaskEither = async <L, R>(te: TaskEither<L, R>): Promise<Either<L, R>> => {\n  return te();\n};\n\n// Combinators for TaskEither\n\nexport const map = <L, R, U>(f: (r: R) => U) => (te: TaskEither<L, R>): TaskEither<L, U> => async () => {\n  const e = await te();\n  return e.isLeft() ? e : right(f(e.value));\n};\n\nexport const chain = <L, R, U>(f: (r: R) => TaskEither<L, U>) => (te: TaskEither<L, R>): TaskEither<L, U> => async () => {\n  const e = await te();\n  return e.isLeft() ? e : f(e.value)();\n};\n\nexport const tap = <L, R>(f: (r: Either<L, R>) => void) => (te: TaskEither<L, R>): TaskEither<L, R> => async () => {\n  const e = await te();\n  f(e);\n  return e;\n};\n",
    "import { z } from \"zod\";\n\n/**\n * –°—Ö–µ–º–∞ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è\n */\nexport const GenerateImageInputSchema = z.object({\n  prompt: z.string().min(3, \"–ü—Ä–æ–º–ø—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–∏–Ω–∏–º—É–º 3 —Å–∏–º–≤–æ–ª–∞\"),\n  modelId: z.string().uuid().optional(), // ID –º–æ–¥–µ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–µ—Å–ª–∏ –µ—Å—Ç—å)\n  modelUrl: z.string().url().optional(), // URL –º–æ–¥–µ–ª–∏ Replicate (–µ—Å–ª–∏ –æ–±—â–∞—è)\n  aspectRatio: z.enum([\"1:1\", \"9:16\", \"16:9\", \"4:3\"]).default(\"9:16\"),\n  numImages: z.number().int().min(1).max(4).default(1),\n  negativePrompt: z.string().optional(),\n  steps: z.number().int().min(1).max(50).optional(),\n  guidanceScale: z.number().min(1).max(20).optional(),\n  seed: z.number().int().optional(),\n});\n\nexport type GenerateImageInput = z.infer<typeof GenerateImageInputSchema>;\n\n/**\n * –°—Ö–µ–º–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏\n */\nexport const GenerateImageOutputSchema = z.object({\n  success: z.boolean(),\n  imageUrls: z.array(z.string().url()),\n  metadata: z.object({\n    prompt: z.string(),\n    model: z.string(),\n    generationTime: z.number(),\n    loraUsed: z.boolean().optional(),\n    triggerWord: z.string().optional(),\n  }),\n  error: z.string().optional(),\n});\n\nexport type GenerateImageOutput = z.infer<typeof GenerateImageOutputSchema>;\n\n/**\n * –°—Ö–µ–º–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–µ–π—Å—Ç–≤–∏—è\n */\nexport const NeuroPhotoActionContextSchema = z.object({\n  telegramId: z.number().int().positive(),\n  botName: z.string(),\n  prompt: z.string().min(3),\n  modelId: z.string().uuid().optional(),\n  modelUrl: z.string().url().optional(),\n  userId: z.string().uuid(),\n});\n\nexport type NeuroPhotoActionContext = z.infer<\n  typeof NeuroPhotoActionContextSchema\n>;\n",
    "import { ImageGenerationProvider } from \"../types/provider.interface\";\n\n/**\n * –†–µ–µ—Å—Ç—Ä –≤—Å–µ—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π\n * –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Å—Ç–∏–ª—å, –ª–µ–≥–∫–æ —Ä–∞—Å—à–∏—Ä—è–µ–º—ã–π\n */\nexport class ImageProviderRegistry {\n  private providers = new Map<string, ImageGenerationProvider>();\n\n  /**\n   * –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞\n   */\n  register(provider: ImageGenerationProvider): void {\n    this.providers.set(provider.name, provider);\n    console.log(`‚úÖ –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –ø—Ä–æ–≤–∞–π–¥–µ—Ä: ${provider.name}`);\n  }\n\n  /**\n   * –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –ø–æ –∏–º–µ–Ω–∏\n   */\n  get(name: string): ImageGenerationProvider | undefined {\n    return this.providers.get(name);\n  }\n\n  /**\n   * –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤\n   */\n  getAll(): ImageGenerationProvider[] {\n    return Array.from(this.providers.values());\n  }\n\n  /**\n   * –ü–æ–ª—É—á–µ–Ω–∏–µ –∑–¥–æ—Ä–æ–≤—ã—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤\n   */\n  async getHealthyProviders(): Promise<ImageGenerationProvider[]> {\n    const healthy: ImageGenerationProvider[] = [];\n\n    for (const provider of this.providers.values()) {\n      const health = await provider.healthCheck()();\n      if (health.isRight() && health.value.status === \"healthy\") {\n        healthy.push(provider);\n      }\n    }\n\n    return healthy;\n  }\n\n  /**\n   * –ü–æ–ª—É—á–µ–Ω–∏–µ –ª—É—á—à–µ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø–µ—Ä–≤—ã–π –∑–¥–æ—Ä–æ–≤—ã–π)\n   */\n  async getBestProvider(): Promise<ImageGenerationProvider | undefined> {\n    const healthy = await this.getHealthyProviders();\n    return healthy[0];\n  }\n}\n\n// –ì–ª–æ–±–∞–ª—å–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä —Ä–µ–µ—Å—Ç—Ä–∞\nexport const imageProviderRegistry = new ImageProviderRegistry();\n",
    "import { drizzle as drizzlePg } from 'drizzle-orm/postgres-js';\nimport { drizzle as drizzleSqlite } from 'drizzle-orm/bun-sqlite';\nimport postgres from 'postgres';\nimport { Database } from 'bun:sqlite';\nimport * as schemaPg from './schema';\nimport * as schemaSqlite from './schema.sqlite';\nimport * as fs from 'fs';\nimport * as path from 'path';\n\n// Database mode detection\n// Try POSTGRES_URL first (ElizaOS standard), fallback to DATABASE_URL\nconst DATABASE_URL = process.env.POSTGRES_URL || process.env.DATABASE_URL;\nconst USE_SQLITE = !DATABASE_URL || DATABASE_URL === 'sqlite' || DATABASE_URL.startsWith('sqlite:');\n\n// Use appropriate schema based on database mode\nconst schema = USE_SQLITE ? schemaSqlite : schemaPg;\n\n/**\n * Drizzle ORM Client for Avatar Face Plugin\n * \n * Supports TWO modes:\n * - SQLite (local file-based, zero setup) - default for development\n * - PostgreSQL (production-ready, scalable)\n * \n * Set DATABASE_URL to switch to PostgreSQL:\n * - PostgreSQL: DATABASE_URL=postgresql://user:password@host:5432/database\n * - SQLite: Leave DATABASE_URL empty or set to \"sqlite\"\n * \n * Best practice from ElizaOS: Use Proxy pattern for lazy loading\n */\n\n// Lazy-initialized DB instances\nlet _dbPg: ReturnType<typeof drizzlePg> | null = null;\nlet _dbSqlite: ReturnType<typeof drizzleSqlite> | null = null;\n\n/**\n * Get PostgreSQL DATABASE_URL from environment\n */\nfunction getDatabaseUrl(): string {\n  if (!DATABASE_URL || DATABASE_URL === 'sqlite') {\n    throw new Error('DATABASE_URL not configured for PostgreSQL mode');\n  }\n  return DATABASE_URL;\n}\n\n/**\n * Get SQLite database path\n * Creates data directory if it doesn't exist\n */\nfunction getSqlitePath(): string {\n  const dataDir = path.join(process.cwd(), 'data');\n  if (!fs.existsSync(dataDir)) {\n    fs.mkdirSync(dataDir, { recursive: true });\n  }\n  return path.join(dataDir, 'avatar-face.db');\n}\n\n/**\n * Initialize SQLite database\n */\nfunction initSqlite() {\n  if (!_dbSqlite) {\n    const dbPath = getSqlitePath();\n    console.log(`[Avatar Face Plugin] Connecting to SQLite: ${dbPath}`);\n    const sqlite = new Database(dbPath);\n    \n    _dbSqlite = drizzleSqlite(sqlite, { schema });\n    console.log('[Avatar Face Plugin] SQLite connected');\n  }\n  return _dbSqlite;\n}\n\n/**\n * Initialize PostgreSQL database\n */\nfunction initPostgres() {\n  if (!_dbPg) {\n    const url = getDatabaseUrl();\n    console.log('[Avatar Face Plugin] Connecting to PostgreSQL...');\n    const queryClient = postgres(url, {\n      ssl: url.includes('localhost') ? false : { rejectUnauthorized: false },\n      max: 10, // Connection pool size\n      idle_timeout: 30, // Seconds\n      connect_timeout: 10, // Seconds\n    });\n    _dbPg = drizzlePg(queryClient, { schema });\n    console.log('[Avatar Face Plugin] PostgreSQL connected');\n  }\n  return _dbPg;\n}\n\n/**\n * Lazy-initialized Drizzle client\n * \n * Usage:\n * ```typescript\n * import { db } from '@/db/client';\n * const models = await db.select().from(userModels);\n * ```\n */\nexport const db = new Proxy({} as ReturnType<typeof drizzlePg> | ReturnType<typeof drizzleSqlite>, {\n  get(target, prop) {\n    try {\n      if (USE_SQLITE) {\n        return (initSqlite() as any)[prop];\n      } else {\n        return (initPostgres() as any)[prop];\n      }\n    } catch (error) {\n      console.error('[Avatar Face Plugin] Database connection failed:', error);\n      console.warn('[Avatar Face Plugin] Falling back to SQLite...');\n      return (initSqlite() as any)[prop];\n    }\n  }\n});\n\n/**\n * Export schema for use in queries\n */\nexport const userModels = USE_SQLITE ? schemaSqlite.userModels : schemaPg.userModels;\n\n/**\n * Export database mode for debugging\n */\nexport const DB_MODE = USE_SQLITE ? 'SQLite' : 'PostgreSQL';\nconsole.log(`[Avatar Face Plugin] Database mode: ${DB_MODE}`);\n\n",
    "import { pgTable, uuid, bigint, varchar, text, timestamp, boolean, jsonb, index } from 'drizzle-orm/pg-core';\nimport { createInsertSchema, createSelectSchema } from 'drizzle-zod';\nimport { z } from 'zod';\n\n/**\n * User Models Table (LoRA models trained on Fal.ai)\n * Stores information about users' trained avatar models\n */\nexport const userModels = pgTable('user_models', {\n  id: uuid('id').primaryKey().defaultRandom(),\n  telegram_id: bigint('telegram_id', { mode: 'number' }), // nullable for web users\n  entity_id: varchar('entity_id', { length: 50 }), // nullable for telegram users\n  bot_name: varchar('bot_name', { length: 100 }).notNull().default('neuro_face_bot'),\n\n  // Model info\n  model_name: varchar('model_name', { length: 100 }).notNull(),\n  model_url: text('model_url').notNull(), // URL to LoRA model on Fal.ai\n  trigger_word: varchar('trigger_word', { length: 50 }).notNull(), // e.g., 'NEURO_SAGE'\n\n  // Optional metadata\n  gender: varchar('gender', { length: 10 }), // 'male' | 'female' | 'person'\n  training_model: varchar('training_model', { length: 100 }), // e.g., 'flux-lora-fast-training'\n\n  // Status\n  status: varchar('status', { length: 20 }).notNull().default('training'), // 'training' | 'completed' | 'failed'\n  is_active: boolean('is_active').notNull().default(true),\n\n  // Flexible metadata (text –¥–ª—è SQLite - JSON –∫–∞–∫ —Å—Ç—Ä–æ–∫–∞)\n  metadata: text('metadata'),\n\n  // Timestamps\n  created_at: timestamp('created_at', { withTimezone: true }).defaultNow(),\n  updated_at: timestamp('updated_at', { withTimezone: true }).defaultNow(),\n}, (table) => ({\n  // –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞\n  telegramIdIdx: index('idx_user_models_telegram_id').on(table.telegram_id),\n  entityIdIdx: index('idx_user_models_entity_id').on(table.entity_id),\n  botNameIdx: index('idx_user_models_bot_name').on(table.bot_name),\n  statusIdx: index('idx_user_models_status').on(table.status),\n  isActiveIdx: index('idx_user_models_is_active').on(table.is_active),\n  compositeIdx: index('idx_user_models_telegram_bot').on(table.telegram_id, table.bot_name),\n}));\n\n// Zod schemas for validation\nexport const insertUserModelSchema = createInsertSchema(userModels, {\n  telegram_id: z.number().int().positive(),\n  entity_id: z.string().uuid().optional(), // UUID –¥–ª—è Socket.IO\n  bot_name: z.string().min(1).max(100),\n  model_name: z.string().min(1).max(100),\n  model_url: z.string().url(),\n  trigger_word: z.string().min(1).max(50),\n  gender: z.enum(['male', 'female', 'person']).optional(),\n  status: z.enum(['training', 'completed', 'failed']),\n  is_active: z.boolean().default(true),\n  metadata: z.string().optional(), // JSON –∫–∞–∫ —Å—Ç—Ä–æ–∫–∞ –¥–ª—è SQLite\n});\n\nexport const selectUserModelSchema = createSelectSchema(userModels);\n\n// TypeScript types\nexport type InsertUserModel = z.infer<typeof insertUserModelSchema>;\nexport type SelectUserModel = z.infer<typeof selectUserModelSchema>;\nexport type UserModel = typeof userModels.$inferSelect;\n",
    "import { sqliteTable, text, integer, index } from 'drizzle-orm/sqlite-core';\nimport { createInsertSchema, createSelectSchema } from 'drizzle-zod';\nimport { z } from 'zod';\nimport { sql } from 'drizzle-orm';\n\n/**\n * User Models Table (LoRA models trained on Fal.ai) - SQLite version\n * Stores information about users' trained avatar models\n */\nexport const userModels = sqliteTable('user_models', {\n  id: text('id').primaryKey().notNull().$defaultFn(() => crypto.randomUUID()),\n\n  // User identifiers (at least one must be present)\n  telegram_id: integer('telegram_id'),  // Real Telegram user ID (nullable if using web interface)\n  entity_id: text('entity_id'),         // UUID from web interface (nullable if using Telegram)\n\n  bot_name: text('bot_name').notNull().default('neuro_face_bot'),\n  \n  // Model info\n  model_name: text('model_name').notNull(),\n  model_url: text('model_url').notNull(), // URL to LoRA model on Fal.ai\n  trigger_word: text('trigger_word').notNull(), // e.g., 'NEURO_SAGE'\n  \n  // Optional metadata\n  gender: text('gender'), // 'male' | 'female' | 'person'\n  training_model: text('training_model'), // e.g., 'flux-lora-fast-training'\n  \n  // Status\n  status: text('status').notNull().default('training'), // 'training' | 'completed' | 'failed'\n  is_active: integer('is_active', { mode: 'boolean' }).notNull().default(true),\n  \n  // Flexible metadata (TEXT –¥–ª—è JSON –≤ SQLite)\n  metadata: text('metadata'),\n  \n  // Timestamps\n  created_at: text('created_at')\n    .default(sql`(datetime('now'))`),\n  updated_at: text('updated_at')\n    .default(sql`(datetime('now'))`),\n}, (table) => ({\n  // –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞\n  telegramIdIdx: index('idx_user_models_telegram_id').on(table.telegram_id),\n  entityIdIdx: index('idx_user_models_entity_id').on(table.entity_id),\n  botNameIdx: index('idx_user_models_bot_name').on(table.bot_name),\n  statusIdx: index('idx_user_models_status').on(table.status),\n  isActiveIdx: index('idx_user_models_is_active').on(table.is_active),\n\n  // Composite indexes for efficient querying\n  telegramBotIdx: index('idx_user_models_telegram_bot').on(table.telegram_id, table.bot_name),\n  entityBotIdx: index('idx_user_models_entity_bot').on(table.entity_id, table.bot_name),\n}));\n\n// Zod schemas for validation\nexport const insertUserModelSchema = createInsertSchema(userModels, {\n  telegram_id: z.number().int().optional(),  // Optional - may not have Telegram ID in web interface\n  entity_id: z.string().uuid().optional(),   // Optional - may not have entity ID in Telegram\n  bot_name: z.string().min(1).max(100),\n  model_name: z.string().min(1).max(100),\n  model_url: z.string().url(),\n  trigger_word: z.string().min(1).max(50),\n  gender: z.enum(['male', 'female', 'person']).optional(),\n  status: z.enum(['training', 'completed', 'failed']),\n  is_active: z.boolean().default(true),\n  metadata: z.record(z.unknown()).default({}),\n}).refine(\n  (data) => data.telegram_id || data.entity_id,  // At least one ID must be present\n  { message: 'Either telegram_id or entity_id must be provided' }\n);\n\nexport const selectUserModelSchema = createSelectSchema(userModels);\n\n// TypeScript types\nexport type InsertUserModel = z.infer<typeof insertUserModelSchema>;\nexport type SelectUserModel = z.infer<typeof selectUserModelSchema>;\nexport type UserModel = typeof userModels.$inferSelect;\n",
    "import { TaskEither, tryCatchAsync } from '../utils/functional/result';\nimport { db, userModels } from '../db/client';\nimport { eq, and } from 'drizzle-orm';\n\n/**\n * User Model from Database\n */\nexport interface UserModelDB {\n  id: string;\n  telegram_id?: number | null;   // May be null for web users\n  entity_id?: string | null;     // May be null for Telegram users\n  bot_name: string;\n  model_name: string;\n  model_url: string; // URL to LoRA on Fal.ai\n  trigger_word: string; // e.g., 'NEURO_SAGE'\n  gender?: string;\n  status: string;\n  is_active: boolean;\n  metadata: Record<string, unknown>;\n  created_at: Date;\n  updated_at: Date;\n}\n\n/**\n * Load user's active LoRA models from database\n *\n * @param userIdentifier - User's Telegram ID (number) or UUID/identifier (string)\n * @param botName - Bot name (default: 'neuro_face_bot')\n * @returns TaskEither with array of user models or error\n *\n * @example\n * ```typescript\n * // For Telegram users (numeric ID)\n * const modelsTask = getUserModelsTask(123456);\n *\n * // For Web UI users (UUID string)\n * const modelsTask = getUserModelsTask('uuid-string-here');\n *\n * const models = await runTaskEither(modelsTask);\n *\n * fold(\n *   (error) => console.error('Failed to load models:', error),\n *   (models) => console.log('Loaded models:', models)\n * )(models);\n * ```\n */\nexport const getUserModelsTask = (\n  userIdentifier: number | string,\n  botName: string = 'neuro_face_bot'\n): TaskEither<Error, UserModelDB[]> =>\n  tryCatchAsync(\n    async () => {\n      try {\n        let models;\n\n        // Determine identifier type and search strategy\n        if (typeof userIdentifier === 'number') {\n          // Telegram user - search by telegram_id\n          console.log(`[ModelLoader] Searching by telegram_id: ${userIdentifier}`);\n          models = await db\n            .select()\n            .from(userModels)\n            .where(\n              and(\n                eq(userModels.telegram_id, userIdentifier),\n                eq(userModels.bot_name, botName),\n                eq(userModels.is_active, true),\n                eq(userModels.status, 'completed') // Only completed models\n              )\n            )\n            .orderBy(userModels.created_at); // Most recent first\n        } else {\n          // Web UI user or UUID - try multiple strategies\n          const identifier = userIdentifier as string;\n          console.log(`[ModelLoader] Searching for identifier: ${identifier}`);\n\n          // Strategy 1: Direct match on entity_id (web interface UUID)\n          if (/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(identifier)) {\n            console.log(`[ModelLoader] Strategy 1: Trying as entity_id (UUID): ${identifier}`);\n            models = await db\n              .select()\n              .from(userModels)\n              .where(\n                and(\n                  eq(userModels.entity_id, identifier),\n                  eq(userModels.bot_name, botName),\n                  eq(userModels.is_active, true),\n                  eq(userModels.status, 'completed')\n                )\n              )\n              .orderBy(userModels.created_at);\n          }\n\n          // Strategy 2: Direct match on id field (if identifier is a model UUID)\n          if (!models || models.length === 0) {\n            console.log(`[ModelLoader] Strategy 2: Trying as model ID (UUID): ${identifier}`);\n            models = await db\n              .select()\n              .from(userModels)\n              .where(\n                and(\n                  eq(userModels.id, identifier),\n                  eq(userModels.bot_name, botName),\n                  eq(userModels.is_active, true),\n                  eq(userModels.status, 'completed')\n                )\n              )\n              .orderBy(userModels.created_at);\n          }\n\n          // Strategy 3: If no models found and identifier looks like numeric Telegram ID, try numeric conversion\n          if (!models || models.length === 0 && /^\\d+$/.test(identifier)) {\n            const telegramId = parseInt(identifier, 10);\n            console.log(`[ModelLoader] Strategy 3: Trying as telegram_id: ${telegramId}`);\n            models = await db\n              .select()\n              .from(userModels)\n              .where(\n                and(\n                  eq(userModels.telegram_id, telegramId),\n                  eq(userModels.bot_name, botName),\n                  eq(userModels.is_active, true),\n                  eq(userModels.status, 'completed')\n                )\n              )\n              .orderBy(userModels.created_at);\n          }\n        }\n\n        console.log(`[ModelLoader] Found ${models?.length || 0} active models for identifier: ${userIdentifier}`);\n\n        // Parse metadata JSON strings into objects (for SQLite text compatibility)\n        const parsedModels = (models || []).map(model => ({\n          ...model,\n          metadata: model.metadata ?\n            (typeof model.metadata === 'string' ?\n              (() => { try { return JSON.parse(model.metadata); } catch { return {}; } })()\n              : model.metadata\n            )\n            : {}\n        }));\n\n        return parsedModels as UserModelDB[];\n      } catch (dbError) {\n        console.error('[ModelLoader] Database query failed:', dbError);\n        // Fallback: return empty array if DB is unavailable\n        console.warn('[ModelLoader] Returning empty models array (DB unavailable)');\n        return [];\n      }\n    },\n    (error) => {\n      const errorMessage = `Failed to load user models: ${error instanceof Error ? error.message : String(error)}`;\n      console.error(`[ModelLoader] ${errorMessage}`);\n      return new Error(errorMessage);\n    }\n  );\n\n/**\n * Get a specific user model by ID\n * \n * @param modelId - Model UUID\n * @returns TaskEither with model or error\n */\nexport const getUserModelByIdTask = (\n  modelId: string\n): TaskEither<Error, UserModelDB | null> =>\n  tryCatchAsync(\n    async () => {\n      const [model] = await db\n        .select()\n        .from(userModels)\n        .where(eq(userModels.id, modelId))\n        .limit(1);\n\n      if (!model) return null;\n\n      // Parse metadata JSON string into object (for SQLite text compatibility)\n      const parsedModel = {\n        ...model,\n        metadata: model.metadata ?\n          (typeof model.metadata === 'string' ?\n            (() => { try { return JSON.parse(model.metadata); } catch { return {}; } })()\n            : model.metadata\n          )\n          : {}\n      };\n\n      // Return null only if query returns no rows\n      return parsedModel as UserModelDB;\n    },\n    (error) => new Error(`Failed to load model: ${error instanceof Error ? error.message : String(error)}`)\n  );\n",
    "import { imageProviderRegistry } from \"./provider-registry\";\nimport { GenerateImageOptions, ImageGenerationResult } from \"../types\";\nimport { TaskEither, left, runTaskEither } from \"../utils/functional/result\";\nimport { getUserModelsTask } from \"./modelLoader\";\n\n/**\n * Hybrid generation function that selects the best provider and generates the image.\n * \n * PRIORITY LOGIC:\n * 1. User's personal LoRA models (if available) ‚Üí Fal.ai with LoRA\n * 2. Default Flux Schnell ‚Üí Best available provider\n */\nexport async function generateNeuroPhotoHybrid(\n  prompt: string,\n  modelUrl: string | undefined,\n  numImages: number,\n  userId: string,\n  _context: any,\n  botName: string = \"neuro_face_bot\"\n): Promise<ImageGenerationResult> {\n  // 1. Try to load user's personal LoRA models from database\n  let effectiveModelUrl = modelUrl;\n  let effectiveTriggerWord: string | undefined;\n  \n  if (!modelUrl) {\n    // No explicit model specified, try to load user's models\n    try {\n      // Support both UUID and numeric Telegram IDs\n      let userIdentifier: string | number = userId;\n      const parsed = parseInt(userId, 10);\n      if (!isNaN(parsed)) {\n        userIdentifier = parsed;\n      }\n\n      const modelsResult = await runTaskEither(getUserModelsTask(userIdentifier, botName));\n\n      if (modelsResult.isRight() && modelsResult.value.length > 0) {\n        // User has trained models! Use the first one (most recent)\n        const userModel = modelsResult.value[0];\n        effectiveModelUrl = userModel.model_url;\n        effectiveTriggerWord = userModel.trigger_word;\n\n        console.log(`[NeuroPhoto Hybrid] Using user's personal LoRA: ${userModel.model_name} (trigger: ${effectiveTriggerWord})`);\n\n        // Auto-inject trigger word if not in prompt\n        if (effectiveTriggerWord && !prompt.includes(effectiveTriggerWord)) {\n          prompt = `${effectiveTriggerWord}, ${prompt}`;\n          console.log(`[NeuroPhoto Hybrid] Injected trigger word: \"${effectiveTriggerWord}\"`);\n        }\n      } else {\n        console.log('[NeuroPhoto Hybrid] No personal LoRA models found, using default Flux');\n      }\n    } catch (error) {\n      console.warn('[NeuroPhoto Hybrid] Failed to load user models (likely no DB connection):', error);\n      // Continue with default provider\n    }\n  }\n  \n  // 2. Determine provider based on effectiveModelUrl or default\n  let provider = await imageProviderRegistry.getBestProvider();\n  \n  // If modelUrl implies a specific provider (e.g. fal-ai/), try to get that provider\n  if (effectiveModelUrl && effectiveModelUrl.includes(\"fal-ai\")) {\n    const falProvider = imageProviderRegistry.get(\"fal\");\n    if (falProvider) {\n      provider = falProvider;\n      console.log('[NeuroPhoto Hybrid] Using Fal.ai provider for LoRA model');\n    }\n  } else if (effectiveModelUrl && !effectiveModelUrl.includes(\"fal-ai\")) {\n     // Assume Replicate for others if available\n     const replicateProvider = imageProviderRegistry.get(\"replicate\");\n     if (replicateProvider) {\n       provider = replicateProvider;\n       console.log('[NeuroPhoto Hybrid] Using Replicate provider');\n     }\n  }\n\n  if (!provider) {\n    return {\n      success: false,\n      imageUrls: [],\n      metadata: {\n        prompt,\n        model: effectiveModelUrl || \"unknown\",\n        generationTime: 0,\n      },\n      error: \"No suitable image generation provider found\",\n    };\n  }\n\n  const options: GenerateImageOptions = {\n    prompt,\n    modelUrl: effectiveModelUrl,\n    numImages,\n    aspectRatio: \"9:16\", // Default as per spec\n  };\n\n  // Execute generation\n  const resultTask: TaskEither<Error, ImageGenerationResult> = provider.generateImage(options);\n  const result = await resultTask();\n\n  if (result.isLeft()) {\n    return {\n      success: false,\n      imageUrls: [],\n      metadata: {\n        prompt,\n        model: effectiveModelUrl || \"unknown\",\n        generationTime: 0,\n      },\n      error: result.value.message,\n    };\n  }\n\n  return result.value;\n}\n",
    "/**\n * –ü–æ–ª—É—á–∞–µ—Ç Telegram ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤\n * –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∫–∞–∫ —Ä–µ–∞–ª—å–Ω—ã–µ Telegram ID, —Ç–∞–∫ –∏ UUID –¥–ª—è –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞\n */\nexport function getTelegramId(message: any): number | null {\n  // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: –ò–∑ metadata.targetUserId (–µ—Å–ª–∏ –µ—Å—Ç—å)\n  if (message?.metadata?.targetUserId && typeof message.metadata.targetUserId === 'string') {\n    const targetUserId = message.metadata.targetUserId;\n    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —ç—Ç–æ UUID –∏–ª–∏ —á–∏—Å–ª–æ–≤–æ–π ID\n    if (/^\\d+$/.test(targetUserId)) {\n      return parseInt(targetUserId, 10);\n    }\n  }\n\n  // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: –ò–∑ senderId –≤ metadata (–µ—Å–ª–∏ —á–∏—Å–ª–æ–≤–æ–π)\n  if (message?.metadata?.senderId && typeof message.metadata.senderId === 'string') {\n    const senderId = message.metadata.senderId;\n    if (/^\\d+$/.test(senderId)) {\n      return parseInt(senderId, 10);\n    }\n  }\n\n  // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3: –ò–∑ entityId (–º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å Telegram ID)\n  if (message?.entityId && typeof message.entityId === 'string') {\n    if (/^\\d+$/.test(message.entityId)) {\n      return parseInt(message.entityId, 10);\n    }\n  }\n\n  // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 4: Fallback - –∏—Å–ø–æ–ª—å–∑—É–µ–º uuidToTelegramId –¥–ª—è –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞\n  if (message?.userId) {\n    return uuidToTelegramId(message.userId);\n  }\n\n  return null;\n}\n\n/**\n * –ü—Ä–æ—Å—Ç–æ–π —Ö–µ—à UUID –≤ —á–∏—Å–ª–æ (–¥–ª—è –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –±–µ–∑ Telegram)\n */\nfunction uuidToTelegramId(userId: string): number {\n  let hash = 0;\n  for (let i = 0; i < userId.length; i++) {\n    const char = userId.charCodeAt(i);\n    hash = ((hash << 5) - hash) + char;\n    hash = hash & hash; // Convert to 32bit integer\n  }\n  return Math.abs(hash);\n}\n",
    "import { Action, ActionResult, ActionExample } from '@elizaos/core';\nimport { db, userModels } from '../db/client';\nimport { eq, and } from 'drizzle-orm';\nimport { randomUUID } from 'crypto';\n\n/**\n * FACE_TRAIN Action\n * –û–±—É—á–∞–µ—Ç LoRA –º–æ–¥–µ–ª—å —á–µ—Ä–µ–∑ Fal.ai\n */\nexport const faceTrainAction: Action = {\n  name: 'FACE_TRAIN',\n  description: '–û–±—É—á–∞–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—É—é LoRA –º–æ–¥–µ–ª—å –∏–∑ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è',\n\n  validate: async (runtime, message) => {\n    const text = message.content.text.toLowerCase();\n\n    // Commands (legacy support)\n    if (text.includes('/face train') || text.includes('/face add')) {\n      return true;\n    }\n\n    // Natural language intents for training\n    const trainingIntents = [\n      '–æ–±—É—á–∏—Ç—å –º–æ–¥–µ–ª—å',\n      '—Å–æ–∑–¥–∞—Ç—å –º–æ–¥–µ–ª—å',\n      '—Å–¥–µ–ª–∞—Ç—å –º–æ–¥–µ–ª—å',\n      '—Å–æ–∑–¥–∞–π –º–æ–¥–µ–ª—å',\n      '—Å–æ–∑–¥–∞–π –ª–æ—Ä–∞',\n      '–æ–±—É—á–∏—Ç—å –ª–æ—Ä–∞',\n      'train model',\n      'create model',\n      'make model',\n      'i want to train',\n      'want to train',\n      'create my model',\n      'make my model',\n    ];\n\n    return trainingIntents.some((intent) => text.includes(intent));\n  },\n\n  handler: async (runtime, message, state, options, callback): Promise<ActionResult> => {\n    const telegramId = message.entityId || message.id;\n    const text = message.content.text;\n\n    try {\n      // Parse model name from various formats\n      const modelName = extractModelName(text);\n\n      if (!modelName) {\n        await callback({\n          text: '‚ùå –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –∏–º—è –º–æ–¥–µ–ª–∏.\\n\\n**–ö–∞–∫ —Å–æ–∑–¥–∞—Ç—å –º–æ–¥–µ–ª—å:**\\n–ü—Ä–æ—Å—Ç–æ —Å–∫–∞–∂–∏—Ç–µ \"–æ–±—É—á–∏—Ç—å –º–æ–¥–µ–ª—å –ú–û–Ø_–ú–û–î–ï–õ–¨\" –∏ –ø—Ä–∏–ª–æ–∂–∏—Ç–µ —Ñ–æ—Ç–æ.\\n\\n–ü—Ä–∏–º–µ—Ä: \"–æ–±—É—á–∏—Ç—å –º–æ–¥–µ–ª—å Alex\"',\n          error: true,\n        });\n\n        return {\n          success: false,\n          text: 'Model name is required',\n          data: { actionName: 'FACE_TRAIN', error: 'Model name missing' },\n        };\n      }\n\n      // Sanitize model name\n      const sanitizedName = modelName.replace(/[^a-zA-Z0-9_\\s-]/g, '').trim();\n      if (sanitizedName.length < 2 || sanitizedName.length > 50) {\n        await callback({\n          text: `‚ùå **–ò–º—è –º–æ–¥–µ–ª–∏ –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –æ—Ç 2 –¥–æ 50 —Å–∏–º–≤–æ–ª–æ–≤**\\n\\n–í—ã —É–∫–∞–∑–∞–ª–∏: \"${modelName}\"\\n–î–ª–∏–Ω–∞: ${sanitizedName.length} —Å–∏–º–≤–æ–ª–æ–≤\\n\\n–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∫–æ—Ä–æ—á–µ: \"Alex\", \"John\", \"MyModel\"`,\n          error: true,\n        });\n\n        return {\n          success: false,\n          text: 'Model name length invalid',\n          data: { actionName: 'FACE_TRAIN', error: 'Name length 2-50 required' },\n        };\n      }\n\n      // Generate trigger word (sanitized model name + random suffix)\n      const triggerWord = `${sanitizedName.toUpperCase().replace(/\\s+/g, '_')}_${Math.random().toString(36).substring(2, 5).toUpperCase()}`;\n\n      // Check if user already has too many models\n      const existingModels = await (db as any)\n        .select()\n        .from(userModels)\n        .where(eq(userModels.telegram_id, parseInt(telegramId, 10)));\n\n      if (existingModels.length >= 10) {\n        await callback({\n          text: '‚ùå –£ –≤–∞—Å —É–∂–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–æ–¥–µ–ª–µ–π (10). –£–¥–∞–ª–∏—Ç–µ —Å—Ç–∞—Ä—ã–µ –º–æ–¥–µ–ª–∏, —á—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–µ.',\n          error: true,\n        });\n\n        return {\n          success: false,\n          text: 'Max models limit reached',\n          data: { actionName: 'FACE_TRAIN', error: 'Limit 10 models' },\n        };\n      }\n\n      // Create model record in database\n      const modelId = randomUUID();\n      const now = new Date().toISOString();\n\n      await (db as any).insert(userModels).values({\n        id: modelId,\n        telegram_id: parseInt(telegramId, 10),\n        bot_name: runtime.character?.name || 'neuro_face_bot',\n        model_name: sanitizedName,\n        model_url: '', // Will be updated after training\n        trigger_word: triggerWord,\n        gender: 'person',\n        status: 'training',\n        is_active: true,\n        metadata: JSON.stringify({ created_by: 'face_train_action' }),\n        created_at: now,\n        updated_at: now,\n      });\n\n      console.log(`[FACE_TRAIN] Created model record: ${modelId} for user ${telegramId}`);\n\n      // Notify user to upload photos\n      await callback({\n        text: `‚úÖ –ú–æ–¥–µ–ª—å \"${sanitizedName}\" —Å–æ–∑–¥–∞–Ω–∞! (trigger: ${triggerWord})\\n\\nüì∏ –¢–µ–ø–µ—Ä—å –∑–∞–≥—Ä—É–∑–∏—Ç–µ –æ—Ç 10 –¥–æ 25 —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –¥–ª—è –æ–±—É—á–µ–Ω–∏—è.\\n\\nüí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å –æ–±—É—á–µ–Ω–∏—è: ‚≠ê 200 –∑–≤–µ–∑–¥\\n\\n–Ø –Ω–∞—á–Ω—É –æ–±—É—á–µ–Ω–∏–µ, –∫–∞–∫ —Ç–æ–ª—å–∫–æ –ø–æ–ª—É—á—É —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏!`,\n        action: 'FACE_TRAIN',\n      });\n\n      return {\n        success: true,\n        text: `Model created: ${modelName}`,\n        values: {\n          model_id: modelId,\n          model_name: sanitizedName,\n          trigger_word: triggerWord,\n          status: 'training',\n        },\n        data: {\n          actionName: 'FACE_TRAIN',\n          modelId,\n          modelName: sanitizedName,\n          triggerWord,\n        },\n      };\n\n    } catch (error) {\n      console.error('[FACE_TRAIN] Error:', error);\n\n      await callback({\n        text: '‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –º–æ–¥–µ–ª–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.',\n        error: true,\n      });\n\n      return {\n        success: false,\n        text: 'Failed to create model',\n        error: error instanceof Error ? error : new Error(String(error)),\n        data: {\n          actionName: 'FACE_TRAIN',\n          errorMessage: error instanceof Error ? error.message : String(error),\n        },\n      };\n    }\n  },\n\n  examples: [\n    [\n      { name: 'user', content: { text: '/face train MyFaceModel' } },\n      { name: 'assistant', content: { text: '–ú–æ–¥–µ–ª—å \"MyFaceModel\" —Å–æ–∑–¥–∞–Ω–∞! –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è.', action: 'FACE_TRAIN' } },\n    ],\n    [\n      { name: 'user', content: { text: '–æ–±—É—á–∏—Ç—å –º–æ–¥–µ–ª—å Alex' } },\n      { name: 'assistant', content: { text: '–ú–æ–¥–µ–ª—å \"Alex\" —Å–æ–∑–¥–∞–Ω–∞! –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è.', action: 'FACE_TRAIN' } },\n    ],\n  ] as ActionExample[][],\n};\n\n/**\n * Extract model name from various text formats\n */\nfunction extractModelName(text: string): string | null {\n  const lowerText = text.toLowerCase();\n\n  // Format: /face train MODEL_NAME\n  if (lowerText.includes('/face train') || lowerText.includes('/face add')) {\n    const parts = text.split(' ');\n    const modelName = parts.slice(2).join(' ').trim();\n    return modelName || null;\n  }\n\n  // Format: \"–æ–±—É—á–∏—Ç—å –º–æ–¥–µ–ª—å NAME\", \"create model NAME\", etc.\n  const patterns = [\n    /–æ–±—É—á–∏—Ç—å\\s+–º–æ–¥–µ–ª—å\\s+([a-zA-Z0-9_\\s-]+)/i,\n    /—Å–æ–∑–¥–∞—Ç—å\\s+–º–æ–¥–µ–ª—å\\s+([a-zA-Z0-9_\\s-]+)/i,\n    /—Å–¥–µ–ª–∞—Ç—å\\s+–º–æ–¥–µ–ª—å\\s+([a-zA-Z0-9_\\s-]+)/i,\n    /—Å–æ–∑–¥–∞–π\\s+–º–æ–¥–µ–ª—å\\s+([a-zA-Z0-9_\\s-]+)/i,\n    /train\\s+model\\s+([a-zA-Z0-9_\\s-]+)/i,\n    /create\\s+model\\s+([a-zA-Z0-9_\\s-]+)/i,\n    /make\\s+model\\s+([a-zA-Z0-9_\\s-]+)/i,\n  ];\n\n  for (const pattern of patterns) {\n    const match = text.match(pattern);\n    if (match && match[1]) {\n      return match[1].trim();\n    }\n  }\n\n  return null;\n}\n",
    "import { Action, ActionResult, ActionExample } from '@elizaos/core';\nimport { db, userModels } from '../db/client';\nimport { eq, and } from 'drizzle-orm';\nimport { startFalTraining } from '../services/falTrainingService';\n\n/**\n * PHOTO_UPLOAD Action\n * –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç –æ–±—É—á–µ–Ω–∏–µ LoRA\n */\nexport const photoUploadAction: Action = {\n  name: 'PHOTO_UPLOAD',\n  description: '–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç –æ–±—É—á–µ–Ω–∏–µ LoRA –º–æ–¥–µ–ª–∏',\n\n  validate: async (runtime, message) => {\n    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏ –≤–ª–æ–∂–µ–Ω–∏—è (—Ñ–∞–π–ª—ã/–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è)\n    const hasAttachments = message.content.attachments && message.content.attachments.length > 0;\n\n    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –º–æ–¥–µ–ª—å –≤ —Å—Ç–∞—Ç—É—Å–µ \"training\"\n    // entityId –º–æ–∂–µ—Ç –±—ã—Ç—å UUID –¥–ª—è web –∏–ª–∏ telegram_id –¥–ª—è Telegram\n    const entityId = message.entityId;\n    if (!entityId) return false;\n\n    const trainingModels = await (db as any)\n      .select()\n      .from(userModels)\n      .where(\n        and(\n          eq(userModels.entity_id, entityId),\n          eq(userModels.status, 'training'),\n          eq(userModels.is_active, true)\n        )\n      );\n\n    const hasTrainingModel = trainingModels.length > 0;\n\n    console.log(`[PHOTO_UPLOAD] Validation: hasAttachments=${hasAttachments}, hasTrainingModel=${hasTrainingModel}`);\n\n    return hasAttachments && hasTrainingModel;\n  },\n\n  handler: async (runtime, message, state, options, callback): Promise<ActionResult> => {\n    const telegramId = message.entityId || message.id;\n    const attachments = message.content.attachments || [];\n\n    try {\n      console.log(`[PHOTO_UPLOAD] Processing ${attachments.length} attachments for user ${telegramId}`);\n\n      // –ù–∞—Ö–æ–¥–∏–º –º–æ–¥–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Å—Ç–∞—Ç—É—Å–µ \"training\"\n      const trainingModels = await (db as any)\n        .select()\n        .from(userModels)\n        .where(\n          and(\n            eq(userModels.telegram_id, parseInt(telegramId, 10)),\n            eq(userModels.status, 'training'),\n            eq(userModels.is_active, true)\n          )\n        );\n\n      if (trainingModels.length === 0) {\n        await callback({\n          text: '‚ùå –£ –≤–∞—Å –Ω–µ—Ç –º–æ–¥–µ–ª–∏ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –æ–±—É—á–µ–Ω–∏—è. –°–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É /face train.',\n          error: true,\n        });\n\n        return {\n          success: false,\n          text: 'No training model found',\n          data: { actionName: 'PHOTO_UPLOAD', error: 'No training model' },\n        };\n      }\n\n      // –ë–µ—Ä–µ–º –ø–µ—Ä–≤—É—é –º–æ–¥–µ–ª—å (–∏–ª–∏ –º–æ–∂–µ–º –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –≤—ã–±–æ—Ä–∞)\n      const model = trainingModels[0];\n      console.log(`[PHOTO_UPLOAD] Found training model: ${model.model_name} (${model.id})`);\n\n      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π\n      if (attachments.length < 5) {\n        await callback({\n          text: `‚ùå –ù—É–∂–Ω–æ –º–∏–Ω–∏–º—É–º 5 —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –¥–ª—è –æ–±—É—á–µ–Ω–∏—è. –í—ã –∑–∞–≥—Ä—É–∑–∏–ª–∏ —Ç–æ–ª—å–∫–æ ${attachments.length}.`,\n          error: true,\n        });\n\n        return {\n          success: false,\n          text: 'Too few photos',\n          data: { actionName: 'PHOTO_UPLOAD', error: 'Minimum 5 photos required' },\n        };\n      }\n\n      if (attachments.length > 25) {\n        await callback({\n          text: `‚ùå –ú–∞–∫—Å–∏–º—É–º 25 —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –¥–ª—è –æ–±—É—á–µ–Ω–∏—è. –í—ã –∑–∞–≥—Ä—É–∑–∏–ª–∏ ${attachments.length}.`,\n          error: true,\n        });\n\n        return {\n          success: false,\n          text: 'Too many photos',\n          data: { actionName: 'PHOTO_UPLOAD', error: 'Maximum 25 photos allowed' },\n        };\n      }\n\n      // –ò–∑–≤–ª–µ–∫–∞–µ–º URL —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –∏–∑ –≤–ª–æ–∂–µ–Ω–∏–π\n      const photoUrls = attachments\n        .filter((att: any) => att?.url || att?.filePath || att?.content)\n        .map((att: any) => att.url || att.filePath || att.content);\n\n      console.log(`[PHOTO_UPLOAD] Extracted ${photoUrls.length} photo URLs`);\n\n      // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ–º –ø–æ–ª—É—á–µ–Ω–∏–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π\n      await callback({\n        text: `‚úÖ –ü–æ–ª—É—á–µ–Ω–æ ${attachments.length} —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –¥–ª—è –º–æ–¥–µ–ª–∏ \"${model.model_name}\". –ù–∞—á–∏–Ω–∞—é –æ–±—É—á–µ–Ω–∏–µ...`,\n        action: 'PHOTO_UPLOAD',\n      });\n\n      // –ó–∞–ø—É—Å–∫–∞–µ–º –æ–±—É—á–µ–Ω–∏–µ –≤ —Ñ–æ–Ω–µ\n      startFalTraining({\n        modelId: model.id,\n        trigger_word: model.trigger_word,\n        photo_urls: photoUrls,\n        steps: 500, // –≠–∫–æ–Ω–æ–º–∏—á–Ω—ã–π —Ä–µ–∂–∏–º\n        lora_rank: 16,\n      }).catch((error) => {\n        console.error(`[PHOTO_UPLOAD] Background training error for model ${model.id}:`, error);\n      });\n\n      return {\n        success: true,\n        text: 'Photo upload completed, training started',\n        values: {\n          model_id: model.id,\n          model_name: model.model_name,\n          photo_count: attachments.length,\n          status: 'training_started',\n        },\n        data: {\n          actionName: 'PHOTO_UPLOAD',\n          modelId: model.id,\n          photoCount: attachments.length,\n        },\n      };\n\n    } catch (error) {\n      console.error('[PHOTO_UPLOAD] Error:', error);\n\n      await callback({\n        text: '‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.',\n        error: true,\n      });\n\n      return {\n        success: false,\n        text: 'Failed to process photos',\n        error: error instanceof Error ? error : new Error(String(error)),\n        data: {\n          actionName: 'PHOTO_UPLOAD',\n          errorMessage: error instanceof Error ? error.message : String(error),\n        },\n      };\n    }\n  },\n\n  examples: [\n    [\n      {\n        name: 'user',\n        content: {\n          text: '–í–æ—Ç –º–æ–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏',\n          attachments: [\n            { url: 'https://example.com/photo1.jpg' },\n            { url: 'https://example.com/photo2.jpg' },\n          ],\n        },\n      },\n      {\n        name: 'assistant',\n        content: {\n          text: '–ü–æ–ª—É—á–µ–Ω–æ 2 —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏. –ù–∞—á–∏–Ω–∞—é –æ–±—É—á–µ–Ω–∏–µ...',\n          action: 'PHOTO_UPLOAD',\n        },\n      },\n    ],\n  ] as ActionExample[][],\n};\n",
    "import { fal } from \"@fal-ai/client\";\nimport { db, userModels } from \"../db/client\";\nimport { eq } from \"drizzle-orm\";\n\n/**\n * Fal.ai LoRA Training Service\n * Handles real training via Fal.ai flux-lora-fast-training\n */\n\nexport interface TrainingConfig {\n  modelId: string;\n  trigger_word: string;\n  photo_urls: string[];\n  steps?: number;\n  lora_rank?: number;\n}\n\n/**\n * Start Fal.ai LoRA training (async)\n * Returns immediately, training happens in background\n */\nexport async function startFalTraining(config: TrainingConfig): Promise<void> {\n  const {\n    modelId,\n    trigger_word,\n    photo_urls,\n    steps = 500,\n    lora_rank = 16,\n  } = config;\n\n  console.log(`[FalTraining] Starting training for ${modelId}`);\n  console.log(\n    `[FalTraining] Photos: ${photo_urls.length}, Steps: ${steps}, Rank: ${lora_rank}`\n  );\n\n  try {\n    // Configure Fal.ai client\n    if (process.env.FAL_KEY) {\n      fal.config({\n        credentials: process.env.FAL_KEY,\n      });\n    }\n\n    // Call Fal.ai LoRA fast training\n    const result: any = await fal.subscribe(\"fal-ai/flux-lora-fast-training\", {\n      input: {\n        images_data_url: photo_urls,\n        trigger_word,\n        steps,\n        lora_rank,\n      },\n      logs: true,\n      onQueueUpdate: (update: any) => {\n        if (update.status === \"IN_PROGRESS\") {\n          console.log(`[FalTraining] Progress update for ${modelId}`);\n\n          // Extract progress from logs\n          const progress = extractProgress(update.logs || []);\n\n          // Update database with progress\n          (db as any)\n            .update(userModels)\n            .set({\n              metadata: JSON.stringify({\n                progress,\n                fal_job_id: update.request_id,\n                last_log: update.logs?.[update.logs.length - 1]?.message || \"\",\n              }),\n            })\n            .where(eq(userModels.id, modelId))\n            .catch((err: Error) =>\n              console.error(\"[FalTraining] Failed to update progress:\", err)\n            );\n        }\n      },\n    });\n\n    console.log(`[FalTraining] Training complete for ${modelId}`);\n    console.log(`[FalTraining] Result:`, result);\n\n    // Extract model URL from result\n    const modelUrl =\n      result.diffusers_lora_file?.url || result.config_file?.url || \"\";\n\n    if (!modelUrl) {\n      throw new Error(\"No model URL returned from Fal.ai\");\n    }\n\n    // Update database with completed model\n    await (db as any)\n      .update(userModels)\n      .set({\n        model_url: modelUrl,\n        status: \"completed\",\n        updated_at: new Date().toISOString(),\n        metadata: JSON.stringify({\n          progress: 100,\n          fal_job_id: result.request_id,\n          completed_at: new Date().toISOString(),\n        }),\n      })\n      .where(eq(userModels.id, modelId));\n\n    console.log(`[FalTraining] Model saved: ${modelUrl}`);\n  } catch (error: any) {\n    console.error(`[FalTraining] Training failed for ${modelId}:`, error);\n\n    // Mark as failed in database\n    await (db as any)\n      .update(userModels)\n      .set({\n        status: \"failed\",\n        updated_at: new Date().toISOString(),\n        metadata: JSON.stringify({\n          error: error.message || \"Training failed\",\n          failed_at: new Date().toISOString(),\n        }),\n      })\n      .where(eq(userModels.id, modelId));\n  }\n}\n\n/**\n * Extract progress percentage from Fal.ai logs\n * Looks for patterns like \"Step 250/500\" -> 50%\n */\nfunction extractProgress(logs: any[]): number {\n  if (!logs || logs.length === 0) return 0;\n\n  const lastLog = logs[logs.length - 1]?.message || \"\";\n\n  // Try to match \"Step X/Y\" pattern\n  const stepMatch = lastLog.match(/Step (\\d+)\\/(\\d+)/i);\n  if (stepMatch) {\n    const current = parseInt(stepMatch[1]);\n    const total = parseInt(stepMatch[2]);\n    return Math.round((current / total) * 100);\n  }\n\n  // Try to match \"X%\" pattern\n  const percentMatch = lastLog.match(/(\\d+)%/);\n  if (percentMatch) {\n    return parseInt(percentMatch[1]);\n  }\n\n  // Default to 50% if training is in progress\n  return 50;\n}\n",
    "import { Action, ActionResult, ActionExample } from '@elizaos/core';\nimport { db } from '../db/client';\nimport { userModels } from '../db/client';\nimport { eq, and } from 'drizzle-orm';\nimport { uuidToTelegramId } from '../utils/userHelpers';\n\nexport const listModelsAction: Action = {\n    name: 'LIST_MODELS',\n    description: '–°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –º–æ–¥–µ–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –∏—Ö —Å—Ç–∞—Ç—É—Å–æ–º –∏ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞–º–∏',\n\n    validate: async (runtime, message) => {\n        const text = message.content.text?.toLowerCase() || '';\n        return text.includes('/list models') ||\n               text.includes('/models') ||\n               text.includes('/my models');\n    },\n\n    handler: async (runtime, message, state, options, callback): Promise<ActionResult> => {\n        try {\n            const telegramId = uuidToTelegramId(message.userId);\n            if (!telegramId) {\n                await callback({\n                    text: '‚ùå –û—à–∏–±–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.',\n                });\n                return { success: false, error: new Error('Failed to extract telegram ID') };\n            }\n\n            // Query all user models (including inactive ones)\n            const models = await db\n                .select()\n                .from(userModels)\n                .where(and(\n                    eq(userModels.telegram_id, telegramId),\n                    eq(userModels.bot_name, 'neuro_face_bot')\n                ))\n                .orderBy(userModels.created_at);\n\n            if (!models || models.length === 0) {\n                await callback({\n                    text: 'üìù –£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –º–æ–¥–µ–ª–µ–π. –°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—É—é –∫–æ–º–∞–Ω–¥–æ–π `/face train`',\n                });\n                return { success: true, data: { models: [] } };\n            }\n\n            // Format the model list\n            const formattedModels = models.map(model => {\n                let statusIcon = '';\n                let statusText = '';\n                let statusEmoji = '';\n\n                if (model.is_active) {\n                    if (model.status === 'completed') {\n                        statusEmoji = '‚úÖ';\n                        statusText = '–ê–∫—Ç–∏–≤–Ω–∞';\n                    } else if (model.status === 'training') {\n                        statusEmoji = 'üîÑ';\n                        statusText = '–í –æ–±—É—á–µ–Ω–∏–∏';\n                    } else if (model.status === 'failed') {\n                        statusEmoji = '‚ùå';\n                        statusText = '–û—à–∏–±–∫–∞ –æ–±—É—á–µ–Ω–∏—è';\n                    }\n                } else {\n                    statusEmoji = '‚è∏Ô∏è';\n                    statusText = '–ù–µ–∞–∫—Ç–∏–≤–Ω–∞';\n                }\n\n                const createdDate = new Date(model.created_at).toLocaleDateString('ru-RU', {\n                    year: 'numeric',\n                    month: 'short',\n                    day: 'numeric'\n                });\n\n                return `${statusEmoji} **${model.model_name}** (trigger: ${model.trigger_word})\\n   ${statusText} - –°–æ–∑–¥–∞–Ω–∞: ${createdDate}\\n`;\n            });\n\n            const messageText = `üìã **–í–∞—à–∏ –º–æ–¥–µ–ª–∏:**\\n\\n${formattedModels.join('\\n')}\\n\\nüí° –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ \\`/activate model <–∏–º—è>\\` –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏, \\`/deactivate model <–∏–º—è>\\` –¥–ª—è –¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏–∏.`;\n\n            await callback({\n                text: messageText,\n            });\n\n            return {\n                success: true,\n                data: {\n                    models: models,\n                    count: models.length,\n                    activeCount: models.filter(m => m.is_active && m.status === 'completed').length,\n                },\n            };\n        } catch (error) {\n            console.error('Error in listModelsAction:', error);\n            await callback({\n                text: '‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–ø–∏—Å–∫–∞ –º–æ–¥–µ–ª–µ–π. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.',\n            });\n            return {\n                success: false,\n                error: error instanceof Error ? error : new Error(String(error)),\n            };\n        }\n    },\n\n    examples: [\n        [\n            {\n                name: 'user',\n                content: { text: '/list models' },\n            },\n            {\n                name: 'assistant',\n                content: {\n                    text: 'üìã **–í–∞—à–∏ –º–æ–¥–µ–ª–∏:**\\n\\n‚úÖ **MyModel** (trigger: NEURO_SAGE)\\n   –ê–∫—Ç–∏–≤–Ω–∞ - –°–æ–∑–¥–∞–Ω–∞: 15 —è–Ω–≤ 2024\\n\\n‚è∏Ô∏è **OldModel** (trigger: NEURO_OLD)\\n   –ù–µ–∞–∫—Ç–∏–≤–Ω–∞ - –°–æ–∑–¥–∞–Ω–∞: 10 —è–Ω–≤ 2024\\n\\nüí° –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `/activate model <–∏–º—è>` –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏.',\n                },\n            },\n        ],\n    ] as ActionExample[][],\n};\n",
    "/**\n * –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç ElizaOS userId (UUID) –≤ —á–∏—Å–ª–æ–≤–æ–π telegram_id –¥–ª—è –ë–î\n * –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≤–µ–±-—á–∞—Ç–∞, –≥–¥–µ –Ω–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–≥–æ telegram_id\n */\nexport function uuidToTelegramId(userId: string): number {\n  // –ü—Ä–æ—Å—Ç–æ–π —Ö–µ—à UUID –≤ —á–∏—Å–ª–æ\n  let hash = 0;\n  for (let i = 0; i < userId.length; i++) {\n    const char = userId.charCodeAt(i);\n    hash = ((hash << 5) - hash) + char;\n    hash = hash & hash; // Convert to 32bit integer\n  }\n  return Math.abs(hash);\n}\n",
    "import { Action, ActionResult, ActionExample } from '@elizaos/core';\nimport { db } from '../db/client';\nimport { userModels } from '../db/client';\nimport { eq, and } from 'drizzle-orm';\nimport { uuidToTelegramId } from '../utils/userHelpers';\nimport { randomUUID } from 'crypto';\n\nexport const deleteModelAction: Action = {\n    name: 'DELETE_MODEL',\n    description: '–£–¥–∞–ª—è–µ—Ç –º–æ–¥–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–º—è–≥–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ)',\n\n    validate: async (runtime, message) => {\n        const text = message.content.text?.toLowerCase() || '';\n        return text.includes('/delete model') || text.includes('/remove model');\n    },\n\n    handler: async (runtime, message, state, options, callback): Promise<ActionResult> => {\n        try {\n            const text = message.content.text || '';\n            const parts = text.split(' ');\n            const modelIdentifier = parts.slice(2).join(' ').trim();\n\n            if (!modelIdentifier) {\n                await callback({\n                    text: '‚ùå –£–∫–∞–∂–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏. –ü—Ä–∏–º–µ—Ä: `/delete model MyModel`',\n                });\n                return { success: false, error: new Error('Model name not provided') };\n            }\n\n            const telegramId = uuidToTelegramId(message.userId);\n            if (!telegramId) {\n                await callback({\n                    text: '‚ùå –û—à–∏–±–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.',\n                });\n                return { success: false, error: new Error('Failed to extract telegram ID') };\n            }\n\n            // Try to find model by ID first (if it looks like a UUID)\n            const isUUID = /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(modelIdentifier);\n            let model;\n\n            if (isUUID) {\n                const result = await db\n                    .select()\n                    .from(userModels)\n                    .where(and(\n                        eq(userModels.id, modelIdentifier),\n                        eq(userModels.telegram_id, telegramId)\n                    ));\n                model = result[0];\n            }\n\n            // If not found by ID, try by name\n            if (!model) {\n                const result = await db\n                    .select()\n                    .from(userModels)\n                    .where(and(\n                        eq(userModels.model_name, modelIdentifier),\n                        eq(userModels.telegram_id, telegramId)\n                    ));\n                model = result[0];\n            }\n\n            if (!model) {\n                await callback({\n                    text: '‚ùå –ú–æ–¥–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `/list models` —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –≤–∞—à–∏ –º–æ–¥–µ–ª–∏.',\n                });\n                return { success: false, error: new Error('Model not found') };\n            }\n\n            // Check if this is the user's last active model\n            const activeModels = await db\n                .select()\n                .from(userModels)\n                .where(and(\n                    eq(userModels.telegram_id, telegramId),\n                    eq(userModels.is_active, true),\n                    eq(userModels.status, 'completed')\n                ));\n\n            const isLastActive = activeModels.length === 1 && model.is_active && model.status === 'completed';\n\n            // Perform soft delete\n            await db\n                .update(userModels)\n                .set({\n                    is_active: false,\n                    updated_at: new Date().toISOString(),\n                })\n                .where(eq(userModels.id, model.id));\n\n            let responseText = `‚úÖ –ú–æ–¥–µ–ª—å **${model.model_name}** —É–¥–∞–ª–µ–Ω–∞. –í—ã –º–æ–∂–µ—Ç–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –µ—ë, –æ–±—Ä–∞—Ç–∏–≤—à–∏—Å—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É.`;\n\n            if (isLastActive) {\n                responseText += '\\n\\n‚ö†Ô∏è –≠—Ç–æ –±—ã–ª–∞ –≤–∞—à–∞ –ø–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–∞—è –º–æ–¥–µ–ª—å. –ü–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è –≤—ã –Ω–µ —Å–º–æ–∂–µ—Ç–µ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.';\n            }\n\n            await callback({\n                text: responseText,\n            });\n\n            return {\n                success: true,\n                data: {\n                    deletedModel: {\n                        id: model.id,\n                        name: model.model_name,\n                        trigger_word: model.trigger_word,\n                    },\n                    wasLastActive: isLastActive,\n                },\n            };\n        } catch (error) {\n            console.error('Error in deleteModelAction:', error);\n            await callback({\n                text: '‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –º–æ–¥–µ–ª–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.',\n            });\n            return {\n                success: false,\n                error: error instanceof Error ? error : new Error(String(error)),\n            };\n        }\n    },\n\n    examples: [\n        [\n            {\n                name: 'user',\n                content: { text: '/delete model MyModel' },\n            },\n            {\n                name: 'assistant',\n                content: {\n                    text: '‚úÖ –ú–æ–¥–µ–ª—å **MyModel** —É–¥–∞–ª–µ–Ω–∞. –í—ã –º–æ–∂–µ—Ç–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –µ—ë, –æ–±—Ä–∞—Ç–∏–≤—à–∏—Å—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É.',\n                },\n            },\n        ],\n        [\n            {\n                name: 'user',\n                content: { text: '/remove model OldModel' },\n            },\n            {\n                name: 'assistant',\n                content: {\n                    text: '‚úÖ –ú–æ–¥–µ–ª—å **OldModel** —É–¥–∞–ª–µ–Ω–∞. –í—ã –º–æ–∂–µ—Ç–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –µ—ë, –æ–±—Ä–∞—Ç–∏–≤—à–∏—Å—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É.',\n                },\n            },\n        ],\n    ] as ActionExample[][],\n};\n",
    "import { Action, ActionResult, ActionExample } from '@elizaos/core';\nimport { db } from '../db/client';\nimport { userModels } from '../db/client';\nimport { eq, and } from 'drizzle-orm';\nimport { uuidToTelegramId } from '../utils/userHelpers';\n\nexport const setActiveModelAction: Action = {\n    name: 'SET_ACTIVE_MODEL',\n    description: '–ê–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –∏–ª–∏ –¥–µ–∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –º–æ–¥–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è',\n\n    validate: async (runtime, message) => {\n        const text = message.content.text?.toLowerCase() || '';\n        return text.includes('/activate model') ||\n               text.includes('/deactivate model') ||\n               text.includes('/toggle model');\n    },\n\n    handler: async (runtime, message, state, options, callback): Promise<ActionResult> => {\n        try {\n            const text = message.content.text || '';\n            const parts = text.split(' ');\n            const actionType = parts[0].toLowerCase(); // /activate or /deactivate\n            const modelIdentifier = parts.slice(2).join(' ').trim();\n\n            if (!modelIdentifier) {\n                const command = actionType.includes('activate') ? '/activate' : '/deactivate';\n                await callback({\n                    text: `‚ùå –£–∫–∞–∂–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏. –ü—Ä–∏–º–µ—Ä: \\`${command} model MyModel\\``,\n                });\n                return { success: false, error: new Error('Model name not provided') };\n            }\n\n            const telegramId = uuidToTelegramId(message.userId);\n            if (!telegramId) {\n                await callback({\n                    text: '‚ùå –û—à–∏–±–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.',\n                });\n                return { success: false, error: new Error('Failed to extract telegram ID') };\n            }\n\n            // Try to find model by ID first (if it looks like a UUID)\n            const isUUID = /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(modelIdentifier);\n            let model;\n\n            if (isUUID) {\n                const result = await db\n                    .select()\n                    .from(userModels)\n                    .where(and(\n                        eq(userModels.id, modelIdentifier),\n                        eq(userModels.telegram_id, telegramId)\n                    ));\n                model = result[0];\n            }\n\n            // If not found by ID, try by name\n            if (!model) {\n                const result = await db\n                    .select()\n                    .from(userModels)\n                    .where(and(\n                        eq(userModels.model_name, modelIdentifier),\n                        eq(userModels.telegram_id, telegramId)\n                    ));\n                model = result[0];\n            }\n\n            if (!model) {\n                await callback({\n                    text: '‚ùå –ú–æ–¥–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `/list models` —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –≤–∞—à–∏ –º–æ–¥–µ–ª–∏.',\n                });\n                return { success: false, error: new Error('Model not found') };\n            }\n\n            // Check if model status allows activation\n            if (actionType.includes('activate') && model.status !== 'completed') {\n                await callback({\n                    text: `‚ùå –ú–æ–¥–µ–ª—å **${model.model_name}** –∏–º–µ–µ—Ç —Å—Ç–∞—Ç—É—Å \"${model.status}\". –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏.`,\n                });\n                return { success: false, error: new Error('Cannot activate non-completed model') };\n            }\n\n            // Determine new active state\n            let newActiveState: boolean;\n            let actionDescription: string;\n\n            if (actionType.includes('activate')) {\n                newActiveState = true;\n                actionDescription = '–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞';\n            } else if (actionType.includes('deactivate')) {\n                newActiveState = false;\n                actionDescription = '–¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞';\n            } else {\n                // toggle\n                newActiveState = !model.is_active;\n                actionDescription = newActiveState ? '–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞' : '–¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞';\n            }\n\n            // If trying to activate and already active\n            if (newActiveState && model.is_active) {\n                await callback({\n                    text: `‚ÑπÔ∏è –ú–æ–¥–µ–ª—å **${model.model_name}** —É–∂–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞.`,\n                });\n                return { success: true, data: { alreadyActive: true } };\n            }\n\n            // If trying to deactivate and already inactive\n            if (!newActiveState && !model.is_active) {\n                await callback({\n                    text: `‚ÑπÔ∏è –ú–æ–¥–µ–ª—å **${model.model_name}** —É–∂–µ –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞.`,\n                });\n                return { success: true, data: { alreadyInactive: true } };\n            }\n\n            // Update model status\n            await db\n                .update(userModels)\n                .set({\n                    is_active: newActiveState,\n                    updated_at: new Date().toISOString(),\n                })\n                .where(eq(userModels.id, model.id));\n\n            let responseText = `‚úÖ –ú–æ–¥–µ–ª—å **${model.model_name}** ${actionDescription}.`;\n\n            if (newActiveState) {\n                responseText += ' –¢–µ–ø–µ—Ä—å –æ–Ω–∞ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π.';\n\n                // Check if user has multiple active models\n                const activeModels = await db\n                    .select()\n                    .from(userModels)\n                    .where(and(\n                        eq(userModels.telegram_id, telegramId),\n                        eq(userModels.is_active, true),\n                        eq(userModels.status, 'completed'),\n                        eq(userModels.id, model.id)\n                    ));\n\n                const allActiveModels = await db\n                    .select()\n                    .from(userModels)\n                    .where(and(\n                        eq(userModels.telegram_id, telegramId),\n                        eq(userModels.is_active, true),\n                        eq(userModels.status, 'completed')\n                    ));\n\n                if (allActiveModels.length > 1) {\n                    responseText += '\\n\\n‚ÑπÔ∏è –£ –≤–∞—Å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π. –ü—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —Å–∞–º–∞—è –Ω–æ–≤–∞—è.';\n                }\n            } else {\n                responseText += ' –û–Ω–∞ –Ω–µ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏.';\n\n                // Check if this is the last active model\n                const remainingActiveModels = await db\n                    .select()\n                    .from(userModels)\n                    .where(and(\n                        eq(userModels.telegram_id, telegramId),\n                        eq(userModels.is_active, true),\n                        eq(userModels.status, 'completed')\n                    ));\n\n                if (remainingActiveModels.length === 0) {\n                    responseText += '\\n\\n‚ö†Ô∏è –≠—Ç–æ –≤–∞—à–∞ –ø–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–∞—è –º–æ–¥–µ–ª—å. –ü–æ—Å–ª–µ –¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –≤—ã –Ω–µ —Å–º–æ–∂–µ—Ç–µ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.';\n                }\n            }\n\n            await callback({\n                text: responseText,\n            });\n\n            return {\n                success: true,\n                data: {\n                    model: {\n                        id: model.id,\n                        name: model.model_name,\n                        trigger_word: model.trigger_word,\n                    },\n                    action: actionDescription,\n                    newActiveState: newActiveState,\n                },\n            };\n        } catch (error) {\n            console.error('Error in setActiveModelAction:', error);\n            await callback({\n                text: '‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ –º–æ–¥–µ–ª–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.',\n            });\n            return {\n                success: false,\n                error: error instanceof Error ? error : new Error(String(error)),\n            };\n        }\n    },\n\n    examples: [\n        [\n            {\n                name: 'user',\n                content: { text: '/activate model MyModel' },\n            },\n            {\n                name: 'assistant',\n                content: {\n                    text: '‚úÖ –ú–æ–¥–µ–ª—å **MyModel** –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞. –¢–µ–ø–µ—Ä—å –æ–Ω–∞ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π.',\n                },\n            },\n        ],\n        [\n            {\n                name: 'user',\n                content: { text: '/deactivate model MyModel' },\n            },\n            {\n                name: 'assistant',\n                content: {\n                    text: '‚è∏Ô∏è –ú–æ–¥–µ–ª—å **MyModel** –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞. –û–Ω–∞ –Ω–µ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏.',\n                },\n            },\n        ],\n        [\n            {\n                name: 'user',\n                content: { text: '/toggle model MyModel' },\n            },\n            {\n                name: 'assistant',\n                content: {\n                    text: '‚úÖ –ú–æ–¥–µ–ª—å **MyModel** –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞. –û–Ω–∞ –Ω–µ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏.',\n                },\n            },\n        ],\n    ] as ActionExample[][],\n};\n",
    "import {\n  Provider,\n  IAgentRuntime,\n  Memory,\n  State,\n  ProviderResult,\n} from \"@elizaos/core\";\n\nexport const neuroPhotoProvider: Provider = {\n  name: \"neuroPhotoProvider\",\n\n  get: async (\n    runtime: IAgentRuntime,\n    _message: Memory,\n    _state?: State\n  ): Promise<ProviderResult> => {\n    const defaultModel =\n      runtime.getSetting(\"DEFAULT_MODEL\") || \"black-forest-labs/flux-schnell\";\n\n    return {\n      text: `\n# üé® NeuroPhoto - AI Image Generation\n\n## Available Commands\n- \\`/neurophoto <–æ–ø–∏—Å–∞–Ω–∏–µ>\\` - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è AI-–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è\n- \\`–Ω–∞—Ä–∏—Å—É–π <–æ–ø–∏—Å–∞–Ω–∏–µ>\\` - –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ (—Ä—É—Å—Å–∫–∏–π)\n- \\`create image <–æ–ø–∏—Å–∞–Ω–∏–µ>\\` - –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ (–∞–Ω–≥–ª–∏–π—Å–∫–∏–π)\n\n## Current Configuration\n- **Default Model**: ${defaultModel}\n- **Generation Time**: 10-30 seconds\n- **Image Format**: 9:16 (vertical, –¥–ª—è Instagram Stories)\n- **Cost**: 7.5‚≠ê per image\n\n## Examples\n‚úÖ **Good prompts**:\n- \"/neurophoto beautiful sunset over the ocean\"\n- \"–Ω–∞—Ä–∏—Å—É–π —Ñ—É—Ç—É—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∏–π –≥–æ—Ä–æ–¥ —Å –ª–µ—Ç–∞—é—â–∏–º–∏ –º–∞—à–∏–Ω–∞–º–∏\"\n- \"create image of a cat in a spacesuit\"\n\n‚ùå **Bad prompts**:\n- \"/neurophoto cat\" (too short, not descriptive)\n- \"–Ω–∞—Ä–∏—Å—É–π\" (no description)\n\n## Tips for Better Results\n1. Be specific and descriptive\n2. Include details about style, colors, mood\n3. Mention lighting and composition\n4. Use English for best results with most models\n\n## Available Models\n- **Flux Schnell**: Fast, high-quality images (default)\n- **Flux Pro**: Premium quality, slower\n- **SDXL**: General-purpose, reliable\n      `.trim(),\n      values: {\n        defaultModel,\n        supportedCommands: [\n          \"/neurophoto\",\n          \"–Ω–∞—Ä–∏—Å—É–π\",\n          \"—Å–æ–∑–¥–∞–π –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ\",\n          \"create image\",\n        ],\n        cost: 7.5,\n        currency: \"stars\",\n      },\n    };\n  },\n};\n",
    "import Replicate from \"replicate\";\nimport { IAgentRuntime, Service } from \"@elizaos/core\";\nimport {\n  TaskEither,\n  left,\n  right,\n} from \"../utils/functional/result\";\nimport { GenerateImageOptions, ImageGenerationResult } from \"../types\";\nimport { BaseLoraServiceImpl, LoraModelConfig } from \"./loraService\";\n\nexport interface IReplicateService {\n  initialize(runtime: IAgentRuntime): Promise<void>;\n  generateImage(options: GenerateImageOptions): TaskEither<Error, ImageGenerationResult>;\n  generateImageWithLora(\n    prompt: string,\n    loraConfig: LoraModelConfig,\n    options: GenerateImageOptions\n  ): TaskEither<Error, ImageGenerationResult>;\n}\n\nexport class ReplicateService extends Service implements IReplicateService {\n  static serviceType = 'replicate';\n\n  private client: Replicate | null = null;\n  private runtime: IAgentRuntime | null = null;\n\n  constructor(runtime: IAgentRuntime) {\n    super(runtime);\n    this.runtime = runtime;\n  }\n\n  async start(): Promise<void> {\n    if (!this.runtime) return;\n\n    try {\n      const apiKey = this.runtime.getSetting(\"REPLICATE_API_KEY\");\n\n      if (!apiKey) {\n        console.warn(\"‚ö†Ô∏è  REPLICATE_API_KEY –Ω–µ –Ω–∞–π–¥–µ–Ω. ReplicateService –±—É–¥–µ—Ç –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω.\");\n        return;\n      }\n\n      // –°–æ–∑–¥–∞–µ–º –∫–ª–∏–µ–Ω—Ç Replicate\n      this.client = new Replicate({\n        auth: apiKey,\n      });\n\n      console.log(\"‚úÖ ReplicateService –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω —Å Replicate API\");\n    } catch (error) {\n      console.warn(\"‚ö†Ô∏è  REPLICATE_API_KEY –Ω–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞—Ç—å. ReplicateService –±—É–¥–µ—Ç –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω.\");\n      console.warn(`‚ö†Ô∏è  –û—à–∏–±–∫–∞: ${error instanceof Error ? error.message : String(error)}`);\n      return;\n    }\n  }\n\n  async initialize(runtime: IAgentRuntime): Promise<void> {\n    // Called by plugin init\n    this.runtime = runtime;\n  }\n\n  async stop(): Promise<void> {\n    // Cleanup Replicate client if needed\n    this.client = null;\n    console.log(\"üõë ReplicateService stopped\");\n  }\n\n  get capabilityDescription(): string {\n    return \"Replicate integration for image generation with LoRA models\";\n  }\n\n  static async start(runtime: IAgentRuntime): Promise<Service> {\n    const service = new ReplicateService(runtime);\n    await service.start();\n    return service;\n  }\n\n  static async stop(runtime: IAgentRuntime): Promise<unknown> {\n    // Cleanup if needed\n    return undefined;\n  }\n\n  generateImage(options: GenerateImageOptions): TaskEither<Error, ImageGenerationResult> {\n    return this.generateImageWithLora(\n      options.prompt,\n      {\n        triggerWord: options.triggerWord,\n        gender: options.gender,\n      },\n      options\n    );\n  }\n\n  /**\n   * –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ Replicate —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π LoRA\n   */\n  generateImageWithLora(\n    prompt: string,\n    loraConfig: LoraModelConfig,\n    options: GenerateImageOptions\n  ): TaskEither<Error, ImageGenerationResult> {\n    if (!this.client) {\n      return left(new Error(\"Replicate Service –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ REPLICATE_API_KEY –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö.\"));\n    }\n\n    const enhancedPrompt = this.buildEnhancedPrompt(prompt, loraConfig);\n\n    console.log(`[Replicate] –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å LoRA`);\n    console.log(`[Replicate] –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –ø—Ä–æ–º–ø—Ç: ${prompt}`);\n    console.log(`[Replicate] –£–ª—É—á—à–µ–Ω–Ω—ã–π –ø—Ä–æ–º–ø—Ç: ${enhancedPrompt}`);\n    console.log(`[Replicate] LoRA URL: ${loraConfig.modelUrl || '–Ω–µ —É–∫–∞–∑–∞–Ω'}`);\n\n    try {\n      // –í—ã–±–∏—Ä–∞–µ–º –º–æ–¥–µ–ª—å –∏ –≤–µ—Ä—Å–∏—é\n      const model = \"flux-dev-lora\";\n      const version = \"39ed52f2a78e934b3ba6e2a89f5b1c712de7dfea535525255b1aa35c5565e08b\";\n\n      // –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º input\n      const input: any = {\n        prompt: enhancedPrompt,\n        image_size: \"landscape_4_3\",\n        num_outputs: options.numImages || 1,\n        num_inference_steps: options.numInferenceSteps || 50,\n        guidance_scale: 7.5,\n      };\n\n      // –ï—Å–ª–∏ –µ—Å—Ç—å LoRA URL, –¥–æ–±–∞–≤–ª—è–µ–º –µ–≥–æ\n      if (loraConfig.modelUrl) {\n        input.lora_scale = 0.85;\n        input.lora_url = loraConfig.modelUrl;\n      }\n\n      // –î–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞ (TaskEither) –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –æ—à–∏–±–∫—É\n      return left(\n        new Error(\"–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Replicate client –Ω–∞–ø—Ä—è–º—É—é –∏–ª–∏ ReplicateServiceImpl –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏\")\n      );\n    } catch (error) {\n      console.error(\"[Replicate] –û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:\", error);\n      return left(error instanceof Error ? error : new Error(String(error)));\n    }\n  }\n\n  /**\n   * –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ Replicate (–¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)\n   */\n  async generateImageAsync(\n    prompt: string,\n    loraConfig: LoraModelConfig,\n    options: GenerateImageOptions\n  ): Promise<TaskEither<Error, ImageGenerationResult>> {\n    if (!this.client) {\n      return Promise.resolve(left(new Error(\"Replicate Service –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω\")));\n    }\n\n    try {\n      const enhancedPrompt = this.buildEnhancedPrompt(prompt, loraConfig);\n\n      // –í—ã–±–∏—Ä–∞–µ–º –º–æ–¥–µ–ª—å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –Ω–∞–ª–∏—á–∏—è LoRA\n      const model = loraConfig.modelUrl\n        ? \"flux-dev-lora\"  // –î–ª—è LoRA –º–æ–¥–µ–ª–µ–π\n        : \"flux-schnell\";  // –ë–µ–∑ LoRA\n\n      const version = loraConfig.modelUrl\n        ? \"39ed52f2a78e934b3ba6e2a89f5b1c712de7dfea535525255b1aa35c5565e08b\"\n        : \"ac732df83cea7fff18b8472768c88ad041fa750ff7682a21affe81863cbe77e4\";\n\n      const input: any = {\n        prompt: enhancedPrompt,\n        image_size: \"landscape_4_3\",\n        num_outputs: options.numImages || 1,\n        num_inference_steps: options.numInferenceSteps || 50,\n        guidance_scale: 7.5,\n      };\n\n      if (loraConfig.modelUrl) {\n        input.lora_scale = 0.85;\n        input.lora_url = loraConfig.modelUrl;\n      }\n\n      console.log(`[Replicate] –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –∫ ${model}`);\n\n      const output = await this.client.run(\n        `${model}:${version}`,\n        { input }\n      );\n\n      console.log(`[Replicate] –ü–æ–ª—É—á–µ–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç:`, output);\n\n      const imageUrls = this.extractImageUrls(output);\n      const success = imageUrls.length > 0;\n\n      if (success) {\n        console.log(`[Replicate] ‚úÖ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ ${imageUrls.length} –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π`);\n        return Promise.resolve(\n          right({\n            success: true,\n            imageUrls,\n            metadata: {\n              enhanced_prompt: enhancedPrompt,\n              provider: \"replicate\",\n              model,\n              version,\n              lora_url: loraConfig.modelUrl || null,\n              lora_scale: loraConfig.modelUrl ? 0.85 : null,\n            },\n          })\n        );\n      } else {\n        console.error(\"[Replicate] ‚ùå –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ –æ—Ç–≤–µ—Ç–µ\");\n        return Promise.resolve(\n          left(new Error(\"–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ –æ—Ç–≤–µ—Ç–µ Replicate\"))\n        );\n      }\n    } catch (error) {\n      console.error(\"[Replicate] ‚ùå –û—à–∏–±–∫–∞:\", error);\n      return Promise.resolve(\n        left(error instanceof Error ? error : new Error(String(error)))\n      );\n    }\n  }\n}\n",
    "import { fal } from \"@fal-ai/client\";\nimport { IAgentRuntime, Service } from \"@elizaos/core\";\nimport {\n  TaskEither,\n  left,\n  right,\n} from \"../utils/functional/result\";\nimport { GenerateImageOptions, ImageGenerationResult } from \"../types\";\nimport { BaseLoraServiceImpl, LoraModelConfig } from \"./loraService\";\n\nexport interface IFalService {\n  initialize(runtime: IAgentRuntime): Promise<void>;\n  generateImage(options: GenerateImageOptions): TaskEither<Error, ImageGenerationResult>;\n  generateImageWithLora(\n    prompt: string,\n    loraConfig: LoraModelConfig,\n    options: GenerateImageOptions\n  ): TaskEither<Error, ImageGenerationResult>;\n}\n\nexport class FalService extends Service implements IFalService {\n  static serviceType = 'fal';\n\n  private apiKey: string | null = null;\n  private runtime: IAgentRuntime | null = null;\n\n  constructor(runtime: IAgentRuntime) {\n    super(runtime);\n    this.runtime = runtime;\n  }\n\n  async start(): Promise<void> {\n    if (!this.runtime) return;\n\n    try {\n      const apiKey = this.runtime.getSetting(\"FAL_KEY\");\n\n      if (!apiKey) {\n        console.warn(\"‚ö†Ô∏è  FAL_KEY –Ω–µ –Ω–∞–π–¥–µ–Ω. FalService –±—É–¥–µ—Ç –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω.\");\n        return;\n      }\n\n      // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º Fal.ai –∫–ª–∏–µ–Ω—Ç\n      fal.config({\n        credentials: apiKey,\n      });\n\n      this.apiKey = apiKey;\n      console.log(\"‚úÖ FalService –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω —Å Fal.ai\");\n    } catch (error) {\n      console.warn(\"‚ö†Ô∏è  FAL_KEY –Ω–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞—Ç—å. FalService –±—É–¥–µ—Ç –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω.\");\n      console.warn(`‚ö†Ô∏è  –û—à–∏–±–∫–∞: ${error instanceof Error ? error.message : String(error)}`);\n      return;\n    }\n  }\n\n  async initialize(runtime: IAgentRuntime): Promise<void> {\n    // Called by plugin init\n    this.runtime = runtime;\n  }\n\n  async stop(): Promise<void> {\n    // Cleanup Fal.ai client if needed\n    this.apiKey = null;\n    console.log(\"üõë FalService stopped\");\n  }\n\n  get capabilityDescription(): string {\n    return \"Fal.ai integration for LoRA training and image generation\";\n  }\n\n  static async start(runtime: IAgentRuntime): Promise<Service> {\n    const service = new FalService(runtime);\n    await service.start();\n    return service;\n  }\n\n  static async stop(runtime: IAgentRuntime): Promise<unknown> {\n    // Cleanup if needed\n    return undefined;\n  }\n\n  generateImage(options: GenerateImageOptions): TaskEither<Error, ImageGenerationResult> {\n    return this.generateImageWithLora(\n      options.prompt,\n      {\n        triggerWord: options.triggerWord,\n        gender: options.gender,\n      },\n      options\n    );\n  }\n\n  /**\n   * –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ Fal.ai —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π LoRA\n   */\n  generateImageWithLora(\n    prompt: string,\n    loraConfig: LoraModelConfig,\n    options: GenerateImageOptions\n  ): TaskEither<Error, ImageGenerationResult> {\n    if (!this.apiKey) {\n      return left(new Error(\"Fal Service –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ FAL_KEY –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö.\"));\n    }\n\n    const enhancedPrompt = this.buildEnhancedPrompt(prompt, loraConfig);\n\n    console.log(`[Fal.ai] –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å LoRA`);\n    console.log(`[Fal.ai] –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –ø—Ä–æ–º–ø—Ç: ${prompt}`);\n    console.log(`[Fal.ai] –£–ª—É—á—à–µ–Ω–Ω—ã–π –ø—Ä–æ–º–ø—Ç: ${enhancedPrompt}`);\n    console.log(`[Fal.ai] LoRA URL: ${loraConfig.modelUrl || '–Ω–µ —É–∫–∞–∑–∞–Ω'}`);\n\n    try {\n      // –í—ã–±–∏—Ä–∞–µ–º –º–æ–¥–µ–ª—å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –Ω–∞–ª–∏—á–∏—è LoRA\n      const modelId = loraConfig.modelUrl\n        ? \"fal-ai/flux-dev-lora\"  // –î–ª—è LoRA –º–æ–¥–µ–ª–µ–π\n        : \"fal-ai/flux-schnell\";  // –ë–µ–∑ LoRA\n\n      const input: any = {\n        prompt: enhancedPrompt,\n        image_size: \"landscape_4_3\",\n        num_inference_steps: options.numInferenceSteps || 28,\n        guidance_scale: 3.5,\n        num_images: options.numImages || 1,\n      };\n\n      // –ï—Å–ª–∏ –µ—Å—Ç—å LoRA URL, –¥–æ–±–∞–≤–ª—è–µ–º –µ–≥–æ\n      if (loraConfig.modelUrl) {\n        input.lora_scale = 0.85;\n        input.lora_url = loraConfig.modelUrl;\n      }\n\n      // –ò—Å–ø–æ–ª—å–∑—É–µ–º subscriptions –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞\n      return left(\n        new Error(\"Synchronous generation not supported. Use async/await pattern.\")\n      );\n    } catch (error) {\n      console.error(\"[Fal.ai] –û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:\", error);\n      return left(error instanceof Error ? error : new Error(String(error)));\n    }\n  }\n\n  /**\n   * –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ Fal.ai (–¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)\n   */\n  async generateImageAsync(\n    prompt: string,\n    loraConfig: LoraModelConfig,\n    options: GenerateImageOptions\n  ): Promise<TaskEither<Error, ImageGenerationResult>> {\n    if (!this.apiKey) {\n      return Promise.resolve(left(new Error(\"Fal Service –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω\")));\n    }\n\n    try {\n      const enhancedPrompt = this.buildEnhancedPrompt(prompt, loraConfig);\n\n      const modelId = loraConfig.modelUrl\n        ? \"fal-ai/flux-dev-lora\"\n        : \"fal-ai/flux-schnell\";\n\n      const input: any = {\n        prompt: enhancedPrompt,\n        image_size: \"landscape_4_3\",\n        num_inference_steps: options.numInferenceSteps || 28,\n        guidance_scale: 3.5,\n        num_images: options.numImages || 1,\n      };\n\n      if (loraConfig.modelUrl) {\n        input.lora_scale = 0.85;\n        input.lora_url = loraConfig.modelUrl;\n      }\n\n      console.log(`[Fal.ai] –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –∫ ${modelId}`);\n\n      const result = await fal.subscribe(modelId, {\n        input,\n        logs: true,\n      });\n\n      console.log(`[Fal.ai] –ü–æ–ª—É—á–µ–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç:`, result);\n\n      const imageUrls = this.extractImageUrls(result);\n      const success = imageUrls.length > 0;\n\n      if (success) {\n        console.log(`[Fal.ai] ‚úÖ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ ${imageUrls.length} –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π`);\n        return Promise.resolve(\n          right({\n            success: true,\n            imageUrls,\n            metadata: {\n              enhanced_prompt: enhancedPrompt,\n              provider: \"fal-ai\",\n              model: modelId,\n              lora_url: loraConfig.modelUrl || null,\n              lora_scale: loraConfig.modelUrl ? 0.85 : null,\n            },\n          })\n        );\n      } else {\n        console.error(\"[Fal.ai] ‚ùå –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ –æ—Ç–≤–µ—Ç–µ\");\n        return Promise.resolve(\n          left(new Error(\"–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ –æ—Ç–≤–µ—Ç–µ Fal.ai\"))\n        );\n      }\n    } catch (error) {\n      console.error(\"[Fal.ai] ‚ùå –û—à–∏–±–∫–∞:\", error);\n      return Promise.resolve(\n        left(error instanceof Error ? error : new Error(String(error)))\n      );\n    }\n  }\n}\n",
    "import { ModelInfo } from \"../types/provider.interface\";\n\n// Placeholder configuration for image models based on the spec\n// In a real implementation, this might be loaded from a database or a more complex config file\nexport const IMAGE_MODELS: Record<string, any> = {\n  flux_schnell: {\n    id: 'flux_schnell',\n    name: 'Flux Schnell',\n    provider: 'replicate',\n    apiModel: 'black-forest-labs/flux-schnell',\n    description: 'Fast, high-quality image generation',\n    pricing: { fixedPriceStars: 4 },\n    apiSettings: {\n      aspectRatios: ['1:1', '16:9', '9:16', '4:3'],\n      maxImages: 4,\n      supportsNegativePrompt: true,\n      supportsSeed: true,\n      supportsSteps: true,\n      supportsGuidanceScale: true,\n    },\n    status: 'active',\n  },\n  fal_flux_lora: {\n    id: 'fal_flux_lora',\n    name: 'Fal.ai Flux LoRA',\n    provider: 'fal',\n    apiModel: 'fal-ai/flux-lora',\n    description: 'Flux with LoRA support for personalized images',\n    pricing: { fixedPriceStars: 4 },\n    apiSettings: {\n      aspectRatios: ['9:16'],\n      maxImages: 4,\n      supportsNegativePrompt: true,\n      supportsSeed: true,\n      supportsSteps: true,\n      supportsGuidanceScale: true,\n      supportsLoRA: true,\n    },\n    status: 'active',\n  },\n};\n\nexport function getImageModel(id: string) {\n  return IMAGE_MODELS[id];\n}\n\nexport function getImageModelsByProvider(provider: string) {\n  return Object.values(IMAGE_MODELS).filter(model => model.provider === provider && model.status === 'active');\n}\n",
    "import { ImageGenerationProvider, ModelInfo } from '../types/provider.interface'\nimport { TaskEither, tryCatchAsync, left } from '../utils/functional/result'\nimport { GenerateImageOptions, ImageGenerationResult } from '../types'\nimport { getImageModelsByProvider, getImageModel } from '../config/image-models.config'\nimport Replicate from 'replicate'\n\n/**\n * Replicate Provider - —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ ImageGenerationProvider\n * –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤—Å–µ –º–æ–¥–µ–ª–∏ Replicate (Flux, SDXL, SD3, Recraft, Photon –∏ –¥—Ä.)\n */\nexport class ReplicateProvider implements ImageGenerationProvider {\n  name = 'replicate'\n  description = 'AI image generation using Replicate API with Flux, SDXL, SD3, Recraft, Photon and other models'\n\n  private client: Replicate | null = null\n  private apiKey: string | null = null\n\n  constructor(apiKey: string) {\n    this.apiKey = apiKey\n    this.client = new Replicate({ auth: apiKey })\n  }\n\n  get supportedModels(): string[] {\n    return getImageModelsByProvider('replicate').map(model => model.id)\n  }\n\n  healthCheck(): TaskEither<Error, { status: 'healthy' | 'unhealthy' }> {\n    return tryCatchAsync(\n      async () => {\n        // –ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ - –ø—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –º–æ–¥–µ–ª–µ–π\n        if (!this.client) {\n          throw new Error('Replicate client –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω')\n        }\n        return { status: 'healthy' as const }\n      },\n      (error) => error instanceof Error ? error : new Error(String(error))\n    )\n  }\n\n  generateImage(options: GenerateImageOptions): TaskEither<Error, ImageGenerationResult> {\n    if (!this.client) {\n      return left(new Error('Replicate Provider –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω'))\n    }\n\n    return tryCatchAsync(\n      async () => {\n        const startTime = Date.now()\n\n        // –ü–æ–ª—É—á–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –º–æ–¥–µ–ª–∏\n        const modelConfig = options.modelId\n          ? getImageModel(options.modelId)\n          : getImageModel('flux_schnell') // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é\n\n        if (!modelConfig) {\n          throw new Error(`–ú–æ–¥–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞: ${options.modelId || 'flux_schnell'}`)\n        }\n\n        const modelUrl = modelConfig.apiModel\n        const numImages = Math.min(options.numImages || 1, modelConfig.apiSettings.maxImages)\n\n        // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ input –¥–ª—è Replicate\n        const input: any = {\n          prompt: options.prompt,\n          num_outputs: numImages,\n        }\n\n        // –î–æ–±–∞–≤–ª—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –º–æ–¥–µ–ª–∏\n        if (options.aspectRatio && modelConfig.apiSettings.aspectRatios.includes(options.aspectRatio)) {\n          input.aspect_ratio = options.aspectRatio\n        }\n\n        if (options.negativePrompt && modelConfig.apiSettings.supportsNegativePrompt) {\n          input.negative_prompt = options.negativePrompt\n        }\n\n        if (options.steps && modelConfig.apiSettings.supportsSteps) {\n          input.num_inference_steps = options.steps\n        }\n\n        if (options.guidanceScale && modelConfig.apiSettings.supportsGuidanceScale) {\n          input.guidance_scale = options.guidanceScale\n        }\n\n        if (options.seed && modelConfig.apiSettings.supportsSeed) {\n          input.seed = options.seed\n        }\n\n        // –î–æ–±–∞–≤–ª—è–µ–º –±–∞–∑–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏\n        if (modelConfig.apiSettings.baseInput) {\n          Object.assign(input, modelConfig.apiSettings.baseInput)\n        }\n\n        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ Replicate\n        const output = await this.client!.run(modelUrl as any, { input })\n        const generationTime = Date.now() - startTime\n\n        // –ü–∞—Ä—Å–∏–Ω–≥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞\n        let imageUrls: string[]\n        if (Array.isArray(output)) {\n          imageUrls = output.filter((url) => typeof url === 'string')\n        } else if (typeof output === 'string') {\n          imageUrls = [output]\n        } else if (output && typeof output === 'object' && 'output' in output) {\n          const outputData = (output as any).output\n          imageUrls = Array.isArray(outputData) ? outputData : [outputData]\n        } else {\n          throw new Error('–ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ –æ—Ç Replicate')\n        }\n\n        return {\n          success: true,\n          imageUrls,\n          metadata: {\n            prompt: options.prompt,\n            model: modelUrl,\n            generationTime,\n          },\n        } as ImageGenerationResult\n      },\n      (error) => error instanceof Error ? error : new Error(String(error))\n    )\n  }\n\n  getModelInfo(modelId: string): TaskEither<Error, ModelInfo> {\n    return tryCatchAsync(\n      async () => {\n        const modelConfig = getImageModel(modelId)\n        if (!modelConfig) {\n          throw new Error(`–ú–æ–¥–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞: ${modelId}`)\n        }\n\n        return {\n          id: modelConfig.id,\n          name: modelConfig.name,\n          provider: modelConfig.provider,\n          description: modelConfig.description,\n          pricePerImage: modelConfig.pricing.fixedPriceStars || 0,\n          estimatedTime: 10, // –ü—Ä–∏–º–µ—Ä–Ω–æ–µ –≤—Ä–µ–º—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏\n          supportedFeatures: [\n            ...(modelConfig.apiSettings.supportsNegativePrompt ? ['negative-prompt'] : []),\n            ...(modelConfig.apiSettings.supportsSeed ? ['seed'] : []),\n            ...(modelConfig.apiSettings.supportsSteps ? ['steps'] : []),\n            ...(modelConfig.apiSettings.supportsGuidanceScale ? ['guidance-scale'] : []),\n            ...(modelConfig.apiSettings.supportsLoRA ? ['lora'] : []),\n          ],\n          aspectRatios: modelConfig.apiSettings.aspectRatios,\n          maxImages: modelConfig.apiSettings.maxImages,\n        }\n      },\n      (error) => error instanceof Error ? error : new Error(String(error))\n    )\n  }\n\n  listModels(): TaskEither<Error, ModelInfo[]> {\n    return tryCatchAsync(\n      async () => {\n        const models = getImageModelsByProvider('replicate')\n        return Promise.all(\n          models.map(model => this.getModelInfo(model.id)())\n        ).then(results =>\n          results\n            .filter(result => result.isRight())\n            .map(result => (result as any).value)\n        )\n      },\n      (error) => error instanceof Error ? error : new Error(String(error))\n    )\n  }\n}\n",
    "import {\n  ImageGenerationProvider,\n  ModelInfo,\n} from \"../types/provider.interface\";\nimport {\n  TaskEither,\n  tryCatchAsync,\n  left,\n} from \"../utils/functional/result\";\nimport { GenerateImageOptions, ImageGenerationResult } from \"../types\";\nimport {\n  getImageModelsByProvider,\n  getImageModel,\n} from \"../config/image-models.config\";\nimport { fal } from \"@fal-ai/client\";\n\n/**\n * Fal.ai Provider - —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ ImageGenerationProvider\n * –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç LoRA –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π\n */\nexport class FalProvider implements ImageGenerationProvider {\n  name = \"fal\";\n  description =\n    \"AI image generation using Fal.ai API with LoRA support for personalized images\";\n\n  private apiKey: string | null = null;\n  private defaultLoRA?: { path: string; scale: number; triggerWord: string };\n\n  constructor(\n    apiKey: string,\n    defaultLoRA?: { path: string; scale: number; triggerWord: string }\n  ) {\n    this.apiKey = apiKey;\n    this.defaultLoRA = defaultLoRA;\n\n    // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Fal.ai –∫–ª–∏–µ–Ω—Ç–∞\n    fal.config({\n      credentials: apiKey,\n    });\n  }\n\n  get supportedModels(): string[] {\n    return getImageModelsByProvider(\"fal\").map((model) => model.id);\n  }\n\n  healthCheck(): TaskEither<Error, { status: \"healthy\" | \"unhealthy\" }> {\n    return tryCatchAsync(\n      async () => {\n        if (!this.apiKey) {\n          throw new Error(\"Fal.ai API key –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω\");\n        }\n        return { status: \"healthy\" as const };\n      },\n      (error) => (error instanceof Error ? error : new Error(String(error)))\n    );\n  }\n\n  generateImage(\n    options: GenerateImageOptions\n  ): TaskEither<Error, ImageGenerationResult> {\n    if (!this.apiKey) {\n      return left(new Error(\"Fal Provider –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω\"));\n    }\n\n    return tryCatchAsync(\n      async () => {\n        const startTime = Date.now();\n\n        // –ü–æ–ª—É—á–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –º–æ–¥–µ–ª–∏\n        const modelConfig = options.modelId\n          ? getImageModel(options.modelId)\n          : getImageModel(\"fal_flux_lora\"); // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é\n\n        if (!modelConfig) {\n          throw new Error(\n            `–ú–æ–¥–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞: ${options.modelId || \"fal_flux_lora\"}`\n          );\n        }\n\n        const modelUrl = modelConfig.apiModel;\n\n        // –£–ª—É—á—à–∞–µ–º –ø—Ä–æ–º–ø—Ç —Å trigger word –¥–ª—è LoRA\n        let enhancedPrompt = options.prompt;\n        if (this.defaultLoRA && modelConfig.apiSettings.supportsLoRA) {\n          enhancedPrompt = `${this.defaultLoRA.triggerWord} ${options.prompt}`;\n        }\n\n        // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ input –¥–ª—è Fal.ai\n        const input: any = {\n          prompt: enhancedPrompt,\n          image_size: {\n            width: 768,\n            height: 1365, // 9:16 –¥–ª—è —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–µ—Ç–µ–π\n          },\n          num_images: Math.min(\n            options.numImages || 1,\n            modelConfig.apiSettings.maxImages\n          ),\n        };\n\n        // –î–æ–±–∞–≤–ª—è–µ–º LoRA –µ—Å–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è\n        // –ù–û! –ï—Å–ª–∏ modelUrl —É–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç trained LoRA –º–æ–¥–µ–ª—å (fal-ai URL), –Ω–µ –¥–æ–±–∞–≤–ª—è–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ LoRA\n        const isLoRATrainedModel = options.modelUrl && options.modelUrl.includes(\"fal.run/fal-ai/flux-lora\");\n\n        if (modelConfig.apiSettings.supportsLoRA && !isLoRATrainedModel) {\n          input.loras = [];\n\n          // 1. Default LoRA from constructor (System default)\n          if (this.defaultLoRA) {\n            input.loras.push({\n              path: this.defaultLoRA.path,\n              scale: this.defaultLoRA.scale,\n            });\n          }\n        }\n\n        // –ï—Å–ª–∏ —ç—Ç–æ —É–∂–µ –≥–æ—Ç–æ–≤–∞—è LoRA-–º–æ–¥–µ–ª—å (–∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö), –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ—ë –Ω–∞–ø—Ä—è–º—É—é\n        // –∏ –ù–ï –¥–æ–±–∞–≤–ª—è–µ–º –æ—Ç–¥–µ–ª—å–Ω—ã–µ LoRA –ø–∞—Ä–∞–º–µ—Ç—Ä—ã - –æ–Ω–∏ —É–∂–µ –≤—Å—Ç—Ä–æ–µ–Ω—ã –≤ –º–æ–¥–µ–ª—å\n\n        // –î–æ–±–∞–≤–ª—è–µ–º –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã\n        if (\n          options.negativePrompt &&\n          modelConfig.apiSettings.supportsNegativePrompt\n        ) {\n          input.negative_prompt = options.negativePrompt;\n        }\n\n        if (options.steps && modelConfig.apiSettings.supportsSteps) {\n          input.num_inference_steps = options.steps;\n        }\n\n        if (\n          options.guidanceScale &&\n          modelConfig.apiSettings.supportsGuidanceScale\n        ) {\n          input.guidance_scale = options.guidanceScale;\n        }\n\n        if (options.seed && modelConfig.apiSettings.supportsSeed) {\n          input.seed = options.seed;\n        }\n\n        // –í—ã–∑–æ–≤ Fal.ai API\n        const result = await fal.subscribe(modelUrl, {\n          input,\n          logs: false,\n        });\n\n        const generationTime = Date.now() - startTime;\n\n        // –ü–∞—Ä—Å–∏–Ω–≥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞\n        const output = result as any;\n        let imageUrls: string[] = [];\n\n        if (output.images && Array.isArray(output.images)) {\n          imageUrls = output.images.map((img: any) => img.url);\n        } else if (output.image_url) {\n          imageUrls = [output.image_url];\n        } else if (output.url) {\n          imageUrls = [output.url];\n        } else {\n          throw new Error(\"–ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ –æ—Ç Fal.ai\");\n        }\n\n        return {\n          success: true,\n          imageUrls,\n          metadata: {\n            prompt: enhancedPrompt,\n            model: modelUrl,\n            generationTime,\n            loraUsed: this.defaultLoRA?.path,\n            triggerWord: this.defaultLoRA?.triggerWord,\n          },\n        } as ImageGenerationResult;\n      },\n      (error) => (error instanceof Error ? error : new Error(String(error)))\n    );\n  }\n\n  getModelInfo(modelId: string): TaskEither<Error, ModelInfo> {\n    return tryCatchAsync(\n      async () => {\n        const modelConfig = getImageModel(modelId);\n        if (!modelConfig) {\n          throw new Error(`–ú–æ–¥–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞: ${modelId}`);\n        }\n\n        return {\n          id: modelConfig.id,\n          name: modelConfig.name,\n          provider: modelConfig.provider,\n          description: modelConfig.description,\n          pricePerImage: modelConfig.pricing.fixedPriceStars || 0,\n          estimatedTime: 15, // –ü—Ä–∏–º–µ—Ä–Ω–æ–µ –≤—Ä–µ–º—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å LoRA\n          supportedFeatures: [\n            ...(modelConfig.apiSettings.supportsNegativePrompt\n              ? [\"negative-prompt\"]\n              : []),\n            ...(modelConfig.apiSettings.supportsSeed ? [\"seed\"] : []),\n            ...(modelConfig.apiSettings.supportsSteps ? [\"steps\"] : []),\n            ...(modelConfig.apiSettings.supportsGuidanceScale\n              ? [\"guidance-scale\"]\n              : []),\n            ...(modelConfig.apiSettings.supportsLoRA ? [\"lora\"] : []),\n          ],\n          aspectRatios: modelConfig.apiSettings.aspectRatios,\n          maxImages: modelConfig.apiSettings.maxImages,\n        };\n      },\n      (error) => (error instanceof Error ? error : new Error(String(error)))\n    );\n  }\n\n  listModels(): TaskEither<Error, ModelInfo[]> {\n    return tryCatchAsync(\n      async () => {\n        const models = getImageModelsByProvider(\"fal\");\n        return Promise.all(\n          models.map((model) => this.getModelInfo(model.id)())\n        ).then((results) =>\n          results\n            .filter((result) => result.isRight())\n            .map((result) => (result as any).value)\n        );\n      },\n      (error) => (error instanceof Error ? error : new Error(String(error)))\n    );\n  }\n}\n",
    "import { IAgentRuntime } from \"@elizaos/core\";\nimport { imageProviderRegistry } from \"./provider-registry\";\nimport { ReplicateProvider } from \"../providers/replicateProvider\";\nimport { FalProvider } from \"../providers/falProvider\";\n\n/**\n * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤—Å–µ—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤\n */\nexport function initializeProviders(runtime: IAgentRuntime): void {\n  // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è Replicate Provider\n  const replicateApiKey = runtime.getSetting(\"REPLICATE_API_KEY\");\n  if (replicateApiKey) {\n    const replicateProvider = new ReplicateProvider(replicateApiKey);\n    imageProviderRegistry.register(replicateProvider);\n  }\n\n  // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è Fal.ai Provider\n  const falApiKey = runtime.getSetting(\"FAL_KEY\");\n  if (falApiKey) {\n    const defaultLoRA = {\n      path: runtime.getSetting(\"FAL_DEFAULT_LORA_PATH\") || \"\",\n      scale: Number(runtime.getSetting(\"FAL_DEFAULT_LORA_SCALE\")) || 1.0,\n      triggerWord: runtime.getSetting(\"FAL_LORA_TRIGGER\") || \"NEURO_SAGE\",\n    };\n\n    const falProvider = new FalProvider(falApiKey, defaultLoRA);\n    imageProviderRegistry.register(falProvider);\n  }\n\n  console.log(\n    `‚úÖ –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤: ${imageProviderRegistry.getAll().length}`\n  );\n}\n\n/**\n * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è (–¥–ª—è API —Å–µ—Ä–≤–µ—Ä–∞)\n */\nexport function initializeProvidersFromEnv(): void {\n  // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è Replicate Provider\n  const replicateApiKey = process.env.REPLICATE_API_KEY;\n  if (replicateApiKey) {\n    const replicateProvider = new ReplicateProvider(replicateApiKey);\n    imageProviderRegistry.register(replicateProvider);\n  }\n\n  // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è Fal.ai Provider\n  const falApiKey = process.env.FAL_KEY;\n  if (falApiKey) {\n    const defaultLoRA = {\n      path: process.env.FAL_DEFAULT_LORA_PATH || \"\",\n      scale: Number(process.env.FAL_DEFAULT_LORA_SCALE) || 1.0,\n      triggerWord: process.env.FAL_LORA_TRIGGER || \"NEURO_SAGE\",\n    };\n\n    const falProvider = new FalProvider(falApiKey, defaultLoRA);\n    imageProviderRegistry.register(falProvider);\n  }\n\n  console.log(\n    `‚úÖ [Env Init] –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤: ${imageProviderRegistry.getAll().length}`\n  );\n}\n",
    "/**\n * @999-agents/plugin-vibe-avatar-face\n * ElizaOS plugin for AI image generation\n *\n * @author 999-agents\n * @license MIT\n * @version 1.0.0\n */\n\nimport { Plugin } from \"@elizaos/core\";\nimport { generateImageAction } from \"./actions/generateImage\";\nimport { faceTrainAction } from \"./actions/faceTrainAction\";\nimport { photoUploadAction } from \"./actions/photoUploadAction\";\nimport { listModelsAction } from \"./actions/listModelsAction\";\nimport { deleteModelAction } from \"./actions/deleteModelAction\";\nimport { setActiveModelAction } from \"./actions/setActiveModelAction\";\nimport { neuroPhotoProvider } from \"./providers/neuroPhotoProvider\";\nimport { ReplicateService } from \"./services/replicateService\";\nimport { FalService } from \"./services/falService\";\nimport { initializeProviders } from \"./services/providers\";\n\n/**\n * NeuroPhoto Plugin for ElizaOS\n *\n * Provides AI image generation capabilities using Replicate/Fal.ai APIs\n */\nexport const vibeFaceAvatarPlugin: Plugin = {\n  name: \"neurophoto\",\n  description: \"AI image generation with Replicate/Fal.ai models\",\n\n  /**\n   * Actions that the agent can perform\n   */\n  actions: [generateImageAction, faceTrainAction, photoUploadAction, listModelsAction, deleteModelAction, setActiveModelAction],\n\n  /**\n   * Services for external APIs\n   */\n  services: [ReplicateService, FalService],\n\n  /**\n   * Providers that give context to the LLM\n   */\n  providers: [neuroPhotoProvider],\n\n  /**\n   * Evaluators (none for MVP)\n   */\n  evaluators: [],\n\n  /**\n   * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–ª–∞–≥–∏–Ω–∞\n   */\n  init: async (_config, runtime) => {\n    console.log(\"‚úÖ NeuroPhoto plugin initializing...\");\n\n    // Services are initialized automatically by ElizaOS via the services array\n    // Additional provider initialization\n    initializeProviders(runtime);\n    console.log(\"‚úÖ NeuroPhoto plugin initialized\");\n  },\n};\n\n/**\n * Export everything for external use\n */\nexport * from \"./types\";\nexport * from \"./actions/generateImage\";\nexport * from \"./actions/faceTrainAction\";\nexport * from \"./actions/photoUploadAction\";\nexport * from \"./actions/listModelsAction\";\nexport * from \"./actions/deleteModelAction\";\nexport * from \"./actions/setActiveModelAction\";\nexport * from \"./providers/neuroPhotoProvider\";\nexport * from \"./services/replicateService\";\nexport * from \"./services/falService\";\n// ‚ö†Ô∏è DEPRECATED: –ù–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º infisicalLoader - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Å–µ—Ä–≤–∏—Å!\n// export * from \"./services/infisicalLoader\"; // DEPRECATED - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ @elizaos/server/services/infisicalSecretLoader\n\n/**\n * Default export\n */\nexport default vibeFaceAvatarPlugin;\n"
  ],
  "mappings": "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",
  "debugId": "5F3A0E4A004A6F9164756E2164756E21",
  "names": []
}