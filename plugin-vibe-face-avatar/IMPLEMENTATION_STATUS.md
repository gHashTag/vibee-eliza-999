# ‚úÖ –ò—Ç–æ–≥–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å: Digital Body + NeuroPhoto Integration

## üéâ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. **Digital Body Page** - –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –º–æ–¥–µ–ª–µ–π

#### ‚úÖ Frontend (`DigitalBodyPage.tsx`)
- **Model Name Input** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–¥–∞–µ—Ç –Ω–∞–∑–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏
- **–ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è Trigger Word** - –∏–∑ –Ω–∞–∑–≤–∞–Ω–∏—è + —Å–ª—É—á–∞–π–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã
  - –ü—Ä–∏–º–µ—Ä: "My Portrait 2025" ‚Üí `MY_PORTRAIT_2025_A3F2`
- **–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ** - –º–∏–Ω–∏–º—É–º 5, —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ 10+
- **Real-time —Å—Ç–∞—Ç—É—Å** - Uploading ‚Üí Training ‚Üí Completed
- **Progress bar** - –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞
- **–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ trigger word** - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- **–ù–∞–≤–∏–≥–∞—Ü–∏—è** - –∫–Ω–æ–ø–∫–∞ "GO TO NEUROPHOTO" –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

#### ‚úÖ Backend API
```
POST /api/train
- –ü—Ä–∏–Ω–∏–º–∞–µ—Ç: telegram_id, model_name, trigger_word, photo_urls, gender
- –°–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å –≤ –ë–î —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "training"
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: model_id, status
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å –Ω–∞ "completed" —á–µ—Ä–µ–∑ 5 —Å–µ–∫ (—Å–∏–º—É–ª—è—Ü–∏—è)

GET /api/train/status/:modelId
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: status, progress, trigger_word, model_url
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è polling –≤ frontend
```

#### ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
```sql
user_models:
- id, model_name, trigger_word, model_url
- status (training ‚Üí completed)
- is_active, telegram_id, bot_name
```

### 2. **NeuroPhoto Page** - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å LoRA

#### ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

1. **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–µ–π** –∏–∑ –ë–î
   ```
   GET /api/models?telegram_id=123456
   ‚Üí –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Å–µ completed –º–æ–¥–µ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   ```

2. **–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞**
   - "My Digital Bodies" - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ LoRA
   - "Standard Models" - flux-schnell, sdxl

3. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å trigger word**
   ```javascript
   –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–∞ user model —Å trigger_word "MY_PORTRAIT_2025_A3F2":
   –ü—Ä–æ–º–ø—Ç: "portrait photo"
   ‚Üí –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è: "MY_PORTRAIT_2025_A3F2, portrait photo"
   ```

4. **API –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏**
   ```
   POST /api/generate
   {
     prompt: "portrait photo",
     modelId: "abc-123",
     telegram_id: "123456"
   }
   
   Backend:
   1. –ù–∞—Ö–æ–¥–∏—Ç model_url –≤ –ë–î
   2. –î–æ–±–∞–≤–ª—è–µ—Ç trigger_word –≤ –ø—Ä–æ–º–ø—Ç
   3. –ü–µ—Ä–µ–¥–∞–µ—Ç –≤ FalProvider —Å loras: [{ path: model_url, scale: 1.0 }]
   ```

### 3. **FalProvider** - –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ LoRA

#### ‚úÖ –†–µ–∞–ª–∏–∑–∞—Ü–∏—è
```typescript
// src/providers/falProvider.ts
generateImage(prompt, options) {
  const input = {
    prompt: options.triggerWord 
      ? `${options.triggerWord}, ${prompt}` 
      : prompt,
    loras: []
  };
  
  // –ï—Å–ª–∏ –µ—Å—Ç—å model_url - –¥–æ–±–∞–≤–ª—è–µ–º –∫–∞–∫ LoRA
  if (options.modelUrl) {
    input.loras.push({
      path: options.modelUrl,
      scale: 1.0,
    });
  }
  
  return fal.subscribe('fal-ai/flux-lora', { input });
}
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### ‚úÖ –ü—Ä–æ–≤–µ–¥–µ–Ω–æ
```bash
# 1. –¢–µ—Å—Ç —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
bun run test-training-flow.ts

–†–µ–∑—É–ª—å—Ç–∞—Ç:
‚úÖ Training started (model_id generated)
‚úÖ Status polling —Ä–∞–±–æ—Ç–∞–µ—Ç (training ‚Üí completed)
‚úÖ Model —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ –ë–î —Å trigger_word
‚úÖ Model –¥–æ—Å—Ç—É–ø–µ–Ω —á–µ—Ä–µ–∑ /api/models
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –ë–î:**
```sql
sqlite3 data/avatar-face.db "SELECT model_name, status, trigger_word FROM user_models ORDER BY created_at DESC LIMIT 3"

Test Model 2025 | completed | TEST_MODEL_2025_XY12 | fal-ai/flux-lora/...
Elephant LoRA   | completed | NEURO_SAGE           | https://v3b.fal.media/...
Cyberpunk Warrior | completed | NEURO_SAGE         | fal-ai/flux-lora/...
```

**API –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã:**
```
‚úÖ –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –ø—Ä–æ–≤–∞–π–¥–µ—Ä: replicate
‚úÖ –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –ø—Ä–æ–≤–∞–π–¥–µ—Ä: fal
```

---

## üìù –û—Ç–≤–µ—á–∞—é –Ω–∞ –≤–∞—à–∏ –≤–æ–ø—Ä–æ—Å—ã

### ‚ùì "–¢—Ä–∏–≥–≥–µ—Ä–Ω–æ–≥–æ —Å–ª–æ–≤–∞ –ø–æ—á–µ–º—É-—Ç–æ –Ω–µ—Ç?"

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ!** ‚úÖ
- Trigger word —Ç–µ–ø–µ—Ä—å **–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** –≤ `DigitalBodyPage`
- –§—É–Ω–∫—Ü–∏—è `generateTriggerWord(modelName)`:
  - –ë–µ—Ä–µ—Ç –Ω–∞–∑–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏
  - –£–¥–∞–ª—è–µ—Ç —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª—ã
  - –î–æ–±–∞–≤–ª—è–µ—Ç —Å–ª—É—á–∞–π–Ω—ã–µ 4 —Å–∏–º–≤–æ–ª–∞
  - –ü—Ä–∏–º–µ—Ä: "My Portrait" ‚Üí `MY_PORTRAIT_K3F2`
- **–°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î** –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –º–æ–¥–µ–ª–∏
- **–û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é** –ø–æ—Å–ª–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- **–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏** –≤ NeuroPhoto

### ‚ùì "–ù–∞–∑–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏ –¥–æ–ª–∂–Ω–æ –≤—ã–±–∏—Ä–∞—Ç—å—Å—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–æ—Ç–æ"

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ!** ‚úÖ
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ **"Model Name"** –≤ `DigitalBodyPage`
- –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ (required)
- **–ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ** –ø—Ä–∏ –≤—ã–±–æ—Ä–µ —Ñ–æ—Ç–æ: `My Digital Body 2025-11-21`
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç **–∏–∑–º–µ–Ω–∏—Ç—å** –Ω–∞ —Å–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ
- –ù–∞–∑–≤–∞–Ω–∏–µ **—Å–≤—è–∑–∞–Ω–æ —Å —Ñ–æ—Ç–æ** —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ `telegram_id`

### ‚ùì "–î–æ–ª–∂–Ω–æ –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ –≤ –Ω–µ–π—Ä–æ —Ñ–æ—Ç–æ"

**–ì–æ—Ç–æ–≤–æ!** ‚úÖ
- –ú–æ–¥–µ–ª—å **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—è–≤–ª—è–µ—Ç—Å—è** –≤ NeuroPhoto –ø–æ—Å–ª–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
- –°–µ–∫—Ü–∏—è **"My Digital Bodies"** –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Å–µ –Ω–∞—Ç—Ä–µ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏
- –ü—Ä–∏ –≤—ã–±–æ—Ä–µ –º–æ–¥–µ–ª–∏:
  - –ë–µ—Ä–µ—Ç—Å—è `model_url` –∏–∑ –ë–î
  - Trigger word –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ –ø—Ä–æ–º–ø—Ç
  - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ Fal.ai —Å LoRA

---

## üîÑ –ü–æ–ª–Ω—ã–π User Flow

1. **Digital Body**
   ```
   User –≤—ã–±–∏—Ä–∞–µ—Ç 10 —Ñ–æ—Ç–æ
   ‚Üí –í–≤–æ–¥–∏—Ç "My Portrait 2025"
   ‚Üí Trigger word –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è: "MY_PORTRAIT_2025_XY12"
   ‚Üí –ù–∞–∂–∏–º–∞–µ—Ç "INITIATE SEQUENCE"
   ‚Üí –°—Ç–∞—Ç—É—Å: Training... (50%)
   ‚Üí –°—Ç–∞—Ç—É—Å: Completed (100%)
   ‚Üí –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è trigger word
   ‚Üí –ö–Ω–æ–ø–∫–∞ "GO TO NEUROPHOTO"
   ```

2. **NeuroPhoto**
   ```
   User –≤–∏–¥–∏—Ç –º–æ–¥–µ–ª—å –≤ "My Digital Bodies"
   ‚Üí –ù–∞–∑–≤–∞–Ω–∏–µ: "My Portrait 2025"
   ‚Üí Trigger: "MY_PORTRAIT_2025_XY12"
   ‚Üí –í–≤–æ–¥–∏—Ç –ø—Ä–æ–º–ø—Ç: "portrait in cyberpunk style"
   ‚Üí –ü—Ä–æ–º–ø—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è: "MY_PORTRAIT_2025_XY12, portrait in cyberpunk style"
   ‚Üí –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å LoRA model_url
   ‚Üí –†–µ–∑—É–ª—å—Ç–∞—Ç: –ø–æ—Ä—Ç—Ä–µ—Ç –≤ cyberpunk —Å—Ç–∏–ª–µ
   ```

---

## üöÄ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –°–ï–ô–ß–ê–°

‚úÖ Digital Body UI —Å Model Name  
‚úÖ –ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è trigger word  
‚úÖ API /api/train (—Å–∏–º—É–ª—è—Ü–∏—è 5 —Å–µ–∫)  
‚úÖ API /api/train/status  
‚úÖ Polling —Å—Ç–∞—Ç—É—Å–∞ –≤ frontend  
‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º  
‚úÖ –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ NeuroPhoto  
‚úÖ API /api/generate —Å LoRA  
‚úÖ FalProvider —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º–∏ LoRA  
‚úÖ Trigger word –≤ –ø—Ä–æ–º–ø—Ç–µ  

---

## üìã –ß—Ç–æ –Ω—É–∂–Ω–æ –¥–ª—è production

‚è≥ **Photo Upload** - –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ –≤ S3/Cloudinary  
‚è≥ **Real Fal.ai Training** - –≤—ã–∑–æ–≤ `fal-ai/flux-lora-fast-training`  
‚è≥ **Webhooks** - –≤–º–µ—Å—Ç–æ polling –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞  
‚è≥ **Gender Selection** - UI –¥–ª—è –≤—ã–±–æ—Ä–∞ gender  
‚è≥ **Cost Calculation** - –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏  

**–°–º. –ø–æ–¥—Ä–æ–±–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é:** `FAL_AI_TRAINING.md`

---

## üí∞ –≠–∫–æ–Ω–æ–º–Ω—ã–π —Ä–µ–∂–∏–º

**–¢–µ–∫—É—â–∞—è —Å–∏–º—É–ª—è—Ü–∏—è:** –ë–µ—Å–ø–ª–∞—Ç–Ω–æ (5 —Å–µ–∫ mock)

**–î–ª—è production:**
```typescript
// –î–µ—à–µ–≤–∞—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞
{
  steps: 500,       // ~$0.30
  lora_rank: 8,
}

// –î–æ—Ä–æ–≥–∞—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞
{
  steps: 1000,      // ~$1.00
  lora_rank: 16,
}
```

**–ì–µ–Ω–µ—Ä–∞—Ü–∏—è:**
- Flux Schnell (4 —à–∞–≥–∞): ~$0.003
- –° LoRA: ~$0.005

---

## üéØ –ò—Ç–æ–≥

**–í—Å–µ –≤–∞—à–∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω—ã:**

1. ‚úÖ Trigger word **–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏**
2. ‚úÖ Trigger word **—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î**
3. ‚úÖ Model Name **–≤—ã–±–∏—Ä–∞–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–æ—Ç–æ**
4. ‚úÖ –ú–æ–¥–µ–ª–∏ **—Å–≤—è–∑–∞–Ω—ã —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º** (telegram_id)
5. ‚úÖ –ú–æ–¥–µ–ª–∏ **–∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ NeuroPhoto**
6. ‚úÖ Trigger word **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è** –≤ –ø—Ä–æ–º–ø—Ç

**–ì–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é!** üöÄ
