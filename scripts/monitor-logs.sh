#!/bin/bash

# =============================================================================
# üì° VIBEE MONITOR LOGS - –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤
# =============================================================================
# –£–°–¢–ê–†–ï–õ - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –Ω–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É:
#   ./scripts/log-viewer.sh live      # –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤—Å–µ—Ö –ª–æ–≥–æ–≤
#   ./scripts/log-viewer.sh errors    # –¢–æ–ª—å–∫–æ –æ—à–∏–±–∫–∏
#   ./scripts/log-viewer.sh messages  # –¢–æ–ª—å–∫–æ —Å–æ–æ–±—â–µ–Ω–∏—è
#   ./scripts/log-viewer.sh success   # –¢–æ–ª—å–∫–æ —É—Å–ø–µ—Ö–∏
#
# –≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç —Ç–µ–ø–µ—Ä—å –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π log-viewer
# =============================================================================

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
LOG_VIEWER="$SCRIPT_DIR/log-viewer.sh"

if [ -f "$LOG_VIEWER" ]; then
    # –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–æ–≤—É—é —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É
    exec "$LOG_VIEWER" live
else
    echo "‚ùå [ERROR] $LOG_VIEWER –Ω–µ –Ω–∞–π–¥–µ–Ω"
    echo ""
    echo "üìã –í–†–£–ß–ù–£–Æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:"
    echo "   tail -n 0 -F agent.log final-test.log rainbow-test.log"
    echo ""
    echo "üìñ –ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –≤ LOGS-MANAGEMENT.md"
    echo ""

    # Fallback –Ω–∞ —Å—Ç–∞—Ä—É—é –∫–æ–º–∞–Ω–¥—É
    echo "üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤ VIBEE –∞–≥–µ–Ω—Ç–∞..."
    echo "üìù –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º—ã–µ —Ñ–∞–π–ª—ã:"
    echo "   - agent.log"
    echo "   - final-test.log"
    echo "   - rainbow-test.log"
    echo ""
    echo "‚èπÔ∏è  –î–ª—è –≤—ã—Ö–æ–¥–∞ –Ω–∞–∂–º–∏—Ç–µ Ctrl+C"
    echo "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ"
    echo ""

    # –§—É–Ω–∫—Ü–∏—è –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Ñ–∞–π–ª–∞ —Å –ø–æ–¥—Å–≤–µ—Ç–∫–æ–π
    tail -n 0 -F agent.log final-test.log rainbow-test.log 2>/dev/null | while read line; do
        # –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤
        if [[ "$line" == *"‚úÖ"* ]]; then
            echo -e "\033[32m$line\033[0m"  # –ó–µ–ª–µ–Ω—ã–π
        elif [[ "$line" == *"‚ùå"* ]] || [[ "$line" == *"ERROR"* ]]; then
            echo -e "\033[31m$line\033[0m"  # –ö—Ä–∞—Å–Ω—ã–π
        elif [[ "$line" == *"üöÄ"* ]] || [[ "$line" == *"üîç"* ]]; then
            echo -e "\033[36m$line\033[0m"  # –ì–æ–ª—É–±–æ–π
        elif [[ "$line" == *"‚ö†Ô∏è"* ]] || [[ "$line" == *"WARNING"* ]]; then
            echo -e "\033[33m$line\033[0m"  # –ñ–µ–ª—Ç—ã–π
        elif [[ "$line" =~ (–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥|monitoring|–≥—Ä—É–ø–ø–∞|group) ]]; then
            echo -e "\033[35m$line\033[0m"  # –§–∏–æ–ª–µ—Ç–æ–≤—ã–π
        else
            echo "$line"
        fi
    done
fi
