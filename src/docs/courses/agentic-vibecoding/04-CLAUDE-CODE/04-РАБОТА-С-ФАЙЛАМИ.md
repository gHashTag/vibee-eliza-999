# 04. Работа с файлами в Claude Code

> *"Код - это не текст в редакторе. Код - это живая структура, которую нужно понимать, чувствовать и направлять."*

## Подводка: От диалога к действию

В предыдущих статьях мы научились общаться с Claude Code и понимать его интерфейс. Теперь пришло время перейти к практике - работе с реальными файлами проекта.

Представьте: вы не открываете VS Code, не ищете файлы вручную, не копируете код туда-сюда. Вы просто **разговариваете** с Claude, а он сам читает, редактирует и создаёт файлы. Это и есть магия вайбкодинга.

## Философия работы с файлами

**Инсайт:** В традиционном программировании вы - хирург с скальпелем, делающий точные надрезы в коде. В вайбкодинге вы - дирижёр оркестра, управляющий потоками изменений.

Claude Code понимает контекст вашего проекта. Он знает:
- Где лежат файлы и как они связаны
- Какой код в каких файлах
- Как изменение одного файла влияет на другие
- Какие файлы стоит создать, а какие - отредактировать

Ваша задача - не управлять файлами, а **направлять энергию изменений**.

## Чтение файлов: Понимание кодовой базы

### Базовое чтение

Самый простой способ прочитать файл:

```
Прочитай файл src/index.js
```

Claude откроет файл и покажет его содержимое. Но это только начало.

### Умное чтение

**Пример 1: Чтение с контекстом**
```
Покажи мне файл с настройками API и объясни, какие переменные окружения нужны
```

Claude не просто откроет файл - он:
1. Найдёт нужный конфигурационный файл
2. Прочитает его
3. Объяснит каждую переменную
4. Укажет, что нужно добавить в `.env`

**Пример 2: Сравнение файлов**
```
Сравни старую и новую версию компонента Header. Что изменилось и почему?
```

Claude прочитает оба файла и даст аналитику изменений.

### Поиск по кодовой базе

**Инсайт:** Поиск в вайбкодинге - это не grep по файлам. Это **вопрос к знающему коллеге**.

**Примеры поисковых запросов:**

```
Где у меня определена функция для работы с пользователями?
```

```
Найди все места, где используется Telegram API
```

```
Покажи файлы, связанные с обработкой платежей
```

Claude использует семантический поиск - он понимает **смысл** вашего запроса, а не просто ищет текстовые совпадения.

## Редактирование файлов: Изменение с умом

### Принцип "Редактируй, не пересоздавай"

**Золотое правило вайбкодинга:**
> Если файл существует - редактируй его. Создавай новый только когда это действительно нужно.

**Неправильный подход:**
```
Создай новый файл index.js с исправленным кодом
```

**Правильный подход:**
```
Отредактируй index.js - добавь обработку ошибок в функцию fetchData
```

### Точечное редактирование

Claude умеет вносить **точные изменения** без переписывания всего файла:

**Пример 1: Добавление функции**
```
В файл utils.js добавь функцию для валидации email
```

Claude:
1. Откроет `utils.js`
2. Найдёт подходящее место
3. Добавит только новую функцию
4. Сохранит остальной код нетронутым

**Пример 2: Исправление бага**
```
В функции calculateTotal есть ошибка - она не учитывает налог. Исправь это.
```

Claude:
1. Найдёт функцию `calculateTotal`
2. Проанализирует логику
3. Внесёт минимальные изменения для исправления
4. Сохранит стиль кода

### Массовые изменения

**Пример: Рефакторинг**
```
Переименуй переменную userId в telegramId во всех файлах проекта
```

Claude обработает все файлы параллельно, сохраняя консистентность.

## Создание файлов и структур

### Организация файлов

**Критически важно:** НИКОГДА не сохраняй рабочие файлы в корень проекта!

**Правильная структура:**
```
/src          - исходный код
/tests        - тесты
/docs         - документация
/config       - конфигурация
/scripts      - утилиты
/examples     - примеры
```

### Умное создание файлов

**Плохой запрос:**
```
Создай файл с кодом для работы с базой данных
```

**Хороший запрос:**
```
Создай в папке src/database/ файл userRepository.js с функциями для работы с пользователями в PostgreSQL
```

Claude:
1. Создаст папку `src/database/` если её нет
2. Создаст файл с правильным именем
3. Добавит нужный код
4. Подключит зависимости
5. Экспортирует функции

### Создание полной структуры проекта

**Пример: Новый микросервис**
```
Создай структуру для микросервиса обработки платежов:
- REST API на Express
- Подключение к PostgreSQL
- Валидация через Joi
- Логирование Winston
- Тесты Jest
```

Claude создаст:
```
services/payments/
├── src/
│   ├── controllers/
│   │   └── paymentController.js
│   ├── models/
│   │   └── Payment.js
│   ├── routes/
│   │   └── paymentRoutes.js
│   ├── services/
│   │   └── paymentService.js
│   └── index.js
├── tests/
│   ├── integration/
│   └── unit/
├── config/
│   └── database.js
└── package.json
```

## Навигация по большим проектам

### Понимание архитектуры

**Инсайт:** Claude видит проект как целостную систему, а не набор файлов.

**Запрос на понимание:**
```
Объясни архитектуру этого проекта - какие есть модули и как они связаны
```

Claude проанализирует:
- Структуру папок
- Зависимости между файлами
- Точки входа (entry points)
- Общую архитектуру

### Работа с монорепозиториями

**Пример: Найти нужный пакет**
```
У меня монорепо с 15 пакетами. Где находится логика отправки email?
```

Claude:
1. Просканирует все пакеты
2. Найдёт нужный код
3. Покажет полный путь
4. Объяснит как этот модуль используется

### Граф зависимостей

```
Покажи все файлы, которые зависят от userService.js
```

Claude построит граф зависимостей и покажет:
- Прямые зависимости
- Косвенные зависимости
- Потенциальные проблемы при изменении

## Удаление и переименование

### Безопасное удаление

**Неправильно:**
```
Удали файл oldComponent.js
```

**Правильно:**
```
Проверь, используется ли oldComponent.js где-то ещё. Если нет - удали его безопасно.
```

Claude:
1. Найдёт все импорты
2. Проверит использование
3. Предупредит о проблемах
4. Удалит только если безопасно

### Умное переименование

**Пример:**
```
Переименуй компонент UserCard в ProfileCard во всём проекте
```

Claude обновит:
- Имя файла
- Импорты в других файлах
- JSX разметку
- Комментарии
- Тесты

## Практические примеры вайбкодинга

### Пример 1: Рефакторинг API

**Задача:** Перевести REST API на GraphQL

```
Я хочу перевести endpoints из api/users/* на GraphQL.
Создай схему, резолверы и сохрани старые endpoints для совместимости.
```

Claude:
1. Прочитает существующие endpoints
2. Создаст GraphQL схему в `schema/user.graphql`
3. Создаст резолверы в `resolvers/userResolver.js`
4. Добавит deprecation notice в старые endpoints
5. Создаст миграционный гайд

### Пример 2: Добавление фичи

**Задача:** Добавить двухфакторную аутентификацию

```
Добавь 2FA через SMS:
1. Таблица в БД для кодов
2. Функция генерации кода
3. Интеграция с SMS API
4. Middleware для проверки
5. Тесты
```

Claude создаст всю структуру файлов и код.

### Пример 3: Исправление бага

**Задача:** Исправить memory leak

```
В приложении memory leak при работе с WebSocket.
Найди проблему и исправь её.
```

Claude:
1. Просканирует код WebSocket
2. Найдёт непрочищенные слушатели
3. Добавит правильную очистку
4. Создаст тест на утечку памяти

## Best Practices работы с файлами

### 1. Принцип минимальных изменений

**Инсайт:** Лучшее изменение - минимальное изменение, которое решает задачу.

```
Не надо: "Перепиши весь файл"
Надо: "Исправь функцию validateEmail - добавь проверку на + в адресе"
```

### 2. Контекстные изменения

```
Плохо: "Добавь функцию в utils.js"
Хорошо: "Добавь в utils.js функцию для работы с датами,
         которая будет использоваться в reportGenerator.js"
```

### 3. Пакетные операции

**Группируй связанные изменения:**
```
Создай систему логирования:
1. Файл logger.js с Winston
2. Middleware для Express
3. Интеграция в существующие контроллеры
4. Конфиг для разных окружений
```

### 4. Проверка перед изменениями

```
Перед тем как добавить новую зависимость, проверь:
- Не дублирует ли она существующую
- Совместима ли с текущей версией Node.js
- Есть ли более лёгкие альтернативы
```

### 5. Документирование изменений

```
После рефакторинга добавь комментарии:
- Что изменилось
- Почему изменилось
- Как это влияет на другой код
```

## Продвинутые техники

### 1. Условные изменения

```
Если в проекте используется TypeScript - добавь типы,
если нет - только JSDoc комментарии
```

### 2. Анализ перед действием

```
Проанализируй код auth.js и предложи улучшения безопасности.
Не меняй ничего - только покажи что можно улучшить.
```

### 3. Интерактивное редактирование

```
Покажи мне функцию processPayment.
Я скажу что изменить после того как увижу её.
```

### 4. Версионирование изменений

```
Создай ветку feature/new-auth, внеси изменения там,
и покажи diff с main веткой
```

## Типичные ошибки и как их избежать

### Ошибка 1: Хаос в файлах

**Плохо:**
```
/
├── test.js
├── newfile.js
├── component-fixed.js
└── backup.js
```

**Хорошо:**
```
/src/components/
/tests/
/config/
```

**Решение:** Всегда указывай папку при создании файла.

### Ошибка 2: Потеря контекста

**Плохо:**
```
Создай функцию для работы с API
```

**Хорошо:**
```
Создай в src/api/telegram.js функцию sendMessage,
которая отправляет сообщение через Telegram Bot API
используя токен из .env
```

### Ошибка 3: Слепые изменения

**Плохо:**
```
Добавь async/await во все функции
```

**Хорошо:**
```
Найди функции с колбэками и преобразуй их в async/await
где это уместно. Сохрани колбэки для event listeners.
```

## Упражнения для практики

### Упражнение 1: Навигация
1. Попроси Claude показать структуру твоего проекта
2. Найди главный файл приложения
3. Определи, где находится конфигурация

### Упражнение 2: Чтение
1. Попроси объяснить самый сложный файл проекта
2. Найди все места использования определённой функции
3. Построй граф зависимостей для модуля

### Упражнение 3: Редактирование
1. Добавь обработку ошибок в существующую функцию
2. Переименуй переменную во всём проекте
3. Оптимизируй производительность одной функции

### Упражнение 4: Создание
1. Создай новый модуль с правильной структурой папок
2. Добавь тесты к существующему коду
3. Создай конфигурацию для нового окружения

### Упражнение 5: Рефакторинг
1. Разбей большой файл на модули
2. Вынеси повторяющийся код в утилиты
3. Приведи код к единому стилю

## Философский инсайт

**Работа с файлами в вайбкодинге - это как игра в шахматы:**

- Вы видите позицию (текущее состояние кода)
- Вы планируете ход (изменения)
- Claude выполняет ход (редактирует файлы)
- Вы оцениваете результат (проверяете изменения)

Но в отличие от шахмат, вы можете сказать: "А давай попробуем по-другому" - и Claude откатит изменения.

**Главный принцип:** Не управляй файлами - управляй изменениями. Файлы - это просто материализация ваших намерений.

## Словарь терминов

- **Кодовая база** (codebase) - вся совокупность исходного кода проекта
- **Рефакторинг** - изменение структуры кода без изменения функциональности
- **Граф зависимостей** - схема связей между модулями
- **Entry point** - точка входа в приложение
- **Монорепозиторий** - один репозиторий для нескольких связанных проектов
- **Memory leak** - утечка памяти, когда программа не освобождает использованную память

---

## Тест на понимание

### Вопросы для самопроверки:

1. **Какой принцип использовать при работе с существующими файлами?**
   - A) Всегда создавать новый файл
   - B) Редактировать существующий файл
   - C) Копировать файл и редактировать копию
   - D) Удалять и создавать заново

2. **В какую папку НЕ нужно сохранять рабочие файлы?**
   - A) `/src`
   - B) `/tests`
   - C) корень проекта
   - D) `/docs`

3. **Какой запрос к Claude более правильный для поиска кода?**
   - A) "grep -r 'userService'"
   - B) "Где у меня определена логика работы с пользователями?"
   - C) "find . -name '*user*'"
   - D) "Покажи все файлы"

4. **Что Claude проверит перед безопасным удалением файла?**
   - A) Размер файла
   - B) Дату создания
   - C) Все импорты и использования
   - D) Права доступа

5. **Какие файлы обновит Claude при переименовании компонента?**
   - A) Только файл компонента
   - B) Только импорты
   - C) Файл компонента, импорты, JSX, тесты, комментарии
   - D) Только импорты и JSX

6. **Как Claude работает с большими файлами?**
   - A) Отказывается их открывать
   - B) Может читать частями с указанием offset и limit
   - C) Загружает в оперативную память целиком
   - D) Конвертирует в текстовый формат

7. **Что означает "пакетные операции" в работе с файлами?**
   - A) Работа с package.json
   - B) Группировка связанных изменений в один запрос
   - C) Установка npm пакетов
   - D) Архивирование файлов

8. **Какой подход правильный для массового рефакторинга?**
   - A) "Измени все файлы"
   - B) "Переименуй переменную userId в telegramId во всех файлах проекта"
   - C) "Сделай рефакторинг"
   - D) "Улучши код"

9. **Что такое "граф зависимостей"?**
   - A) Список npm пакетов
   - B) Схема связей между модулями проекта
   - C) Диаграмма Git коммитов
   - D) Структура папок

10. **Когда стоит использовать точечное редактирование?**
    - A) При создании нового проекта
    - B) При исправлении конкретного бага или добавлении функции
    - C) При удалении файлов
    - D) При переименовании проекта

**Ответы:** 1-B, 2-C, 3-B, 4-C, 5-C, 6-B, 7-B, 8-B, 9-B, 10-B

---

## Домашние задания

### Задание 1: Базовое (15-25 минут)
**"Организация проекта и базовый поиск"**

**Задача:**
У вас есть проект с хаотичной структурой файлов. Нужно навести порядок.

**Шаги:**
1. Попросите Claude показать текущую структуру проекта
2. Создайте правильную структуру папок (`src/`, `tests/`, `docs/`, `config/`)
3. Найдите все JavaScript файлы в корне проекта
4. Переместите файлы в соответствующие папки по их назначению
5. Создайте файл `src/utils/helpers.js` с функцией для валидации email
6. Найдите все места в проекте, где используется прямая валидация email и замените на импорт из `helpers.js`
7. Создайте файл `docs/PROJECT_STRUCTURE.md` с описанием новой структуры

**Критерии успеха:**
- Все файлы в правильных папках
- Нет файлов в корне проекта (кроме конфигурационных)
- Валидация email унифицирована
- Документация создана

**Примеры запросов:**
```
Покажи структуру этого проекта и найди все JS файлы в корне
```
```
Создай структуру папок src/, tests/, docs/, config/ и перемести файлы логично
```

---

### Задание 2: Продвинутое (30-45 минут)
**"Рефакторинг API модуля"**

**Задача:**
Рефакторинг существующего API модуля с улучшением архитектуры.

**Контекст:**
У вас есть файл `api.js` с 500+ строками кода, который содержит:
- Функции для работы с пользователями
- Функции для работы с платежами
- Функции для работы с уведомлениями
- Вспомогательные утилиты

**Шаги:**
1. Попросите Claude проанализировать `api.js` и предложить разбиение на модули
2. Создайте структуру:
   ```
   src/api/
   ├── users/
   │   ├── userService.js
   │   └── userRepository.js
   ├── payments/
   │   ├── paymentService.js
   │   └── paymentRepository.js
   ├── notifications/
   │   ├── notificationService.js
   │   └── notificationRepository.js
   └── index.js
   ```
3. Распределите код из `api.js` по новым модулям
4. Создайте файл `src/api/index.js` для экспорта всех модулей
5. Найдите все файлы, которые импортируют `api.js`
6. Обновите импорты на новую структуру модулей
7. Добавьте JSDoc комментарии к каждой функции
8. Создайте тесты для каждого сервиса в `tests/api/`

**Критерии успеха:**
- Файл `api.js` разбит на логические модули
- Все импорты обновлены
- Функциональность не нарушена
- Код документирован
- Есть базовые тесты

**Примеры запросов:**
```
Проанализируй api.js и предложи как разбить его на модули по доменам
```
```
Создай структуру src/api/ с модулями users, payments, notifications
```
```
Найди все файлы, которые импортируют api.js и покажи список
```

---

### Задание 3: Проектное (50-60+ минут)
**"Миграция и реструктуризация всей кодовой базы"**

**Задача:**
Масштабная миграция проекта с изменением архитектуры и переименованием сущностей.

**Сценарий:**
Проект был разработан для работы с "Users", но теперь нужно переориентировать его на работу с "Clients". Это требует:
- Переименования всех упоминаний
- Реструктуризации модулей
- Обновления базы данных
- Миграции тестов
- Обновления документации

**Шаги:**

**Фаза 1: Анализ (10 минут)**
1. Попросите Claude проанализировать проект и найти все упоминания "user/User/USER"
2. Постройте граф зависимостей для модулей, работающих с пользователями
3. Определите критические файлы, которые требуют особого внимания

**Фаза 2: Подготовка (10 минут)**
4. Создайте новую ветку `migration/user-to-client`
5. Создайте план миграции в `docs/MIGRATION_PLAN.md`
6. Подготовьте скрипт миграции базы данных

**Фаза 3: Переименование (15 минут)**
7. Переименуйте все файлы: `userService.js` → `clientService.js`
8. Переименуйте все переменные: `userId` → `clientId`, `userName` → `clientName`
9. Переименуйте все типы/интерфейсы: `User` → `Client`
10. Обновите все комментарии и строки документации

**Фаза 4: Реструктуризация (10 минут)**
11. Реорганизуйте модули по новой структуре:
    ```
    src/
    ├── core/
    │   ├── clients/
    │   │   ├── client.model.js
    │   │   ├── client.service.js
    │   │   ├── client.repository.js
    │   │   └── client.validator.js
    │   └── ...
    ├── api/
    │   └── routes/
    │       └── clientRoutes.js
    └── database/
        └── migrations/
            └── 001_rename_users_to_clients.sql
    ```

**Фаза 5: Тестирование и документация (15 минут)**
12. Обновите все тесты с новыми именами
13. Создайте новые тесты для миграционных скриптов
14. Обновите всю документацию (README.md, API.md, ARCHITECTURE.md)
15. Создайте CHANGELOG.md с описанием breaking changes
16. Создайте PR с детальным описанием изменений

**Критерии успеха:**
- Все упоминания "user" заменены на "client" (кроме технических: username для логина)
- Файловая структура реорганизована
- Все тесты проходят
- Документация актуальна
- Миграционные скрипты работают
- Git история чистая и понятная

**Особые требования:**
- Сохранить обратную совместимость для API endpoints (старые endpoints помечены как deprecated)
- Создать алиасы для плавной миграции клиентов
- Провести статический анализ для проверки консистентности

**Примеры запросов:**
```
Найди все упоминания "user", "User", "USER" в проекте и покажи статистику по файлам
```
```
Построй граф зависимостей для всех модулей, работающих с пользователями
```
```
Переименуй все файлы с "user" на "client" во всём проекте, сохраняя структуру
```
```
Создай миграционный SQL скрипт для переименования таблицы users в clients
```
```
Обновите все импорты после переименования файлов
```
```
Создай diff между веткой migration/user-to-client и main
```

**Дополнительные челленджи (опционально):**
- Автоматизировать миграцию через скрипт
- Создать rollback план на случай проблем
- Настроить CI/CD для автоматической проверки миграции
- Создать дашборд для мониторинга прогресса миграции

---

**Навигация:**
← [Предыдущая статья: 03. Интерактивный режим](03-ИНТЕРАКТИВНЫЙ-РЕЖИМ.md)
→ [Следующая статья: 05. Slash команды](05-SLASH-КОМАНДЫ.md)

**Прогресс:** 4 из 11 статей раздела "Claude Code" | [Вернуться к содержанию](README.md)
